<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Personel Başvuru</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; background: linear-gradient(135deg, #0f172a 0%, #162447 100%); color: white; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        .card { width: 700px; height: 600px; background: rgba(22, 36, 71, 0.95); border-radius: 15px; padding: 40px; text-align: center; position: relative; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); }
        .logo { width: 110px; height: auto; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }
        .question-box { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow-y: auto; }
        .q-header { color:#ffd700; margin:0 0 10px 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }
        .q-text { font-size:1.1rem; color:#e0e0e0; max-width:90%; line-height: 1.5; margin-bottom: 15px; }
        input, textarea { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 15px; width: 85%; border-radius: 5px; font-size: 1.1rem; transition: 0.3s; font-family: 'Segoe UI', sans-serif; }
        input:focus, textarea:focus { border-color: #ffd700; outline: none; background: rgba(255,255,255,0.15); box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }
        textarea { height: 150px; resize: none; }
        .footer { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn { padding: 12px 35px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        .btn-next { background: #e43f5a; color: white; } .btn-next:hover { background: #c0354a; }
        .btn-back { background: transparent; color: #aaa; border: 1px solid #aaa; } .btn-back:hover { color: white; border-color: white; }
        .progress-container { position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: rgba(0,0,0,0.3); border-radius: 15px 15px 0 0; overflow: hidden; }
        .progress-bar { height: 100%; background: #ffd700; width: 0%; transition: width 0.4s ease; }
        .step-count { position: absolute; top: 15px; right: 20px; color: rgba(255,255,255,0.3); font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="card">
    <div class="progress-container"><div class="progress-bar" id="pBar"></div></div>
    <div class="step-count" id="stepCount">Giriş</div>
    <img src="egmm.png" class="logo" alt="EGM Logo">
    <div class="question-box" id="qBox"></div>
    <div class="footer">
        <button class="btn btn-back" id="bBack" onclick="nav(-1)">GERİ</button>
        <button class="btn btn-next" id="bNext" onclick="nav(1)">BAŞLA</button>
    </div>
</div>

<script src="config.js"></script>
<script>
    // --- 1. SABİT SORULAR (Herkese Sorulur) ---
    const sabitSorular = [
        {id:'i', t:'info', h:'EGM PERSONEL ALIM', s:'Başvurunuz Emniyet Genel Müdürlüğü tarafından incelenecektir.<br>Sorular sistem tarafından 100 soruluk havuzdan <b>rastgele</b> seçilmiştir.'},
        {id:'discord_id', t:'text', h:'KİMLİK', s:'Discord ID Giriniz:'},
        {id:'ic_isim', t:'text', h:'KİMLİK', s:'Karakterinizin Adı ve Soyadı (IC):'},
        {id:'ooc_yas', t:'number', h:'KİMLİK', s:'Gerçek Yaşınız (OOC):'},
        {id:'aktiflik', t:'number', h:'AKTİFLİK', s:'Sunucuda günlük ortalama kaç saat aktif olabilirsiniz?'},
        {id:'deneyim', t:'textarea', h:'DENEYİM', s:'Daha önce FiveM üzerinde polislik yaptınız mı? Yaptıysanız hangi rütbede?'},
        {id:'karakter_hikaye', t:'textarea', h:'KARAKTER', s:'Karakterinizin polis olma motivasyonu nedir? Kısa bir özgeçmiş yazınız.'}
    ];

    // --- 2. SORU HAVUZU (Buradan Rastgele 10 Tane Seçilecek) ---
    // Burayı istediğin kadar artırabilirsin.
    const havuz = [
        {id:'h1', t:'textarea', h:'KURAL', s:'Powergaming (PG) nedir? Örnek veriniz.'},
        {id:'h2', t:'textarea', h:'KURAL', s:'Metagaming (MG) nedir? Rolde nasıl kaçınılmalıdır?'},
        {id:'h3', t:'textarea', h:'KURAL', s:'RDM ve VDM kavramlarını açıklayınız.'},
        {id:'h4', t:'textarea', h:'KURAL', s:'FearRP (Korku Rolü) bir polis için ne zaman geçerlidir?'},
        {id:'h5', t:'textarea', h:'KURAL', s:'New Life Rule (NLR) nedir? Ölen polis olaya dönebilir mi?'},
        {id:'h6', t:'textarea', h:'KURAL', s:'Mixing nedir? IC ve OOC kavramlarını karıştırmak ne demektir?'},
        {id:'h7', t:'textarea', h:'KURAL', s:'Combat Log (CL) nedir? Yapan birini görürseniz ne yaparsınız?'},
        {id:'h8', t:'textarea', h:'KURAL', s:'Retarded RP nedir? Neden yasaktır?'},
        {id:'h9', t:'textarea', h:'KURAL', s:'Bunny Hopping nedir? Polis koşarken zıplar mı?'},
        {id:'h10', t:'textarea', h:'KURAL', s:'Cop Baiting (Polis Kışkırtma) nedir?'},
        
        {id:'p1', t:'textarea', h:'PROSEDÜR', s:'10-20, 10-78 ve 10-99 kodlarının anlamları nelerdir?'},
        {id:'p2', t:'textarea', h:'PROSEDÜR', s:'Miranda Hakları nelerdir? Şüpheliye ne zaman okunur?'},
        {id:'p3', t:'textarea', h:'PROSEDÜR', s:'Üstünüz size mantıksız bir emir verirse ne yaparsınız?'},
        {id:'p4', t:'textarea', h:'PROSEDÜR', s:'Öldürücü güç (Silah) kullanma yetkiniz hangi durumlarda vardır?'},
        {id:'p5', t:'textarea', h:'PROSEDÜR', s:'Kelepçeleme prosedürü nasıldır? Önce kelepçe mi takılır, Miranda mı okunur?'},
        {id:'p6', t:'textarea', h:'PROSEDÜR', s:'Telsiz konuşma adabı nasıl olmalıdır?'},
        {id:'p7', t:'textarea', h:'PROSEDÜR', s:'Bir şüpheliyi araca bindirirken nelere dikkat etmelisiniz?'},
        {id:'p8', t:'textarea', h:'PROSEDÜR', s:'Departman aracını kullanırken nelere dikkat edersiniz?'},
        
        {id:'s1', t:'textarea', h:'SENARYO', s:'Trafik kontrolünde durdurduğunuz araçtan inen 4 kişi size silah çekti. Ne yaparsınız?'},
        {id:'s2', t:'textarea', h:'SENARYO', s:'Ortağınız çatışmada vuruldu ve yere düştü. Karşı ateş sürüyor. İlk hamleniz ne olur?'},
        {id:'s3', t:'textarea', h:'SENARYO', s:'Gözaltına aldığınız kişi size rüşvet teklif etti. Rolsel tepkiniz ne olur?'},
        {id:'s4', t:'textarea', h:'SENARYO', s:'Kovaladığınız şüpheli oyun hatası (bug) yüzünden havada uçmaya başladı. Ne yaparsınız?'},
        {id:'s5', t:'textarea', h:'SENARYO', s:'Amiriniz sivil hayatta illegal bir grupla iş birliği yaparken gördünüz. IC ne yaparsınız?'},
        {id:'s6', t:'textarea', h:'SENARYO', s:'Market soygununda rehine var ve müzakerecisiniz. İlk cümleniz ne olur?'},
        {id:'s7', t:'textarea', h:'SENARYO', s:'Hastanede yaralı bir şüpheliyi sorgulamanız lazım ama doktor izin vermiyor. Ne yaparsınız?'},
        {id:'s8', t:'textarea', h:'SENARYO', s:'Devriye sırasında sivil bir araç size kasten çarpıp kaçtı. Prosedür nedir?'},
        {id:'s9', t:'textarea', h:'SENARYO', s:'Karakol önünde eylem yapan sivil halka nasıl müdahale edersiniz?'},
        {id:'s10', t:'textarea', h:'SENARYO', s:'Bir ihbara gittiniz, olay yerinde 3 yaralı polis ve 5 silahlı şahıs var. Ne yaparsınız?'},
        
        {id:'e1', t:'textarea', h:'ETİK', s:'Agresif ve küfürbaz bir vatandaşı sakinleştirmek için nasıl konuşursunuz?'},
        {id:'e2', t:'textarea', h:'ETİK', s:'Polis üniforması sizin için neyi temsil eder?'},
        {id:'e3', t:'textarea', h:'ETİK', s:'Suçlu yakalamak mı önemlidir, sivil güvenliği mi? Neden?'},
        {id:'e4', t:'textarea', h:'SON SÖZ', s:'Ekibimize neden sizi almalıyız?'}
    ];

    // --- 3. KARIŞTIRMA VE SEÇME İŞLEMİ ---
    function sorulariHazirla() {
        // Havuzu karıştır (Shuffle)
        const karisikHavuz = havuz.sort(() => 0.5 - Math.random());
        // İlk 10 taneyi al
        const secilenSorular = karisikHavuz.slice(0, 10);
        // Sabit sorularla birleştir
        return [...sabitSorular, ...secilenSorular];
    }

    const q = sorulariHazirla(); // Artık 'q' değişkeni dinamik!
    
    let idx = 0; 
    let ans = {};
    let soruMetinleri = {}; // Admin paneli için soruları buraya kaydedeceğiz

    function render() {
        const item = q[idx];
        const box = document.getElementById('qBox');
        const bNext = document.getElementById('bNext');
        const bBack = document.getElementById('bBack');
        const count = document.getElementById('stepCount');
        
        let inputHTML = item.t === 'info' ? "" : (item.t==='textarea' ? `<textarea id="inp" placeholder="Cevabınızı detaylı yazınız..."></textarea>` : `<input type="${item.t}" id="inp" placeholder="Cevabınız...">`);
        
        box.innerHTML = `<div class="q-header">${item.h}</div><div class="q-text">${item.s}</div>${inputHTML}`;
        
        if(item.t !== 'info' && document.getElementById('inp')) {
            document.getElementById('inp').value = ans[item.id] || '';
            setTimeout(() => document.getElementById('inp').focus(), 100);
        }

        bBack.style.visibility = idx === 0 ? 'hidden' : 'visible';
        bNext.innerText = idx === 0 ? 'BAŞLA' : (idx === q.length-1 ? 'GÖNDER' : 'İLERİ');
        document.getElementById('pBar').style.width = ((idx / (q.length-1)) * 100) + '%';
        if(idx > 0) count.innerText = `${idx} / ${q.length - 1}`;
    }

    function nav(d) {
        if(d === 1 && idx > 0) {
            const val = document.getElementById('inp').value.trim();
            if(!val) return alert('Lütfen bu soruyu boş bırakmayınız!');
            ans[q[idx].id] = val;
            
            // ÖNEMLİ: Sorunun metnini de kaydediyoruz ki Admin panelinde sözlüğe gerek kalmasın!
            soruMetinleri[q[idx].id] = q[idx].s;
        }
        if(d === 1 && idx === q.length-1) return send();
        idx += d; render();
    }

    function send() {
        const btn = document.getElementById('bNext');
        btn.innerText = 'GÖNDERİLİYOR...'; btn.disabled = true;
        
        const data = { 
            discord_id: ans.discord_id, 
            ic_isim: ans.ic_isim, 
            ooc_yas: ans.ooc_yas, 
            durum: 'Beklemede', 
            tarih: new Date().toISOString(), 
            cevaplar: ans,
            soru_detaylari: soruMetinleri // <--- YENİ: Soru metinlerini de gönderiyoruz
        };
        
        database.ref('basvurular').push(data, (err) => {
            if(err) { alert("Hata: " + err.message); btn.disabled = false; return; }
            document.querySelector('.card').innerHTML = `
                <img src="egmm.png" class="logo" style="width:100px;">
                <h1 style="color:#28a745; margin-top:20px;">BAŞVURU İLETİLDİ ✅</h1>
                <p style="font-size:1.1rem; color:#eee;">Başvurunuz sisteme kaydedildi.<br>Sorular rastgele seçildiği için diğer adaylardan farklı olabilir.</p>
                <button onclick="window.location.href='index.html'" class="btn" style="background:#007bff; color:white; margin-top:30px;">Ana Sayfaya Dön</button>
            `;
        });
    }
    render();
</script>
</body>
</html>
