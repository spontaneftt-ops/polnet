<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Personel YÃ¶netim</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background: #162447; color: white; display: flex; flex-direction: column; padding: 20px; }
        .content { flex: 1; padding: 40px; overflow-y: auto; background: #eef2f5; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #1f4068; color: white; }
        .btn { padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer; color: white; margin-right: 5px; }
        .btn-green { background: #28a745; } .btn-red { background: #dc3545; } .btn-blue { background: #007bff; }
        
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #162447; z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 10px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        
        .tab-content { display: none; } .tab-content.active { display: block; }
        .menu-item { padding: 15px; cursor: pointer; color: #ccc; border-radius: 5px; margin-bottom: 5px; } 
        .menu-item:hover, .active-tab { color: white; background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h2 style="color:#162447; margin-bottom:5px;">YÃ–NETÄ°M PANELÄ°</h2>
        <p style="color:#777; font-size:0.9rem; margin-bottom:20px;">Personel Daire BaÅŸkanlÄ±ÄŸÄ±</p>
        
        <input type="text" id="kadi" class="login-input" placeholder="KullanÄ±cÄ± AdÄ±">
        <input type="password" id="sifre" class="login-input" placeholder="Åifre">
        
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; padding:12px; font-size:1.1rem; margin-top:10px; background:#162447;">GiriÅŸ Yap</button>
        <p id="loginMsg" style="color:#dc3545; margin-top:15px; font-weight:bold; font-size:0.9rem;"></p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <h2 style="color:#ffd700; text-align:center;">MÃœDÃœRLÃœK</h2>
        <div class="menu-item active-tab" onclick="tabDegistir('basvurularTab', this)">ğŸ“„ BaÅŸvurular</div>
        <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)">ğŸ‘®â€â™‚ï¸ Personel Listesi</div>
        <div class="menu-item" onclick="location.reload()" style="margin-top:auto; color:#e43f5a;">ğŸšª Ã‡Ä±kÄ±ÅŸ</div>
    </div>

    <div class="content">
        <div id="basvurularTab" class="tab-content active">
            <h2 style="color:#162447;">Gelen BaÅŸvurular</h2>
            <table>
                <thead><tr><th>Discord ID</th><th>IC Ä°sim</th><th>YaÅŸ</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead>
                <tbody id="basvuruListesi"></tbody>
            </table>
        </div>

        <div id="yoneticilerTab" class="tab-content">
            <h2 style="color:#162447;">Personel & YÃ¶netici Listesi</h2>
            <div style="background:white; padding:20px; border-radius:8px; display:flex; gap:10px; align-items:center;">
                <b style="color:#162447;">+ Yeni Personel:</b>
                <input type="text" id="yeniKadi" placeholder="KullanÄ±cÄ± AdÄ±" style="padding:8px; border:1px solid #ccc; border-radius:4px;">
                <input type="password" id="yeniSifre" placeholder="Åifre" style="padding:8px; border:1px solid #ccc; border-radius:4px;">
                <button onclick="yetkiliEkle()" class="btn btn-green" style="padding:8px 15px;">Ekle</button>
            </div>
            <table>
                <thead><tr><th>KullanÄ±cÄ±</th><th>Åifre</th><th>Ä°ÅŸlem</th></tr></thead>
                <tbody id="yoneticiListesi"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    function girisYap() {
        // KullanÄ±cÄ± hatasÄ±nÄ± Ã¶nlemek iÃ§in boÅŸluklarÄ± siliyoruz (.trim())
        const kadi = document.getElementById('kadi').value.trim();
        const sifre = document.getElementById('sifre').value.trim();

        // 1. MASTER KEY (VeritabanÄ± bozuk olsa bile bu ÅŸifreyle girilir)
        if (kadi === "MÃ¼dÃ¼r" && sifre === "GÃ¶kSancak1881") {
            panelAc();
            // VeritabanÄ±nda MÃ¼dÃ¼r yoksa, listeye ekle ki orada da gÃ¶zÃ¼ksÃ¼n
            database.ref('yetkililer').orderByChild('kadi').equalTo('MÃ¼dÃ¼r').once('value', s => {
                if(!s.exists()) database.ref('yetkililer').push({kadi: 'MÃ¼dÃ¼r', sifre: 'GÃ¶kSancak1881'});
            });
            return;
        }

        // 2. NORMAL YETKÄ°LÄ° GÄ°RÄ°ÅÄ°
        database.ref('yetkililer').orderByChild('kadi').equalTo(kadi).once('value', snapshot => {
            let girisBasarili = false;
            snapshot.forEach(child => { 
                if(child.val().sifre === sifre) girisBasarili = true; 
            });
            
            if (girisBasarili) panelAc();
            else document.getElementById('loginMsg').innerText = "HatalÄ± KullanÄ±cÄ± AdÄ± veya Åifre!";
        });
    }

    function panelAc() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'flex';
        verileriGetir();
        yoneticileriGetir();
    }

    function verileriGetir() {
        database.ref('basvurular').on('value', snapshot => {
            const liste = document.getElementById('basvuruListesi');
            liste.innerHTML = "";
            snapshot.forEach(child => {
                const data = child.val();
                let cevaplar = "";
                if(data.cevaplar) for(const [k, v] of Object.entries(data.cevaplar)) cevaplar += `${k}: ${v}\n\n`;
                
                let renk = data.durum === 'OnaylandÄ±' ? 'green' : (data.durum === 'Reddedildi' ? 'red' : 'orange');
                let durumYazi = data.durum === 'Beklemede' ? 'DEÄERLENDÄ°RÄ°LÄ°YOR' : data.durum;

                liste.innerHTML += `<tr>
                    <td>${data.discord_id}</td>
                    <td>${data.ic_isim}</td>
                    <td>${data.ooc_yas}</td>
                    <td style="color:${renk}; font-weight:bold;">${durumYazi}</td>
                    <td>
                        <button onclick="alert('${cevaplar}')" class="btn btn-blue">Ä°ncele</button>
                        <button onclick="dbGuncelle('basvurular/${child.key}', {durum:'OnaylandÄ±'})" class="btn btn-green">âœ“</button>
                        <button onclick="dbGuncelle('basvurular/${child.key}', {durum:'Reddedildi'})" class="btn btn-red">âœ—</button>
                    </td>
                </tr>`;
            });
        });
    }

    function yoneticileriGetir() {
        database.ref('yetkililer').on('value', snapshot => {
            const liste = document.getElementById('yoneticiListesi');
            liste.innerHTML = "";
            snapshot.forEach(child => {
                const d = child.val();
                let silBtn = d.kadi === 'MÃ¼dÃ¼r' ? 'ğŸ”’' : `<button onclick="dbSil('yetkililer/${child.key}')" class="btn btn-red">Sil</button>`;
                liste.innerHTML += `<tr><td>${d.kadi}</td><td>â€¢â€¢â€¢â€¢â€¢â€¢</td><td>${silBtn}</td></tr>`;
            });
        });
    }

    function yetkiliEkle() {
        const k = document.getElementById('yeniKadi').value.trim();
        const s = document.getElementById('yeniSifre').value.trim();
        if(k && s) { 
            database.ref('yetkililer').push({kadi: k, sifre: s});
            alert("Personel eklendi!");
            document.getElementById('yeniKadi').value = "";
            document.getElementById('yeniSifre').value = "";
        }
    }

    function dbGuncelle(yol, veri) { database.ref(yol).update(veri); }
    function dbSil(yol) { if(confirm('Silinsin mi?')) database.ref(yol).remove(); }
    
    function tabDegistir(id, el) {
        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active-tab');
    }
</script>
</body>
</html>
