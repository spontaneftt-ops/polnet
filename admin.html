<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Operasyon Merkezi v5</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://meet.jit.si/external_api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --bg-color: #f0f2f5; --text-color: #333; --sidebar-bg: #162447; --sidebar-text: white; --card-bg: white; --table-header: #1f4068; --accent: #3b82f6; }
        [data-theme="dark"] { --bg-color: #0f172a; --text-color: #e2e8f0; --sidebar-bg: #020617; --sidebar-text: #94a3b8; --card-bg: #1e293b; --table-header: #334155; --accent: #60a5fa; }
        
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; flex-direction: column; }
        
        /* BOLO ≈ûERƒ∞Dƒ∞ (YENƒ∞) */
        .bolo-ticker { background: #ef4444; color: white; padding: 5px; font-weight: bold; white-space: nowrap; overflow: hidden; position: relative; z-index: 10; font-size: 0.9rem; display: flex; align-items: center; }
        .bolo-content { display: inline-block; padding-left: 100%; animation: ticker 20s linear infinite; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; padding: 20px; z-index: 2; box-shadow: 2px 0 10px rgba(0,0,0,0.2); }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        
        .menu-item { padding: 12px 15px; cursor: pointer; color: inherit; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 0.95rem; }
        .menu-item:hover, .active-tab { background: rgba(255,255,255,0.1); color: #fff; transform: translateX(5px); border-left: 4px solid var(--accent); }
        
        .stats-container { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { flex: 1; background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; border-left: 5px solid #007bff; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(0,0,0,0.1); }
        th { background: var(--table-header); color: white; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; transition: 0.2s; display: inline-flex; align-items: center; gap: 5px; }
        .btn-green { background: #10b981; color: white; } .btn-red { background: #ef4444; color: white; } .btn-blue { background: #3b82f6; color: white; } .btn-dark { background: #374151; color: white; }
        .search-box { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 8px; background: var(--card-bg); color: var(--text-color); box-sizing: border-box; }

        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #0f172a; z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); margin: 2% auto; padding: 0; width: 70%; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; max-height: 90vh; }
        
        .tab-content { display: none; animation: fadeIn 0.3s; } .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .radio-room-container { display: flex; height: 70vh; gap: 20px; }
        .radio-control { width: 300px; background: var(--sidebar-bg); border-radius: 10px; display: flex; flex-direction: column; overflow: hidden; }
        .chat-area { flex: 1; background: var(--card-bg); border-radius: 10px; display: flex; flex-direction: column; border: 1px solid #ddd; }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px; border-radius: 8px; max-width: 80%; font-size: 0.9rem; }
        .msg-mine { align-self: flex-end; background: #3b82f6; color: white; }
        .msg-other { align-self: flex-start; background: #f1f5f9; color: #333; }

        #musicPlayer { position: absolute; z-index: 9999; background: rgba(22, 36, 71, 0.95); backdrop-filter: blur(10px); border: 1px solid #00f7ff; width: 320px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 247, 255, 0.3); bottom: 20px; right: 20px; overflow: hidden; transition: height 0.3s; }
        #musicHeader { padding: 10px; cursor: move; background: linear-gradient(90deg, #1f4068, #162447); color: #00f7ff; display: flex; justify-content: space-between; align-items: center; font-weight: bold; border-bottom: 1px solid #00f7ff; }
        .music-body { padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .minimized { height: 40px !important; overflow: hidden; }
        .hidden { display: none; }
        
        .rutbe-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .rutbe-mudur { background: #ef4444; color: white; } .rutbe-komiser { background: #f59e0b; color: white; } .rutbe-memur { background: #3b82f6; color: white; }

        /* GBT */
        .gbt-card { background: var(--card-bg); border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .aranma-var { border-left: 5px solid #ef4444; background: rgba(239, 68, 68, 0.1); }
        .aranma-yok { border-left: 5px solid #10b981; }
        .evidence-img { width: 100px; height: 60px; object-fit: cover; border-radius: 4px; cursor: pointer; transition: 0.2s; }
        .evidence-img:hover { transform: scale(1.5); box-shadow: 0 0 10px rgba(0,0,0,0.5); }

        /* CEZA HESAPLAMA (YENƒ∞) */
        .ceza-list { max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ceza-item { padding: 10px; background: rgba(0,0,0,0.05); border-radius: 5px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .ceza-item:hover { background: rgba(0,0,0,0.1); }
        .ceza-item input { margin-right: 10px; transform: scale(1.2); }
        .ceza-sonuc { margin-top: 20px; padding: 15px; background: #162447; color: white; border-radius: 8px; text-align: center; }
    </style>
</head>
<body>

<div class="bolo-ticker" id="boloTicker">
    <div style="background:black; padding:0 20px; z-index:11;">üö® BOLO (ACƒ∞L ARANANLAR):</div>
    <div class="bolo-content" id="boloText">≈ûu an aktif bir BOLO kaydƒ± bulunmamaktadƒ±r.</div>
    <div style="position:absolute; right:10px; z-index:11;"><button onclick="boloDuzenle()" class="btn btn-dark" style="padding:2px 5px; font-size:0.7rem;">D√úZENLE</button></div>
</div>

<div class="main-container">
    <div id="loginScreen">
        <div class="login-box">
            <img src="egmm.png" style="width:80px; margin-bottom:10px;">
            <h2 style="color:#1e293b; margin:0;">G√úVENLƒ∞K Gƒ∞Rƒ∞≈ûƒ∞</h2>
            <input type="text" id="kadi" class="login-input" style="width:100%; padding:10px; margin:5px 0;" placeholder="Kullanƒ±cƒ± Adƒ±">
            <input type="password" id="sifre" class="login-input" style="width:100%; padding:10px; margin:5px 0;" placeholder="≈ûifre">
            <button onclick="girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px;">Giri≈ü Yap</button>
            <p id="loginMsg" style="color:red; margin-top:10px;"></p>
        </div>
    </div>

    <div id="recordModal" class="modal">
        <div class="modal-content" style="width:50%;">
            <div style="padding:20px; background:var(--sidebar-bg); color:white; display:flex; justify-content:space-between;">
                <h3 style="margin:0" id="recordTitle">Kayƒ±t Ekle</h3>
                <span onclick="document.getElementById('recordModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span>
            </div>
            <div id="recordForm" style="padding:30px;"></div>
        </div>
    </div>

    <div id="cezaModal" class="modal">
        <div class="modal-content" style="width:60%;">
            <div style="padding:20px; background:var(--sidebar-bg); color:white; display:flex; justify-content:space-between;">
                <h3 style="margin:0">‚öñÔ∏è Ceza Hesaplama Sihirbazƒ±</h3>
                <span onclick="document.getElementById('cezaModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span>
            </div>
            <div style="padding:20px;">
                <div class="ceza-list" id="cezaListesi">
                    </div>
                <div class="ceza-sonuc">
                    <h2 id="toplamCeza">0 $ / 0 Ay</h2>
                    <p>Toplam Ceza Tutarƒ±</p>
                </div>
                <button onclick="cezaSifirla()" class="btn btn-red" style="width:100%; margin-top:10px;">SIFIRLA</button>
            </div>
        </div>
    </div>

    <div id="detayModal" class="modal">
        <div class="modal-content">
            <div style="padding:20px; background:var(--sidebar-bg); color:white; display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0" id="modalBaslik">Detay</h3>
                <div><button onclick="pdfYazdir()" class="btn btn-green">PDF</button><span onclick="document.getElementById('detayModal').style.display='none'" style="cursor:pointer; font-size:1.5rem; margin-left:15px;">&times;</span></div>
            </div>
            <div style="padding:30px; overflow-y:auto; flex:1; display:flex; gap:20px;">
                <div style="flex:2;" id="modalIcerik"></div>
                <div style="flex:1; border-left:1px solid rgba(0,0,0,0.1); padding-left:20px;">
                    <h4 style="margin-top:0;">üìã Notlar</h4>
                    <div id="noteList" style="height:150px; overflow-y:auto;"></div>
                    <textarea id="newNote" style="width:100%; height:60px; margin-top:5px;" placeholder="Not..."></textarea>
                    <button onclick="notEkle()" class="btn btn-blue" style="width:100%; margin-top:5px;">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <div id="musicPlayer">
        <div id="musicHeader"><span><i class="fas fa-broadcast-tower"></i> EGM MEDYA</span><div style="cursor:pointer;" onclick="toggleMusicPlayer()">_</div></div>
        <div class="music-body">
            <div style="display:flex; gap:5px;">
                <button class="btn btn-dark" style="flex:1; font-size:0.7rem;" onclick="radyoCal('https://dinle.trt.net.tr/mp3/radyohaber', 'TRT Haber')">üì° HABER</button>
                <button class="btn btn-dark" style="flex:1; font-size:0.7rem;" onclick="youtubeMod()">üì∫ YOUTUBE</button>
            </div>
            <div id="playerStatus" style="color:white; font-size:0.8rem; text-align:center;">Hazƒ±r</div>
            <audio id="radioPlayer" controls class="hidden" style="width:100%;"></audio>
            <div id="ytContainer" class="hidden">
                <input type="text" id="musicUrl" style="width:100%;" placeholder="Link...">
                <button onclick="youtubeCal()" class="btn btn-blue" style="width:100%;">A√á</button>
                <iframe id="ytPlayer" style="height:150px; margin-top:5px; width:100%;" src="" frameborder="0" allow="autoplay"></iframe>
            </div>
        </div>
    </div>

    <div id="adminPanel" style="display:none; width:100%;">
        <div class="sidebar">
            <div style="text-align:center; margin-bottom:20px;">
                <img src="egmm.png" style="width:50px;">
                <h3 style="margin:5px 0; font-size:1.1rem;">EGM MDT</h3>
                <span id="aktifKullaniciAdi" style="font-size:0.9rem; font-weight:bold; color:#60a5fa;"></span><br>
                <span id="aktifRutbeGoster" class="rutbe-badge"></span>
            </div>
            <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-home"></i> √ñzet</div>
            <div class="menu-item" onclick="tabDegistir('basvurularTab', this)"><i class="fas fa-file-alt"></i> Ba≈üvurular</div>
            <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-search"></i> GBT Sorgu</div>
            <div class="menu-item" onclick="cezaModalAc()"><i class="fas fa-calculator"></i> Ceza Hesapla</div>
            <div class="menu-item" onclick="tabDegistir('delilTab', this)"><i class="fas fa-fingerprint"></i> Kanƒ±t Odasƒ±</div>
            <div class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Ruhsat & Plaka</div>
            <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)"><i class="fas fa-users-cog"></i> Personel</div>
            <div class="menu-item" onclick="tabDegistir('sohbetTab', this)"><i class="fas fa-headset"></i> Komuta</div>
            <div class="menu-item" onclick="tabDegistir('ayarlarTab', this)"><i class="fas fa-cog"></i> Ayarlar</div>
            
            <div style="margin-top:auto;">
                <button onclick="mesaiBitirVeCikis()" class="btn btn-red" style="width:100%; justify-content:center;">√áIKI≈û</button>
            </div>
        </div>

        <div class="content">
            <div id="dashboardTab" class="tab-content active">
                <h2 style="margin-bottom:20px;">Genel Durum</h2>
                <div class="stats-container">
                    <div class="stat-card" style="border-color:#3b82f6;"><div class="stat-info"><h3 id="statToplam">0</h3><p>Ba≈üvuru</p></div><i class="fas fa-folder fa-2x"></i></div>
                    <div class="stat-card" style="border-color:#f59e0b;"><div class="stat-info"><h3 id="statAranan">0</h3><p>Aranan ≈ûahƒ±s</p></div><i class="fas fa-user-clock fa-2x"></i></div>
                    <div class="stat-card" style="border-color:#ef4444;"><div class="stat-info"><h3 id="statOlay">0</h3><p>A√ßƒ±k Dosya</p></div><i class="fas fa-file-contract fa-2x"></i></div>
                </div>
            </div>

            <div id="basvurularTab" class="tab-content">
                <div style="display:flex; justify-content:space-between;"><h2>Ba≈üvurular</h2><button onclick="excelIndir()" class="btn btn-green">Excel</button></div>
                <input type="text" id="basvuruAra" class="search-box" placeholder="üîç Ara..." onkeyup="tabloAra('basvuruAra', 'basvuruListesi')">
                <table><thead><tr><th>ID</th><th>ƒ∞sim</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="basvuruListesi"></tbody></table>
            </div>

            <div id="gbtTab" class="tab-content">
                <div style="display:flex; justify-content:space-between;"><h2>GBT SORGULAMA</h2> <button onclick="gbtEkleModal()" class="btn btn-blue">+ Kayƒ±t Ekle</button></div>
                <div style="background:var(--card-bg); padding:20px; border-radius:8px; margin-bottom:20px;">
                    <input type="text" id="gbtInput" class="search-box" placeholder="TC Kimlik (ID) veya ƒ∞sim Soyisim..." style="margin:0;">
                    <button onclick="gbtSorgula()" class="btn btn-green" style="margin-top:10px; width:100%;">SORGULA</button>
                </div>
                <div id="gbtSonucAlani"></div>
            </div>

            <div id="delilTab" class="tab-content">
                <div style="display:flex; justify-content:space-between;"><h2>KANIT ODASI</h2> <button onclick="delilEkleModal()" class="btn btn-blue">+ Dosya A√ß</button></div>
                <input type="text" id="delilAra" class="search-box" placeholder="Ara..." onkeyup="tabloAra('delilAra', 'delilListesi')">
                <table><thead><tr><th>Olay No</th><th>≈û√ºpheli</th><th>Kanƒ±t</th><th>A√ßƒ±klama</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="delilListesi"></tbody></table>
            </div>

            <div id="ruhsatTab" class="tab-content">
                <div style="display:flex; justify-content:space-between;"><h2>RUHSAT VE PLAKA</h2> <button onclick="ruhsatEkleModal()" class="btn btn-blue">+ Ekle</button></div>
                <input type="text" id="ruhsatAra" class="search-box" placeholder="Ara..." onkeyup="tabloAra('ruhsatAra', 'ruhsatListesi')">
                <table><thead><tr><th>Sahibi</th><th>Tip</th><th>Belge No</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="ruhsatListesi"></tbody></table>
            </div>

            <div id="yoneticilerTab" class="tab-content">
                <h2>Personel Listesi</h2>
                <div style="background:var(--card-bg); padding:15px; margin-bottom:20px; border-radius:8px;">
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="yeniKadi" placeholder="Kullanƒ±cƒ± Adƒ±" style="flex:1; padding:8px; border:1px solid #ccc;">
                        <input type="password" id="yeniSifre" placeholder="≈ûifre" style="flex:1; padding:8px; border:1px solid #ccc;">
                        <select id="yeniRutbe" style="padding:8px;"><option value="Memur">Memur</option><option value="Komiser">Komiser</option><option value="M√ºd√ºr">M√ºd√ºr</option></select>
                        <button onclick="yetkiliEkle()" class="btn btn-green">Ekle</button>
                    </div>
                </div>
                <table><thead><tr><th>Kullanƒ±cƒ±</th><th>R√ºtbe</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="yoneticiListesi"></tbody></table>
            </div>

            <div id="mesaiTab" class="tab-content">
                <h2>Mesai Kayƒ±tlarƒ±</h2>
                <table><thead><tr><th>Personel</th><th>Giri≈ü</th><th>√áƒ±kƒ±≈ü</th><th>S√ºre (Dk)</th></tr></thead><tbody id="mesaiListesi"></tbody></table>
            </div>

            <div id="ayarlarTab" class="tab-content">
                <h2>Ayarlar</h2>
                <div style="background:var(--card-bg); padding:20px; border-radius:8px;">
                    <label>Webhook URL:</label><input type="password" id="webhookUrl" class="search-box" onchange="webhookKaydet()">
                    <label>Canlƒ± Harita URL:</label><input type="text" id="mapUrlInput" class="search-box" onchange="mapUrlKaydet()">
                    <button onclick="temaDegistir()" class="btn btn-dark">Tema Deƒüi≈ütir</button>
                    <div id="noMapMsg" style="margin-top:10px; color:#aaa;">Harita: <a href="#" onclick="window.open(document.getElementById('mapUrlInput').value)">A√ß</a></div>
                </div>
                <h3 style="color:red;">Kara Liste</h3>
                <div style="display:flex; gap:10px;"><input type="text" id="yasakliID" placeholder="ID" class="search-box" style="margin:0;"><button onclick="yasakla()" class="btn btn-red">BAN</button></div>
                <table><thead><tr><th>ID</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="blacklistListesi"></tbody></table>
            </div>

            <div id="sohbetTab" class="tab-content">
                <h2>Komuta Kontrol</h2>
                <div class="radio-room-container">
                    <div class="radio-control">
                        <div style="padding:15px; text-align:center; color:#94a3b8; font-weight:bold; background:rgba(0,0,0,0.2);">TELSƒ∞Z</div>
                        <div style="padding:20px; text-align:center;"><button id="btnConnectRadio" onclick="telsizDurumDegistir()" class="btn btn-red" style="width:100%; border-radius:20px;">BAƒûLAN</button></div>
                        <div id="jitsi-embed-container" style="flex:1; background:black;"></div>
                    </div>
                    <div class="chat-area">
                        <div style="padding:15px; border-bottom:1px solid #ddd;">Yazƒ±lƒ± Kanal</div>
                        <div class="chat-messages" id="chatMessages"></div>
                        <div style="padding:15px; display:flex; gap:10px;">
                            <input type="text" id="chatInput" class="chat-input" placeholder="Mesaj..." style="flex:1;" onkeydown="enterBas(event)">
                            <button onclick="mesajGonder()" class="btn btn-blue">G√ñNDER</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    const SFX = { success: new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"), error: new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"), alert: new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"), click: new Audio("https://actions.google.com/sounds/v1/ui/click_on.ogg") };
    SFX.success.volume = 0.5; SFX.error.volume = 0.5; SFX.alert.volume = 0.4; SFX.click.volume = 0.2;

    let basvuruVerileri = {};
    let aktifKullanici = "";
    let aktifRutbe = "";
    let jitsiApi = null;
    let aktifBasvuruKey = null;
    let mesaiBaslangic = null;

    // --- CEZA KATALOƒûU (YENƒ∞) ---
    const cezaKatalogu = [
        {ad: "Hƒ±z Sƒ±nƒ±rƒ± ƒ∞hlali", para: 500, hapis: 0},
        {ad: "Kƒ±rmƒ±zƒ± I≈üƒ±kta Ge√ßme", para: 300, hapis: 0},
        {ad: "Ehliyetsiz Ara√ß Kullanma", para: 2000, hapis: 5},
        {ad: "Alkoll√º Ara√ß Kullanma", para: 5000, hapis: 10},
        {ad: "Kamu Malƒ±na Zarar", para: 3000, hapis: 15},
        {ad: "Polise Mukavemet", para: 10000, hapis: 30},
        {ad: "Silahlƒ± Soygun", para: 25000, hapis: 60},
        {ad: "Adam Yaralama", para: 15000, hapis: 45},
        {ad: "Uyu≈üturucu Ticareti", para: 50000, hapis: 100},
        {ad: "Cinayet", para: 100000, hapis: 999}
    ];

    window.onload = function() {
        const wh = localStorage.getItem('discordWebhook'); if(wh) document.getElementById('webhookUrl').value = wh;
        const mp = localStorage.getItem('mapUrl'); if(mp) document.getElementById('mapUrlInput').value = mp;
        if(localStorage.getItem('tema') === 'dark') document.body.setAttribute('data-theme', 'dark');
        boloGetir(); youtubeMod();
    }

    // --- BOLO Sƒ∞STEMƒ∞ (YENƒ∞) ---
    function boloDuzenle() {
        if(!yetkiKontrol(['M√ºd√ºr', 'Komiser'])) return;
        const yeniBolo = prompt("Yeni BOLO mesajƒ±nƒ± giriniz:");
        if(yeniBolo) {
            database.ref('bolo').set(yeniBolo);
        }
    }
    function boloGetir() {
        database.ref('bolo').on('value', s => {
            const txt = s.val() || "Aktif bir arama yok.";
            document.getElementById('boloText').innerText = txt;
        });
    }

    // --- CEZA Sƒ∞STEMƒ∞ (YENƒ∞) ---
    function cezaModalAc() {
        const list = document.getElementById('cezaListesi');
        list.innerHTML = "";
        cezaKatalogu.forEach((c, index) => {
            list.innerHTML += `
            <div class="ceza-item" onclick="cezaSec(${index}, this)">
                <input type="checkbox" id="cezaCheck${index}">
                <span>${c.ad}</span>
                <span style="font-size:0.8rem; color:gray;">$${c.para} / ${c.hapis} Ay</span>
            </div>`;
        });
        cezaSifirla();
        document.getElementById('cezaModal').style.display = 'block';
    }
    function cezaSec(index, div) {
        const cb = document.getElementById(`cezaCheck${index}`);
        cb.checked = !cb.checked;
        if(cb.checked) div.style.background = "#d1fae5"; else div.style.background = "rgba(0,0,0,0.05)";
        cezaHesapla();
    }
    function cezaHesapla() {
        let toplamPara = 0; let toplamHapis = 0;
        cezaKatalogu.forEach((c, i) => {
            if(document.getElementById(`cezaCheck${i}`).checked) {
                toplamPara += c.para;
                toplamHapis += c.hapis;
            }
        });
        document.getElementById('toplamCeza').innerText = `$${toplamPara} / ${toplamHapis} Ay`;
    }
    function cezaSifirla() {
        document.querySelectorAll('.ceza-item input').forEach(i => i.checked = false);
        document.querySelectorAll('.ceza-item').forEach(d => d.style.background = "rgba(0,0,0,0.05)");
        document.getElementById('toplamCeza').innerText = "$0 / 0 Ay";
    }

    // --- Gƒ∞Rƒ∞≈û ---
    function girisYap() {
        SFX.click.play();
        const k = document.getElementById('kadi').value.trim();
        const s = document.getElementById('sifre').value.trim();
        if (k === "M√ºd√ºr" && s === "G√∂kSancak1881") { database.ref('yetkililer').orderByChild('kadi').equalTo('M√ºd√ºr').once('value', x => { if(!x.exists()) database.ref('yetkililer').push({kadi: 'M√ºd√ºr', sifre: 'G√∂kSancak1881', rutbe:'M√ºd√ºr'}); }); basariliGiris(k, 'M√ºd√ºr'); return; }
        database.ref('yetkililer').orderByChild('kadi').equalTo(k).once('value', sn => { let f = false; let r = 'Memur'; sn.forEach(c => { if(c.val().sifre === s) { f = true; r = c.val().rutbe || 'Memur'; } }); if(f) basariliGiris(k, r); else { SFX.error.play(); document.getElementById('loginMsg').innerText = "Hatalƒ±!"; } });
    }

    function basariliGiris(isim, rutbe) {
        SFX.success.play(); aktifKullanici = isim; aktifRutbe = rutbe; mesaiBaslangic = Date.now();
        document.getElementById('aktifKullaniciAdi').innerText = isim; document.getElementById('aktifRutbeGoster').innerText = rutbe;
        document.getElementById('aktifRutbeGoster').className = `rutbe-badge rutbe-${rutbe.toLowerCase().replace('√º','u').replace('√∂','o')}`;
        document.getElementById('loginScreen').style.display = 'none'; document.getElementById('adminPanel').style.display = 'flex';
        logKaydet("Giri≈ü", `${isim} (${rutbe}) mesai ba≈üƒ±.`);
        verileriGetir(); yoneticileriGetir(); blacklistGetir(); mesaileriGetir(); chatBaslat(); gbtGetir(); delilGetir(); ruhsatGetir(); istatistikGuncelle();
    }

    function mesaiBitirVeCikis() { if(confirm("Mesai bitsin mi?")) { const b = Date.now(); const s = Math.floor((b-mesaiBaslangic)/60000); database.ref('mesai').push({personel:aktifKullanici, giris:mesaiBaslangic, cikis:b, sure:s}); location.reload(); } }
    function yetkiKontrol(izinler) { if (!izinler.includes(aktifRutbe)) { SFX.error.play(); alert("Yetkisiz!"); return false; } return true; }

    // --- GBT ---
    function gbtEkleModal() { document.getElementById('recordTitle').innerText = "Su√ß Kaydƒ± Ekle"; document.getElementById('recordForm').innerHTML = `<input id="gbt_id" placeholder="Vatanda≈ü ID / ƒ∞sim" class="search-box"><input id="gbt_suc" placeholder="Su√ß Tanƒ±mƒ±" class="search-box"><select id="gbt_durum" class="search-box"><option value="Temiz">Temiz</option><option value="Aranƒ±yor">ARANIYOR</option><option value="Tutuklu">Tutuklu</option></select><button onclick="gbtKaydet()" class="btn btn-green" style="width:100%">KAYDET</button>`; document.getElementById('recordModal').style.display = 'block'; }
    function gbtKaydet() { const id = document.getElementById('gbt_id').value; const suc = document.getElementById('gbt_suc').value; const dur = document.getElementById('gbt_durum').value; if(id && suc) { database.ref('gbt_kayitlari').push({vatandas:id, suc:suc, durum:dur, ekleyen:aktifKullanici, tarih:Date.now()}); document.getElementById('recordModal').style.display='none'; SFX.success.play(); } }
    function gbtSorgula() { const q = document.getElementById('gbtInput').value.toLowerCase(); const area = document.getElementById('gbtSonucAlani'); area.innerHTML = "Aranƒ±yor..."; database.ref('gbt_kayitlari').once('value', s => { area.innerHTML = ""; let bulundu = false; s.forEach(c => { const d = c.val(); if(d.vatandas.toLowerCase().includes(q)) { bulundu = true; let stil = d.durum === 'Aranƒ±yor' ? 'aranma-var' : 'aranma-yok'; area.innerHTML += `<div class="gbt-card ${stil}"><div><h3>${d.vatandas}</h3><p>${d.suc}</p><small>${new Date(d.tarih).toLocaleDateString()}</small></div><h2 style="color:${d.durum==='Aranƒ±yor'?'red':'green'}">${d.durum}</h2><button onclick="dbSil('gbt_kayitlari/${c.key}')" class="btn btn-red">Sil</button></div>`; } }); if(!bulundu) area.innerHTML = "<p>Kayƒ±t bulunamadƒ±. Temiz.</p>"; else SFX.alert.play(); }); }
    function gbtGetir() { }

    // --- DELƒ∞L ---
    function delilEkleModal() { document.getElementById('recordTitle').innerText = "Dosya A√ß"; document.getElementById('recordForm').innerHTML = `<input id="delil_no" placeholder="Olay No" class="search-box"><input id="delil_supheli" placeholder="≈û√ºpheli" class="search-box"><input id="delil_img" placeholder="Resim Linki" class="search-box"><textarea id="delil_aciklama" class="search-box" style="height:100px" placeholder="Olay Detayƒ±"></textarea><button onclick="delilKaydet()" class="btn btn-green" style="width:100%">DOSYAYI A√á</button>`; document.getElementById('recordModal').style.display = 'block'; }
    function delilKaydet() { const no = document.getElementById('delil_no').value; const sup = document.getElementById('delil_supheli').value; const img = document.getElementById('delil_img').value; const acik = document.getElementById('delil_aciklama').value; if(no) { database.ref('delil_dosyalari').push({no:no, supheli:sup, img:img, aciklama:acik}); document.getElementById('recordModal').style.display='none'; SFX.success.play(); } }
    function delilGetir() { database.ref('delil_dosyalari').on('value', s => { const l = document.getElementById('delilListesi'); l.innerHTML = ""; let sayi = 0; s.forEach(c => { const d = c.val(); sayi++; l.innerHTML += `<tr><td>${d.no}</td><td>${d.supheli}</td><td>${d.img ? `<a href="${d.img}" target="_blank"><img src="${d.img}" class="evidence-img"></a>` : 'Yok'}</td><td>${d.aciklama}</td><td><button onclick="dbSil('delil_dosyalari/${c.key}')" class="btn btn-red">Ar≈üivle</button></td></tr>`; }); document.getElementById('statOlay').innerText = sayi; }); }

    // --- RUHSAT ---
    function ruhsatEkleModal() { document.getElementById('recordTitle').innerText = "Ruhsat Ver"; document.getElementById('recordForm').innerHTML = `<input id="ruhsat_sahip" placeholder="Ad Soyad / ID" class="search-box"><select id="ruhsat_tip" class="search-box"><option value="Silah">Silah Ruhsatƒ±</option><option value="Ehliyet">S√ºr√ºc√º Belgesi</option><option value="Plaka">Ara√ß Plakasƒ±</option></select><input id="ruhsat_no" placeholder="Seri No / Plaka" class="search-box"><button onclick="ruhsatKaydet()" class="btn btn-green" style="width:100%">OLU≈ûTUR</button>`; document.getElementById('recordModal').style.display = 'block'; }
    function ruhsatKaydet() { const sah = document.getElementById('ruhsat_sahip').value; const tip = document.getElementById('ruhsat_tip').value; const no = document.getElementById('ruhsat_no').value; if(sah) { database.ref('ruhsat_kayitlari').push({sahip:sah, tip:tip, no:no, durum:'Aktif'}); document.getElementById('recordModal').style.display='none'; SFX.success.play(); } }
    function ruhsatGetir() { database.ref('ruhsat_kayitlari').on('value', s => { const l = document.getElementById('ruhsatListesi'); l.innerHTML = ""; s.forEach(c => { const d = c.val(); l.innerHTML += `<tr><td>${d.sahip}</td><td>${d.tip}</td><td>${d.no}</td><td><span style="color:green">Aktif</span></td><td><button onclick="dbSil('ruhsat_kayitlari/${c.key}')" class="btn btn-red">ƒ∞ptal Et</button></td></tr>`; }); }); }

    // --- STANDART ---
    function istatistikGuncelle() { database.ref('gbt_kayitlari').orderByChild('durum').equalTo('Aranƒ±yor').on('value', s => { document.getElementById('statAranan').innerText = s.numChildren(); }); database.ref('basvurular').on('value', s => { document.getElementById('statToplam').innerText = s.numChildren(); }); }
    function onayla(k) { if(!yetkiKontrol(['M√ºd√ºr', 'Komiser'])) return; if(confirm("Onay?")) { database.ref('basvurular/'+k).update({durum:'Onaylandƒ±'}); logKaydet("Onay", basvuruVerileri[k].discord_id); SFX.success.play(); } }
    function reddet(k) { if(!yetkiKontrol(['M√ºd√ºr', 'Komiser'])) return; let s = prompt("Sebep?"); if(s) { database.ref('basvurular/'+k).update({durum:'Reddedildi', red_sebebi:s}); logKaydet("Red", s); SFX.error.play(); } }
    function dbSil(y) { if(!yetkiKontrol(['M√ºd√ºr'])) return; if(confirm("Sil?")) { database.ref(y).remove(); logKaydet("Silme", y); SFX.error.play(); } }
    function logKaydet(i, d) { database.ref('logs').push({ zaman: firebase.database.ServerValue.TIMESTAMP, yonetici: aktifKullanici, islem: i, detay: d }); }
    function loglariGetir() { database.ref('logs').limitToLast(50).on('value', s => { const l = document.getElementById('logListesi'); l.innerHTML = ""; let a = []; s.forEach(c => a.push(c.val())); a.reverse().forEach(log => { let t = new Date(log.zaman).toLocaleString('tr-TR'); l.innerHTML += `<tr><td><small>${t}</small></td><td><b>${log.yonetici}</b></td><td>${log.islem}</td><td>${log.detay}</td></tr>`; }); }); }
    function mesaileriGetir() { database.ref('mesai').limitToLast(50).on('value', s => { const l = document.getElementById('mesaiListesi'); l.innerHTML = ""; let a = []; s.forEach(c => a.push(c.val())); a.reverse().forEach(m => { l.innerHTML += `<tr><td>${m.personel}</td><td>${new Date(m.giris).toLocaleTimeString()}</td><td>${new Date(m.cikis).toLocaleTimeString()}</td><td>${m.sure} Dk</td></tr>`; }); }); }
    function verileriGetir() { database.ref('basvurular').on('value', s => { const l = document.getElementById('basvuruListesi'); l.innerHTML = ""; basvuruVerileri = {}; s.forEach(c => { const d = c.val(); const k = c.key; basvuruVerileri[k] = d; let renk = d.durum==='Onaylandƒ±'?'green':(d.durum==='Reddedildi'?'red':'orange'); l.innerHTML += `<tr><td>${d.discord_id}</td><td>${d.ic_isim}</td><td style="color:${renk}; font-weight:bold;">${d.durum}</td><td><button onclick="detayAc('${k}')" class="btn btn-blue">üëÅÔ∏è</button><button onclick="onayla('${k}')" class="btn btn-green">‚úì</button><button onclick="reddet('${k}')" class="btn btn-red">‚úó</button><button onclick="dbSil('basvurular/${k}')" class="btn btn-dark">üóëÔ∏è</button></td></tr>`; }); }); }
    function detayAc(k) { SFX.click.play(); aktifBasvuruKey = k; const d = basvuruVerileri[k]; let h = ""; if(d.cevaplar) { for(let [x,y] of Object.entries(d.cevaplar)) h+=`<div><b>${x}:</b> ${y}</div><hr>`; } document.getElementById('modalIcerik').innerHTML = h; const nl = document.getElementById('noteList'); nl.innerHTML = "Y√ºkleniyor..."; database.ref('basvurular/' + k + '/yonetici_notlari').on('value', snap => { nl.innerHTML = ""; if(!snap.exists()) return; snap.forEach(c => { let n = c.val(); nl.innerHTML += `<div style="border-bottom:1px solid #eee; padding:5px;"><b style="color:#3b82f6;">${n.yazan}:</b> ${n.mesaj}</div>`; }); }); document.getElementById('detayModal').style.display='block'; }
    function notEkle() { const t = document.getElementById('newNote').value.trim(); if(t && aktifBasvuruKey) { database.ref('basvurular/'+aktifBasvuruKey+'/yonetici_notlari').push({yazan:aktifKullanici, mesaj:t}); document.getElementById('newNote').value=""; } }
    function pdfYazdir() { const d = basvuruVerileri[aktifBasvuruKey]; let w = window.open('','','width=800,height=900'); w.document.write(`<html><head><title>${d.ic_isim}</title><style>body{font-family:monospace;padding:40px;}h1{text-align:center;border-bottom:2px solid black;}</style></head><body><h1>EGM PERSONEL DOSYASI</h1><p><b>ID:</b> ${d.discord_id}</p><p><b>ƒ∞Sƒ∞M:</b> ${d.ic_isim}</p><p><b>DURUM:</b> ${d.durum}</p><hr>${document.getElementById('modalIcerik').innerHTML}<script>window.print()<\/script></body></html>`); w.document.close(); }
    function yoneticileriGetir() { database.ref('yetkililer').on('value', s => { const l = document.getElementById('yoneticiListesi'); l.innerHTML=""; s.forEach(c => { let d = c.val(); let del = (aktifKullanici==='M√ºd√ºr' && d.kadi!=='M√ºd√ºr') ? `<button onclick="dbSil('yetkililer/${c.key}')" class="btn btn-red">Sil</button>` : 'üîí'; l.innerHTML += `<tr><td>${d.kadi}</td><td>${d.rutbe||'Memur'}</td><td>${del}</td></tr>`; }); }); }
    function yetkiliEkle() { if(!yetkiKontrol(['M√ºd√ºr'])) return; let k = document.getElementById('yeniKadi').value; let s = document.getElementById('yeniSifre').value; let r = document.getElementById('yeniRutbe').value; if(k&&s) { database.ref('yetkililer').push({kadi:k, sifre:s, rutbe:r}); SFX.success.play(); alert("Eklendi."); } }
    function yasakla() { const i = document.getElementById('yasakliID').value.trim(); if(i) { database.ref('blacklist').push({ discord_id: i }); alert("Yasaklandƒ±"); } }
    function blacklistGetir() { database.ref('blacklist').on('value', s => { const l = document.getElementById('blacklistListesi'); l.innerHTML=""; s.forEach(c => l.innerHTML += `<tr><td>${c.val().discord_id}</td><td><button onclick="dbSil('blacklist/${c.key}')" class="btn btn-red">Sil</button></td></tr>`); }); }
    
    // Helpers
    function tabloAra(i, t) { let v = document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r => r.style.display = r.innerText.toLowerCase().includes(v) ? '' : 'none'); }
    function webhookKaydet() { localStorage.setItem('discordWebhook', document.getElementById('webhookUrl').value); }
    function mapUrlKaydet() { localStorage.setItem('mapUrl', document.getElementById('mapUrlInput').value); location.reload(); }
    function temaDegistir() { if(document.body.getAttribute('data-theme')==='dark') { document.body.removeAttribute('data-theme'); localStorage.setItem('tema','light'); } else { document.body.setAttribute('data-theme','dark'); localStorage.setItem('tema','dark'); } }
    function tabDegistir(i, e) { SFX.click.play(); document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(i).classList.add('active'); e.classList.add('active-tab'); }
    function excelIndir() { let h = document.getElementById("basvuruListesi").outerHTML; let b = new Blob(["\ufeff", "<table>"+h+"</table>"], {type:"application/vnd.ms-excel"}); let a = document.createElement("a"); a.href = URL.createObjectURL(b); a.download="liste.xls"; a.click(); }
    
    dragElement(document.getElementById("musicPlayer")); function toggleMusicPlayer() { document.getElementById("musicPlayer").classList.toggle("minimized"); SFX.click.play(); }
    function radyoCal(u, n) { document.getElementById("playerStatus").innerText="√áalƒ±yor: "+n; document.getElementById("ytContainer").classList.add("hidden"); const a=document.getElementById("radioPlayer"); a.src=u; a.classList.remove("hidden"); a.play().catch(e=>alert("Hata")); }
    function youtubeMod() { document.getElementById("playerStatus").innerText="Mod: YouTube"; document.getElementById("radioPlayer").pause(); document.getElementById("radioPlayer").classList.add("hidden"); document.getElementById("ytContainer").classList.remove("hidden"); }
    function youtubeCal() { const u=document.getElementById('musicUrl').value; const m=u.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/); if(m&&m[2].length===11) document.getElementById('ytPlayer').src=`https://www.youtube.com/embed/${m[2]}?autoplay=1`; else alert("Link Hatalƒ±"); }
    function dragElement(e){var n=0,t=0,o=0,l=0;function u(e){(e=e||window.event).preventDefault(),o=e.clientX,l=e.clientY,document.onmouseup=d,document.onmousemove=m}function m(u){(u=u||window.event).preventDefault(),n=o-u.clientX,t=l-u.clientY,o=u.clientX,l=u.clientY,e.style.top=e.offsetTop-t+"px",e.style.left=e.offsetLeft-n+"px"}function d(){document.onmouseup=null,document.onmousemove=null}document.getElementById("musicHeader").onmousedown=u}
    function telsizDurumDegistir() { const b = document.getElementById('btnConnectRadio'); const c = document.getElementById('jitsi-embed-container'); if(jitsiApi) { jitsiApi.dispose(); jitsiApi=null; b.innerText="BAƒûLAN"; b.classList.remove('btn-green'); b.classList.add('btn-red'); c.innerHTML=""; } else { b.innerText="AYRIL"; b.classList.remove('btn-red'); b.classList.add('btn-green'); jitsiApi = new JitsiMeetExternalAPI("meet.jit.si", { roomName: "EGM_Ozel_Kanal_2024", width: "100%", height: "100%", parentNode: c, configOverwrite: { startWithAudioMuted: false, startWithVideoMuted: true, prejoinPageEnabled: false }, userInfo: { displayName: aktifKullanici } }); } }
    function chatBaslat() { database.ref('chat').limitToLast(50).on('child_added', s => { const d = s.val(); let div = document.getElementById('chatMessages'); let cls = d.gonderen===aktifKullanici ? 'msg-mine' : 'msg-other'; div.innerHTML += `<div class="message ${cls}"><b>${d.gonderen}:</b> ${d.mesaj}</div>`; div.scrollTop = div.scrollHeight; if(d.gonderen!==aktifKullanici) SFX.alert.play().catch(e=>{}); }); }
    function mesajGonder() { let i = document.getElementById('chatInput'); if(i.value.trim()) { database.ref('chat').push({gonderen:aktifKullanici, mesaj:i.value.trim(), zaman:firebase.database.ServerValue.TIMESTAMP}); i.value=""; } }
    function enterBas(e) { if(e.key==='Enter') mesajGonder(); }
</script>
</body>
</html>
