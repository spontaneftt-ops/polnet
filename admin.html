<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Operasyon Merkezi v9</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://meet.jit.si/external_api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --bg-color: #0f172a; --text-color: #e2e8f0; --sidebar-bg: #020617; --sidebar-text: #94a3b8; --card-bg: #1e293b; --table-header: #334155; --accent: #3b82f6; --alert-color: #ef4444; }
        
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; flex-direction: column; }
        
        /* BOLO */
        .bolo-ticker { background: #ef4444; color: white; padding: 5px; font-weight: bold; white-space: nowrap; overflow: hidden; position: relative; z-index: 10; font-size: 0.9rem; display: flex; align-items: center; }
        .bolo-content { display: inline-block; padding-left: 100%; animation: ticker 25s linear infinite; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; padding: 20px; z-index: 2; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        
        .menu-item { padding: 12px 15px; cursor: pointer; color: inherit; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 0.95rem; }
        .menu-item:hover, .active-tab { background: rgba(255,255,255,0.1); color: #fff; transform: translateX(5px); border-left: 4px solid var(--accent); }
        
        .stats-container { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { flex: 1; background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: space-between; border-left: 5px solid #007bff; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); }
        th { background: var(--table-header); color: white; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-red { background: #ef4444; } .btn-green { background: #10b981; } .btn-blue { background: #3b82f6; } .btn-dark { background: #334155; } .btn-yellow { background: #f59e0b; color: #000; }
        
        .search-box { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.2); color: white; box-sizing: border-box; }

        /* Login & Modal */
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: #1e293b; padding: 40px; border-radius: 15px; width: 350px; text-align: center; border: 1px solid #334155; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #444; border-radius: 6px; background: #0f172a; color: white; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); margin: 2% auto; padding: 0; width: 70%; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; max-height: 90vh; border: 1px solid rgba(255,255,255,0.1); }
        .tab-content { display: none; animation: fadeIn 0.3s; } .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* TRAFÄ°K SÄ°STEMÄ° (YENÄ°) */
        .plate-card { background: var(--card-bg); border: 2px solid #444; border-radius: 10px; padding: 20px; text-align: center; position: relative; max-width: 300px; margin: 0 auto 20px auto; }
        .plate-text { font-family: 'Courier New', monospace; font-size: 2.5rem; font-weight: bold; background: white; color: black; padding: 5px 20px; border: 2px solid black; border-radius: 5px; display: inline-block; margin-bottom: 10px; }
        .plate-status { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; }
        .status-clean { color: #10b981; } .status-stolen { color: #ef4444; animation: flash 1s infinite; } .status-impounded { color: #f59e0b; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* HIZLI NOT DEFTERÄ° (YENÄ°) */
        #quickNotepad { position: fixed; bottom: 20px; right: 20px; width: 250px; background: var(--card-bg); border: 1px solid var(--accent); border-radius: 8px; z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); overflow: hidden; transition: 0.3s; }
        #notepadHeader { background: var(--accent); padding: 8px; cursor: pointer; font-weight: bold; font-size: 0.9rem; display: flex; justify-content: space-between; }
        #notepadArea { width: 100%; height: 150px; background: rgba(0,0,0,0.3); border: none; padding: 10px; color: white; resize: none; box-sizing: border-box; font-family: monospace; }
        .notepad-min { height: 35px !important; }

        /* Delil KartlarÄ± */
        .evidence-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .evidence-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; transition: 0.3s; }
        .evidence-img-container { width: 100%; height: 150px; background: #000; overflow: hidden; cursor: pointer; }
        .evidence-img-container img { width: 100%; height: 100%; object-fit: cover; }
        .evidence-body { padding: 15px; }

        /* GBT & Ceza */
        .gbt-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .ceza-list { max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ceza-item { padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .ceza-item:hover { background: rgba(255,255,255,0.05); }
        .rutbe-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; background: #334155; }

        /* Telsiz */
        .radio-room-container { display: flex; height: 70vh; gap: 20px; }
        .radio-control { width: 300px; background: var(--sidebar-bg); border-radius: 10px; display: flex; flex-direction: column; overflow: hidden; }
        .chat-area { flex: 1; background: var(--card-bg); border-radius: 10px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px; border-radius: 8px; max-width: 80%; font-size: 0.9rem; }
        .msg-mine { align-self: flex-end; background: #3b82f6; color: white; }
        .msg-other { align-self: flex-start; background: #f1f5f9; color: #333; }

        /* MÃ¼zik */
        #musicPlayer { position: absolute; z-index: 9999; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); border: 1px solid var(--accent); width: 320px; border-radius: 10px; bottom: 20px; right: 280px; overflow: hidden; transition: 0.3s; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="bolo-ticker" id="boloTicker">
    <div style="background:rgba(0,0,0,0.5); padding:0 20px; z-index:11;">ğŸš¨ BOLO:</div>
    <div class="bolo-content" id="boloText">Sistem aktif.</div>
    <div style="position:absolute; right:10px; z-index:11;"><button onclick="boloDuzenle()" class="btn btn-dark" style="padding:2px 5px; font-size:0.7rem;">GÃœNCELLE</button></div>
</div>

<div id="loginScreen">
    <div class="login-box">
        <h2 style="color:white; margin:0; letter-spacing:2px;">EGM GÃ–Z</h2>
        <p style="color:#64748b;">Operasyonel Veri TabanÄ±</p>
        <input type="text" id="kadi" class="login-input" placeholder="KullanÄ±cÄ± AdÄ±">
        <input type="password" id="sifre" class="login-input" placeholder="Åifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px;">SÄ°STEME GÄ°R</button>
        <p id="loginMsg" style="color:red; margin-top:10px;"></p>
    </div>
</div>

<div id="trafficModal" class="modal">
    <div class="modal-content" style="width:50%;">
        <div style="padding:20px; background:var(--sidebar-bg); display:flex; justify-content:space-between;">
            <h3 style="margin:0">ğŸš” AraÃ§ Sorgu & Ä°ÅŸlem</h3>
            <span onclick="document.getElementById('trafficModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span>
        </div>
        <div style="padding:30px; text-align:center;">
            <div id="trafficResult">
                </div>
        </div>
    </div>
</div>

<div id="recordModal" class="modal"><div class="modal-content" style="width:50%;"><div style="padding:20px; background:var(--sidebar-bg); display:flex; justify-content:space-between;"><h3 style="margin:0">ğŸ“ KanÄ±t DosyasÄ±</h3><span onclick="document.getElementById('recordModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div style="padding:30px;"><input id="delil_no" class="search-box" placeholder="Dosya No"><input id="delil_supheli" class="search-box" placeholder="ÅÃ¼pheli"><input id="delil_img" class="search-box" placeholder="GÃ¶rsel URL"><textarea id="delil_aciklama" class="search-box" style="height:100px;" placeholder="Detay..."></textarea><button onclick="delilKaydet()" class="btn btn-green" style="width:100%">OLUÅTUR</button></div></div></div>

<div class="main-container" id="adminPanel" style="display:none;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px;">
            <h3 style="margin:5px 0; color:var(--accent);">OPERASYON</h3>
            <span id="aktifKullaniciAdi" style="font-size:0.9rem; font-weight:bold;"></span><br>
            <span id="aktifRutbeGoster" class="rutbe-badge"></span>
        </div>
        <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-line"></i> Ã–zet</div>
        <div class="menu-item" onclick="tabDegistir('trafficTab', this)"><i class="fas fa-car"></i> Trafik & AraÃ§</div>
        <div class="menu-item" onclick="tabDegistir('delilTab', this)"><i class="fas fa-folder-open"></i> Delil & KanÄ±t</div>
        <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-search"></i> GBT Sorgu</div>
        <div class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book"></i> Ceza KÄ±lavuzu</div>
        <div class="menu-item" onclick="cezaModalAc()"><i class="fas fa-gavel"></i> Ceza Kes</div>
        <div class="menu-item" onclick="tabDegistir('basvurularTab', this)"><i class="fas fa-file-contract"></i> BaÅŸvurular</div>
        <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)"><i class="fas fa-users"></i> Personel</div>
        <div class="menu-item" onclick="tabDegistir('sohbetTab', this)"><i class="fas fa-walkie-talkie"></i> Telsiz</div>
        
        <div style="margin-top:auto;">
            <button onclick="cikisYap()" class="btn btn-red" style="width:100%;">Ã‡IKIÅ</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <div class="stats-container">
                <div class="stat-card"><h3 id="statToplam">0</h3><p>BaÅŸvuru</p></div>
                <div class="stat-card"><h3 id="statAranan">0</h3><p>Aranan</p></div>
                <div class="stat-card"><h3 id="statOlay">0</h3><p>Dosya</p></div>
            </div>
        </div>

        <div id="trafficTab" class="tab-content">
            <h2>ğŸš” Trafik Åube & Ã‡alÄ±ntÄ± AraÃ§</h2>
            <div style="background:var(--card-bg); padding:20px; border-radius:8px; margin-bottom:20px; display:flex; gap:10px;">
                <input type="text" id="plakaInput" class="search-box" placeholder="PLAKA GÄ°RÄ°NÄ°Z (Ã–rn: 34 ABC 12)" style="margin:0; text-transform:uppercase; font-family:monospace; font-size:1.2rem; text-align:center;">
                <button onclick="plakaSorgula()" class="btn btn-green" style="width:150px;">SORGULA</button>
            </div>
            
            <h3 style="margin-top:30px;">Son Ä°ÅŸlem YapÄ±lan AraÃ§lar</h3>
            <table id="aracListesiTablo">
                <thead><tr><th>Plaka</th><th>Durum</th><th>Not</th><th>Ä°ÅŸlemi Yapan</th></tr></thead>
                <tbody id="aracListesiBody"></tbody>
            </table>
        </div>

        <div id="delilTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><h2>ğŸ“ Delil & KanÄ±t</h2><button onclick="delilEkleModal()" class="btn btn-blue">+ YENÄ° DOSYA</button></div>
            <input type="text" id="delilAra" class="search-box" placeholder="Ara..." onkeyup="delilFiltrele()">
            <div class="evidence-grid" id="evidenceGrid"></div>
        </div>

        <div id="gbtTab" class="tab-content"><h2>GBT Sorgulama</h2><div style="background:var(--card-bg); padding:20px; border-radius:8px; margin-bottom:20px;"><input type="text" id="gbtInput" class="search-box" placeholder="Kimlik/Ä°sim..."><button onclick="gbtSorgula()" class="btn btn-green" style="width:100%;">SORGULA</button></div><div id="gbtSonucAlani"></div></div>
        
        <div id="cezaRehberTab" class="tab-content"><h2>TCK Rehberi</h2><input type="text" id="rehberAra" class="search-box" placeholder="SuÃ§ ara..." onkeyup="tabloAra('rehberAra', 'rehberListesi')"><table><thead><tr><th>SuÃ§</th><th>Para</th><th>Kamu</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="rehberListesi"></tbody></table></div>
        <div id="basvurularTab" class="tab-content"><h2>BaÅŸvurular</h2><button onclick="excelIndir()" class="btn btn-green" style="float:right;">Excel</button><input type="text" id="basvuruAra" class="search-box" placeholder="Ara..." onkeyup="tabloAra('basvuruAra', 'basvuruListesi')"><table><thead><tr><th>ID</th><th>Ä°sim</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="basvuruListesi"></tbody></table></div>
        <div id="yoneticilerTab" class="tab-content"><h2>Personel</h2><div style="display:flex; gap:10px; margin-bottom:10px;"><input id="yeniKadi" class="search-box" placeholder="KullanÄ±cÄ±"><input id="yeniSifre" class="search-box" placeholder="Åifre"><select id="yeniRutbe" class="search-box"><option>Memur</option><option>Komiser</option><option>MÃ¼dÃ¼r</option></select><button onclick="yetkiliEkle()" class="btn btn-green">Ekle</button></div><table><thead><tr><th>KullanÄ±cÄ±</th><th>RÃ¼tbe</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="yoneticiListesi"></tbody></table></div>
        <div id="sohbetTab" class="tab-content"><h2>Komuta</h2><div class="radio-room-container"><div class="radio-control"><div style="padding:20px; text-align:center;"><button id="btnConnectRadio" onclick="telsizDurumDegistir()" class="btn btn-red" style="width:100%;">BAÄLAN</button></div><div id="jitsi-embed-container" style="flex:1; background:black;"></div></div><div class="chat-area"><div class="chat-messages" id="chatMessages"></div><div style="padding:15px; display:flex; gap:10px;"><input type="text" id="chatInput" class="search-box" style="margin:0;" onkeydown="enterBas(event)"><button onclick="mesajGonder()" class="btn btn-blue">GÃ–NDER</button></div></div></div></div>
    </div>
</div>

<div id="quickNotepad">
    <div id="notepadHeader" onclick="toggleNotepad()">ğŸ“ HÄ±zlÄ± Not <span id="noteToggleIcon">_</span></div>
    <textarea id="notepadArea" placeholder="Plaka, isim, not al... (Otomatik Kaydedilir)" oninput="notuKaydetLocal()"></textarea>
</div>

<div id="cezaModal" class="modal"><div class="modal-content" style="width:60%;"><div style="padding:20px; display:flex; justify-content:space-between;"><h3>âš–ï¸ CEZA SÄ°STEMÄ°</h3><span onclick="document.getElementById('cezaModal').style.display='none'" style="cursor:pointer;">X</span></div><div style="padding:20px;"><input id="ceza_suclu_adi" class="search-box" placeholder="SuÃ§lu AdÄ±..."><div id="cezaListesi" class="ceza-list"></div><h2 id="toplamCeza" style="text-align:center; margin:20px 0;">0 TL</h2><button onclick="cezayiKesVeIsle()" class="btn btn-red" style="width:100%;">GBT'YE Ä°ÅLE</button></div></div></div>
<div id="detayModal" class="modal"><div class="modal-content"><div style="padding:20px; display:flex; justify-content:space-between;"><h3>Detay</h3><span onclick="document.getElementById('detayModal').style.display='none'" style="cursor:pointer;">X</span></div><div style="padding:30px;" id="modalIcerik"></div></div></div>

<div id="musicPlayer"><div id="musicHeader" style="padding:10px; background:var(--sidebar-bg); cursor:move; display:flex; justify-content:space-between;"><span>ğŸ”Š EGM MEDYA</span><span onclick="toggleMusicPlayer()" style="cursor:pointer;">_</span></div><div class="music-body" style="padding:10px;"><div style="display:flex; gap:5px;"><button onclick="radyoCal('https://dinle.trt.net.tr/mp3/radyohaber', 'Haber')" class="btn btn-dark" style="flex:1; font-size:0.7rem;">HABER</button><button onclick="youtubeMod()" class="btn btn-dark" style="flex:1; font-size:0.7rem;">YOUTUBE</button></div><div id="playerStatus" style="font-size:0.8rem; text-align:center; color:#aaa;">HazÄ±r</div><audio id="radioPlayer" controls class="hidden" style="width:100%;"></audio><div id="ytContainer" class="hidden"><input id="musicUrl" class="search-box" style="padding:5px; height:30px;" placeholder="Link..."><button onclick="youtubeCal()" class="btn btn-blue" style="width:100%; padding:5px;">AÃ‡</button><iframe id="ytPlayer" style="width:100%; height:150px; border:none; margin-top:5px;"></iframe></div></div></div>

<script src="config.js"></script>
<script>
    const SFX = { success: new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"), error: new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"), alert: new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"), click: new Audio("https://actions.google.com/sounds/v1/ui/click_on.ogg") };
    let basvuruVerileri = {}; let aktifKullanici = ""; let aktifRutbe = ""; let jitsiApi = null;
    const cezaKatalogu = [{ad:"HÄ±z Ä°hlali",p:2000,h:0},{ad:"KÄ±rmÄ±zÄ± IÅŸÄ±k",p:1500,h:0},{ad:"Ehliyetsiz",p:5000,h:5},{ad:"AlkollÃ¼",p:8000,h:10},{ad:"Mukavemet",p:15000,h:25},{ad:"SilahlÄ± Soygun",p:50000,h:60},{ad:"Cinayet",p:200000,h:80}];

    window.onload = function() {
        const wh=localStorage.getItem('discordWebhook'); if(wh) document.getElementById('webhookUrl').value=wh;
        document.body.setAttribute('data-theme','dark');
        boloGetir(); youtubeMod(); rehberTablosunuDoldur();
        
        // Not Defterini YÃ¼kle
        if(localStorage.getItem('myNote')) document.getElementById('notepadArea').value = localStorage.getItem('myNote');
        
        // AraÃ§ Listesini Dinle
        aracListesiDinle();
    }

    // --- TRAFÄ°K & ARAÃ‡ SÄ°STEMÄ° (YENÄ°) ---
    function plakaSorgula() {
        const plaka = document.getElementById('plakaInput').value.toUpperCase().trim();
        if(!plaka) return alert("Plaka giriniz!");
        
        database.ref('araclar').orderByChild('plaka').equalTo(plaka).once('value', snapshot => {
            let aracData = null; let key = null;
            snapshot.forEach(c => { aracData = c.val(); key = c.key; });
            
            const sonucDiv = document.getElementById('trafficResult');
            document.getElementById('trafficModal').style.display = 'block';
            
            if(aracData) {
                let renkClass = aracData.durum === 'Ã‡alÄ±ntÄ±' ? 'status-stolen' : (aracData.durum === 'BaÄŸlandÄ±' ? 'status-impounded' : 'status-clean');
                sonucDiv.innerHTML = `
                    <div class="plate-card">
                        <div class="plate-text">${aracData.plaka}</div>
                        <div class="plate-status ${renkClass}">${aracData.durum.toUpperCase()}</div>
                        <p>${aracData.not || "Ekstra not yok."}</p>
                    </div>
                    <div style="display:flex; gap:10px; justify-content:center;">
                        <button onclick="aracDurumGuncelle('${key}', 'Temiz')" class="btn btn-green">TEMÄ°ZE Ã‡IKAR</button>
                        <button onclick="aracDurumGuncelle('${key}', 'Ã‡alÄ±ntÄ±')" class="btn btn-red">Ã‡ALINTI</button>
                        <button onclick="aracDurumGuncelle('${key}', 'BaÄŸlandÄ±')" class="btn btn-yellow">BAÄLA (YEDÄ°EMÄ°N)</button>
                    </div>
                `;
            } else {
                sonucDiv.innerHTML = `
                    <h3>KayÄ±t BulunamadÄ±</h3>
                    <p>${plaka} plakalÄ± araÃ§ sistemde yok. Yeni kayÄ±t oluÅŸturulsun mu?</p>
                    <button onclick="yeniAracKaydet('${plaka}')" class="btn btn-blue">KAYIT OLUÅTUR</button>
                `;
            }
        });
    }

    function yeniAracKaydet(plaka) {
        database.ref('araclar').push({
            plaka: plaka, durum: 'Temiz', not: 'Sisteme yeni eklendi.', islem_yapan: aktifKullanici, zaman: Date.now()
        });
        plakaSorgula(); // EkranÄ± yenile
    }

    function aracDurumGuncelle(key, durum) {
        database.ref('araclar/' + key).update({
            durum: durum, islem_yapan: aktifKullanici, zaman: Date.now()
        });
        alert(`AraÃ§ durumu gÃ¼ncellendi: ${durum}`);
        document.getElementById('trafficModal').style.display = 'none';
        plakaSorgula(); // EkranÄ± yenilemek iÃ§in tekrar sorgula
    }

    function aracListesiDinle() {
        database.ref('araclar').limitToLast(20).on('value', s => {
            const t = document.getElementById('aracListesiBody'); t.innerHTML = "";
            s.forEach(c => {
                const d = c.val();
                let renk = d.durum === 'Ã‡alÄ±ntÄ±' ? 'red' : (d.durum === 'BaÄŸlandÄ±' ? 'orange' : 'green');
                t.innerHTML = `<tr><td><b>${d.plaka}</b></td><td style="color:${renk}; font-weight:bold;">${d.durum}</td><td>${d.not}</td><td>${d.islem_yapan}</td></tr>` + t.innerHTML;
            });
        });
    }

    // --- NOT DEFTERÄ° (YENÄ°) ---
    function notuKaydetLocal() { localStorage.setItem('myNote', document.getElementById('notepadArea').value); }
    function toggleNotepad() { 
        const p = document.getElementById('quickNotepad'); 
        p.classList.toggle('notepad-min');
        document.getElementById('noteToggleIcon').innerText = p.classList.contains('notepad-min') ? 'â–¡' : '_';
    }

    // --- ESKÄ° FONKSÄ°YONLAR ---
    function girisYap() { SFX.click.play(); const k=document.getElementById('kadi').value; const s=document.getElementById('sifre').value; if(k==="MÃ¼dÃ¼r"&&s==="GÃ¶kSancak1881"){database.ref('yetkililer').orderByChild('kadi').equalTo('MÃ¼dÃ¼r').once('value',x=>{if(!x.exists())database.ref('yetkililer').push({kadi:'MÃ¼dÃ¼r',sifre:'GÃ¶kSancak1881',rutbe:'MÃ¼dÃ¼r'})}); basariliGiris(k,'MÃ¼dÃ¼r');return;} database.ref('yetkililer').orderByChild('kadi').equalTo(k).once('value',sn=>{let f=false,r='Memur'; sn.forEach(c=>{if(c.val().sifre===s){f=true;r=c.val().rutbe||'Memur'}}); if(f)basariliGiris(k,r); else{SFX.error.play(); document.getElementById('loginMsg').innerText="HatalÄ±!";}}); }
    function basariliGiris(i,r) { SFX.success.play(); aktifKullanici=i; aktifRutbe=r; document.getElementById('aktifKullaniciAdi').innerText=i; document.getElementById('aktifRutbeGoster').innerText=r; document.getElementById('aktifRutbeGoster').className=`rutbe-badge rutbe-${rutbe.toLowerCase().replace('Ã¼','u').replace('Ã¶','o')}`; document.getElementById('loginScreen').style.display='none'; document.getElementById('adminPanel').style.display='flex'; verileriGetir(); yoneticileriGetir(); blacklistGetir(); chatBaslat(); delilGetir(); gbtGetir(); }
    function cikisYap() { location.reload(); }
    function yetki(r) { if(!r.includes(aktifRutbe)){ SFX.error.play(); alert("Yetkisiz!"); return false; } return true; }
    
    function delilEkleModal(){ document.getElementById('recordModal').style.display='block'; }
    function delilKaydet(){ const n=document.getElementById('delil_no').value; const s=document.getElementById('delil_supheli').value; const i=document.getElementById('delil_img').value; const a=document.getElementById('delil_aciklama').value; if(n){ database.ref('delil_dosyalari').push({no:n,supheli:s,img:i,aciklama:a,tarih:Date.now()}); document.getElementById('recordModal').style.display='none'; SFX.success.play(); } }
    function delilGetir(){ database.ref('delil_dosyalari').on('value',s=>{ const grid = document.getElementById('evidenceGrid'); grid.innerHTML = ""; let c=0; s.forEach(k=>{ const d=k.val(); c++; const imgSrc = d.img ? d.img : 'https://cdn-icons-png.flaticon.com/512/376/376000.png'; grid.innerHTML += `<div class="evidence-card"><div class="evidence-img-container" onclick="window.open('${imgSrc}')"><img src="${imgSrc}"></div><div class="evidence-body"><div style="font-weight:bold;color:#3b82f6;">#${d.no} - ${d.supheli}</div><div style="font-size:0.8rem;color:#aaa;">${new Date(d.tarih).toLocaleDateString()}</div><div>${d.aciklama}</div><button onclick="dbSil('delil_dosyalari/${k.key}')" class="btn btn-red" style="width:100%;margin-top:5px;font-size:0.8rem;">KAPAT</button></div></div>`; }); document.getElementById('statOlay').innerText=c; }); }
    function delilFiltrele() { let v = document.getElementById('delilAra').value.toLowerCase(); document.querySelectorAll('.evidence-card').forEach(c => { c.style.display = c.innerText.toLowerCase().includes(v) ? '' : 'none'; }); }

    function boloDuzenle(){ if(!yetki(['MÃ¼dÃ¼r','Komiser']))return; const m=prompt("BOLO:"); if(m) database.ref('bolo').set(m); }
    function boloGetir(){ database.ref('bolo').on('value',s=>{document.getElementById('boloText').innerText=s.val()||"Temiz.";}); }
    
    function cezaModalAc(sel=-1) { const l=document.getElementById('cezaListesi'); l.innerHTML=""; cezaKatalogu.forEach((c,i)=>{ let ch=i===sel?'checked':''; let st=i===sel?'background:#225522':''; l.innerHTML+=`<div class="ceza-item" onclick="cezaSec(${i},this)" style="${st}"><input type="checkbox" id="cezaCheck${i}" ${ch}> ${c.ad}</div>` }); cezaHesapla(); document.getElementById('cezaModal').style.display='block'; }
    function cezaSec(i,d){ const c=document.getElementById(`cezaCheck${i}`); c.checked=!c.checked; d.style.background=c.checked?"#225522":"transparent"; cezaHesapla(); }
    function cezaHesapla(){ let p=0,h=0; cezaKatalogu.forEach((x,n)=>{ if(document.getElementById(`cezaCheck${n}`).checked){p+=x.p; h+=x.h;} }); document.getElementById('toplamCeza').innerText=`${p} TL / ${h} Ay`; }
    function cezaSifirla(){ document.getElementById('toplamCeza').innerText="0 TL / 0 Ay"; }
    function cezayiKesVeIsle(){ const s=document.getElementById('ceza_suclu_adi').value; const t=document.getElementById('toplamCeza').innerText; if(!s)return alert("Ä°sim?"); database.ref('gbt_kayitlari').push({vatandas:s, suc:t, durum:"Ä°ÅŸlendi", ekleyen:aktifKullanici, tarih:Date.now(), ceza_detay:t}); alert("Ä°ÅŸlendi!"); document.getElementById('cezaModal').style.display='none'; }
    function rehberTablosunuDoldur() { const t = document.getElementById('rehberListesi'); t.innerHTML = ""; cezaKatalogu.forEach((c,i) => { t.innerHTML += `<tr><td>${c.ad}</td><td>${c.p} TL</td><td>${c.h} K</td><td><button onclick="cezaModalAc(${i})" class="btn btn-blue" style="padding:2px 8px;">SEÃ‡</button></td></tr>`; }); }

    function gbtEkleModal() { /* Manuel GBT Ekleme Gerekirse */ }
    function gbtSorgula() { const q=document.getElementById('gbtInput').value.toLowerCase(); const a=document.getElementById('gbtSonucAlani'); a.innerHTML=""; database.ref('gbt_kayitlari').once('value',s=>{ let f=false; s.forEach(c=>{ const d=c.val(); if(d.vatandas.toLowerCase().includes(q)){ f=true; let det = d.ceza_detay ? `<br><small style="color:red">${d.ceza_detay}</small>`:''; a.innerHTML+=`<div class="gbt-card" style="border-left:4px solid ${d.durum==='AranÄ±yor'?'red':'green'}"><b>${d.vatandas}</b> - ${d.suc} ${det}<button onclick="dbSil('gbt_kayitlari/${c.key}')" class="btn btn-red" style="padding:2px 5px;">Sil</button></div>`; } }); if(!f) a.innerHTML="Temiz."; }); }
    function gbtGetir(){ database.ref('gbt_kayitlari').orderByChild('durum').equalTo('AranÄ±yor').on('value',s=>{document.getElementById('statAranan').innerText=s.numChildren()}); }

    function verileriGetir() { database.ref('basvurular').on('value',s=>{ const l=document.getElementById('basvuruListesi'); l.innerHTML=""; s.forEach(c=>{ const d=c.val(); const k=c.key; l.innerHTML+=`<tr><td>${d.discord_id}</td><td>${d.ic_isim}</td><td>${d.durum}</td><td><button onclick="onayla('${k}')" class="btn btn-green">âœ“</button><button onclick="reddet('${k}')" class="btn btn-red">âœ—</button><button onclick="dbSil('basvurular/${k}')" class="btn btn-dark">ğŸ—‘ï¸</button></td></tr>`; }); document.getElementById('statToplam').innerText=s.numChildren(); }); }
    function onayla(k){ if(!yetki(['MÃ¼dÃ¼r','Komiser']))return; database.ref('basvurular/'+k).update({durum:'OnaylandÄ±'}); SFX.success.play(); }
    function reddet(k){ if(!yetki(['MÃ¼dÃ¼r','Komiser']))return; database.ref('basvurular/'+k).update({durum:'Reddedildi'}); SFX.error.play(); }
    function dbSil(y){ if(!yetki(['MÃ¼dÃ¼r']))return; if(confirm("Sil?")) database.ref(y).remove(); }
    
    function yoneticileriGetir(){ database.ref('yetkililer').on('value',s=>{ const l=document.getElementById('yoneticiListesi'); l.innerHTML=""; s.forEach(c=>{ let d=c.val(); let del=(aktifKullanici==='MÃ¼dÃ¼r'&&d.kadi!=='MÃ¼dÃ¼r')?`<button onclick="dbSil('yetkililer/${c.key}')" class="btn btn-red">Sil</button>`:'ğŸ”’'; l.innerHTML+=`<tr><td>${d.kadi}</td><td>${d.rutbe||'Memur'}</td><td>${del}</td></tr>`; }); }); }
    function yetkiliEkle(){ if(!yetki(['MÃ¼dÃ¼r']))return; let k=document.getElementById('yeniKadi').value; let s=document.getElementById('yeniSifre').value; let r=document.getElementById('yeniRutbe').value; if(k&&s){ database.ref('yetkililer').push({kadi:k,sifre:s,rutbe:r}); SFX.success.play(); alert("Eklendi."); } }
    function blacklistGetir(){ database.ref('blacklist').on('value',s=>{}); }
    
    function tabloAra(i,t){ let v=document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?'':'none'); }
    function tabDegistir(i,e){ SFX.click.play(); document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(i).classList.add('active'); e.classList.add('active-tab'); }
    function excelIndir(){ let h=document.getElementById("basvuruListesi").outerHTML; let b=new Blob(["\ufeff","<table>"+h+"</table>"],{type:"application/vnd.ms-excel"}); let a=document.createElement("a"); a.href=URL.createObjectURL(b); a.download="liste.xls"; a.click(); }
    
    dragElement(document.getElementById("musicPlayer")); function toggleMusicPlayer(){ document.getElementById("musicPlayer").classList.toggle("minimized"); SFX.click.play(); }
    function radyoCal(u,n){ document.getElementById("playerStatus").innerText="Ã‡alÄ±yor: "+n; document.getElementById("ytContainer").classList.add("hidden"); const a=document.getElementById("radioPlayer"); a.src=u; a.classList.remove("hidden"); a.play(); }
    function youtubeMod(){ document.getElementById("playerStatus").innerText="Mod: YouTube"; document.getElementById("radioPlayer").pause(); document.getElementById("radioPlayer").classList.add("hidden"); document.getElementById("ytContainer").classList.remove("hidden"); }
    function youtubeCal(){ const u=document.getElementById('musicUrl').value; const m=u.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/); if(m&&m[2].length===11)document.getElementById('ytPlayer').src=`https://www.youtube.com/embed/${m[2]}?autoplay=1`; }
    function dragElement(e){var n=0,t=0,o=0,l=0;function u(e){(e=e||window.event).preventDefault(),o=e.clientX,l=e.clientY,document.onmouseup=d,document.onmousemove=m}function m(u){(u=u||window.event).preventDefault(),n=o-u.clientX,t=l-u.clientY,o=u.clientX,l=u.clientY,e.style.top=e.offsetTop-t+"px",e.style.left=e.offsetLeft-n+"px"}function d(){document.onmouseup=null,document.onmousemove=null}document.getElementById("musicHeader").onmousedown=u}
    function telsizDurumDegistir(){ const b=document.getElementById('btnConnectRadio'); const c=document.getElementById('jitsi-embed-container'); if(jitsiApi){ jitsiApi.dispose(); jitsiApi=null; b.innerText="BAÄLAN"; b.classList.remove('btn-green'); b.classList.add('btn-red'); c.innerHTML=""; }else{ b.innerText="AYRIL"; b.classList.remove('btn-red'); b.classList.add('btn-green'); jitsiApi=new JitsiMeetExternalAPI("meet.jit.si",{roomName:"EGM_Ozel_Kanal_2024",width:"100%",height:"100%",parentNode:c,configOverwrite:{startWithAudioMuted:false,startWithVideoMuted:true,prejoinPageEnabled:false},userInfo:{displayName:aktifKullanici}}); } }
    function chatBaslat(){ database.ref('chat').limitToLast(50).on('child_added',s=>{ const d=s.val(); let div=document.getElementById('chatMessages'); let cls=d.gonderen===aktifKullanici?'msg-mine':'msg-other'; div.innerHTML+=`<div class="message ${cls}"><b>${d.gonderen}:</b> ${d.mesaj}</div>`; div.scrollTop=div.scrollHeight; if(d.gonderen!==aktifKullanici)SFX.error.play().catch(e=>{}); }); }
    function mesajGonder(){ let i=document.getElementById('chatInput'); if(i.value.trim()){ database.ref('chat').push({gonderen:aktifKullanici,mesaj:i.value.trim(),zaman:firebase.database.ServerValue.TIMESTAMP}); i.value=""; } }
    function enterBas(e){ if(e.key==='Enter')mesajGonder(); }
</script>
</body>
</html>
