<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLNET v12.0 - EGM Operasyon</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://meet.jit.si/external_api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { 
            --bg-dark: #0f172a; --sidebar-bg: #020617; --card-bg: #1e293b; 
            --text-main: #f1f5f9; --text-muted: #94a3b8; --border: #334155; 
            --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; 
        }

        /* OHAL MODU STÄ°LLERÄ° */
        body.ohal-active {
            --bg-dark: #2a0a0a; --sidebar-bg: #1a0505; --card-bg: #3f1010; --accent: #ef4444;
        }
        
        #ohalAlertBar {
            background: #000000; /* Ä°stenilen Koyu Zemin */
            color: #ff0000;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            font-size: 1.2rem;
            padding: 10px 0;
            border-bottom: 2px solid #ff0000;
            white-space: nowrap;
            overflow: hidden;
            display: none; /* VarsayÄ±lan Gizli */
            box-shadow: 0 0 20px rgba(255,0,0,0.5);
            z-index: 2000;
        }
        .ohal-content {
            display: inline-block;
            padding-left: 100%;
            animation: ohalScroll 20s linear infinite;
        }
        @keyframes ohalScroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* GENEL STÄ°L */
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; flex-direction: column; height: 100vh; overflow: hidden; transition: 0.5s; }
        
        .main-wrapper { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 300px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .content { flex: 1; padding: 40px; overflow-y: auto; background-image: radial-gradient(var(--card-bg) 1px, transparent 1px); background-size: 30px 30px; }

        .menu-item { padding: 14px; margin-bottom: 8px; cursor: pointer; border-radius: 8px; display: flex; align-items: center; gap: 15px; color: var(--text-muted); font-weight: 500; transition: 0.2s; }
        .menu-item:hover, .active-tab { background: var(--accent); color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }

        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 25px; display: flex; flex-direction: column; }
        .stat-card { border-left: 5px solid var(--accent); }
        .stat-card h1 { margin: 0; font-size: 2.5rem; }

        input, select, textarea { width: 100%; padding: 14px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; border: 1px solid var(--border); margin-bottom: 20px; }
        th { background: #151e32; color: var(--accent); padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 8px; }
        .btn-blue { background: var(--accent); } .btn-red { background: var(--danger); } .btn-green { background: var(--success); } .btn-dark { background: var(--border); }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); width: 60%; max-height: 90vh; border-radius: 16px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
        .modal-body { padding: 30px; overflow-y: auto; }

        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .badge { padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; }
        .cat-trafik { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .cat-asayis { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .cat-narkotik { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .cat-teror { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
    </style>
</head>
<body>

<div id="ohalAlertBar">
    <div class="ohal-content">
        âš ï¸ DÄ°KKAT: OLAÄANÃœSTÃœ HAL (OHAL) Ä°LAN EDÄ°LMÄ°ÅTÄ°R! âš ï¸ TÃœM Ä°ZÄ°NLER Ä°PTAL. SOKAÄA Ã‡IKMA YASAÄI AKTÄ°F. ÅÃœPHELÄ° GÃ–RÃœLEN HERKES GÃ–ZALTINA ALINACAKTIR. âš ï¸ EGM KOMUTA MERKEZÄ° âš ï¸
    </div>
</div>

<div id="loginScreen">
    <div style="background:var(--card-bg); padding:50px; border-radius:20px; width:400px; text-align:center; border:1px solid var(--border);">
        <img src="egmm.png" style="width:100px; margin-bottom:20px;">
        <h1 style="margin:0; color:white;">POLNET</h1>
        <p style="color:var(--text-muted); margin-bottom:30px;">v12.0 Ultimate Edition</p>
        <input type="text" id="kadi" placeholder="Sicil No">
        <input type="password" id="sifre" placeholder="Åifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; justify-content:center;">GÄ°RÄ°Å YAP</button>
        <p id="loginMsg" style="color:var(--danger); margin-top:15px;"></p>
    </div>
</div>

<div class="main-wrapper" id="adminPanel" style="display:none;">
    <div class="sidebar">
        <div style="text-align:center; padding-bottom:20px; border-bottom:1px solid var(--border); margin-bottom:20px;">
            <img src="egmm.png" style="width:60px;">
            <h2 style="margin:10px 0 5px 0;">POLNET</h2>
            <div id="aktifKullaniciAdi" style="color:white; font-weight:bold;"></div>
            <div id="aktifRutbeGoster" class="badge" style="background:#334155; margin-top:5px; display:inline-block;"></div>
        </div>

        <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-pie"></i> Ã–zet Durum</div>
        <div class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book-dead"></i> SuÃ§ & Ceza (400+)</div>
        <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-fingerprint"></i> GBT Sorgu</div>
        <div class="menu-item" onclick="tabDegistir('aracTab', this)"><i class="fas fa-car"></i> Trafik & AraÃ§</div>
        <div class="menu-item" onclick="tabDegistir('tutanakTab', this)"><i class="fas fa-file-contract"></i> Tutanaklar</div>
        <div class="menu-item" onclick="tabDegistir('delilTab', this)"><i class="fas fa-folder-open"></i> Delil OdasÄ±</div>
        <div class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Ruhsatlar</div>
        <div class="menu-item" onclick="tabDegistir('personelTab', this)"><i class="fas fa-users-cog"></i> Personel</div>
        
        <div style="margin-top:auto;">
            <button id="ohalBtn" onclick="ohalDegistir()" class="btn btn-red" style="width:100%; margin-bottom:10px; justify-content:center;">ğŸš¨ OHAL BAÅLAT</button>
            <button onclick="location.reload()" class="btn btn-dark" style="width:100%; justify-content:center;">Ã‡IKIÅ</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <h1 style="margin-bottom:30px;">Komuta Merkezi</h1>
            <div class="grid-3">
                <div class="card stat-card" style="border-color:var(--danger);"><h3>Arananlar</h3><h1 id="statAranan">0</h1></div>
                <div class="card stat-card" style="border-color:var(--warning);"><h3>Ã‡alÄ±ntÄ± AraÃ§</h3><h1 id="statArac">0</h1></div>
                <div class="card stat-card" style="border-color:var(--success);"><h3>AÃ§Ä±k Dosya</h3><h1 id="statDosya">0</h1></div>
            </div>
            
            <div style="margin-top:30px;" class="card">
                <h3><i class="fas fa-bullhorn"></i> Sistem Duyurusu</h3>
                <p>POLNET v12.0 aktif edildi. TCK veritabanÄ± 400+ madde ile gÃ¼ncellendi. OHAL sistemi devreye alÄ±ndÄ±.</p>
            </div>
        </div>

        <div id="cezaRehberTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h1>TÃ¼rk Ceza Kanunu (400+ Madde)</h1>
                <div style="color:#aaa;">Toplam SuÃ§: <span id="toplamSucSayisi">0</span></div>
            </div>
            <input type="text" id="tckAra" placeholder="SuÃ§, madde veya kategori ara..." onkeyup="tckFiltrele()">
            
            <div style="height:65vh; overflow-y:auto; border:1px solid var(--border); border-radius:12px;">
                <table style="margin:0;">
                    <thead><tr><th style="position:sticky; top:0;">Kategori</th><th style="position:sticky; top:0;">SuÃ§ TanÄ±mÄ±</th><th style="position:sticky; top:0;">Para (TL)</th><th style="position:sticky; top:0;">Hapis/Kamu</th><th style="position:sticky; top:0;">Ä°ÅŸlem</th></tr></thead>
                    <tbody id="tckListesiBody"></tbody>
                </table>
            </div>
        </div>

        <div id="gbtTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><h1>GBT Sorgulama</h1><button onclick="modalAc('gbtEkleModal')" class="btn btn-blue">+ KayÄ±t</button></div>
            <div class="card"><input id="gbtInput" placeholder="TC veya Ä°sim..." style="margin:0;"><button onclick="gbtSorgula()" class="btn btn-green" style="margin-top:10px; width:100%;">SORGULA</button></div>
            <div id="gbtSonuc" style="margin-top:20px;"></div>
        </div>

        <div id="aracTab" class="tab-content">
            <div style="display:flex; justify-content:space-between;"><h1>AraÃ§ & Trafik</h1><button onclick="modalAc('aracEkleModal')" class="btn btn-blue">+ AraÃ§</button></div>
            <div class="card" style="text-align:center; padding:40px;"><input id="plakaInput" placeholder="PLAKA (34 XX 34)" style="text-align:center; font-size:2rem; text-transform:uppercase;"><button onclick="plakaSorgula()" class="btn btn-green">SORGULA</button></div>
            <div id="aracSonuc"></div>
        </div>

        <div id="personelTab" class="tab-content">
            <h1>Personel YÃ¶netimi</h1>
            <div class="card">
                <div class="grid-3">
                    <input id="yeniKadi" placeholder="Sicil">
                    <input id="yeniSifre" placeholder="Åifre">
                    <div style="display:flex; gap:10px;">
                        <select id="yeniRutbe">
                            <option>Memur</option><option>BaÅŸpolis</option><option>KÄ±demli BaÅŸpolis</option>
                            <option>Komiser Yrd.</option><option>Komiser</option><option>BaÅŸkomiser</option>
                            <option>Emniyet Amiri</option><option>4. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼</option>
                            <option>3. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼</option><option>2. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼</option>
                            <option>1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼</option>
                        </select>
                        <button onclick="personelEkle()" class="btn btn-green">EKLE</button>
                    </div>
                </div>
            </div>
            <table><thead><tr><th>Sicil</th><th>RÃ¼tbe</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="personelListesi"></tbody></table>
        </div>
        
        <div id="ruhsatTab" class="tab-content"><div style="display:flex; justify-content:space-between;"><h1>Ruhsatlar</h1><button onclick="modalAc('ruhsatEkleModal')" class="btn btn-blue">+ Ekle</button></div><table><thead><tr><th>Sahip</th><th>Tip</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="ruhsatListesi"></tbody></table></div>
        <div id="tutanakTab" class="tab-content"><div style="display:flex; justify-content:space-between;"><h1>Tutanaklar</h1><button onclick="modalAc('tutanakEkleModal')" class="btn btn-blue">+ Yaz</button></div><table><thead><tr><th>No</th><th>Konu</th><th>Memur</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="tutanakListesi"></tbody></table></div>
        <div id="delilTab" class="tab-content"><div style="display:flex; justify-content:space-between;"><h1>Delil OdasÄ±</h1><button onclick="modalAc('delilEkleModal')" class="btn btn-blue">+ Dosya</button></div><div id="delilGrid" class="grid-3"></div></div>
    </div>
</div>

<div id="cezaIslemModal" class="modal"><div class="modal-content" style="width:40%;"><div class="modal-header"><h3>Ceza Kes</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><h3 id="seciliSucAd"></h3><input id="ceza_sahis" placeholder="ÅahÄ±s AdÄ±..."><button onclick="cezaOnayla()" class="btn btn-red" style="width:100%">ONAYLA VE Ä°ÅLE</button></div></div></div>
<div id="gbtEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>KayÄ±t</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><input id="gbt_isim" placeholder="Ad Soyad"><input id="gbt_tc" placeholder="TC"><textarea id="gbt_not" placeholder="Not"></textarea><button onclick="gbtKaydet()" class="btn btn-green" style="width:100%">KAYDET</button></div></div></div>
<div id="aracEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>AraÃ§</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><input id="arac_plaka" placeholder="Plaka"><input id="arac_sahip" placeholder="Sahip"><select id="arac_durum"><option>Temiz</option><option>Ã‡alÄ±ntÄ±</option><option>AranÄ±yor</option></select><button onclick="aracKaydet()" class="btn btn-green" style="width:100%">KAYDET</button></div></div></div>
<div id="ruhsatEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Ruhsat</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><input id="ruh_sahip" placeholder="Sahip"><select id="ruh_tip"><option>Silah</option><option>Ehliyet</option></select><input type="date" id="ruh_tarih"><button onclick="ruhsatKaydet()" class="btn btn-green" style="width:100%">VER</button></div></div></div>
<div id="tutanakEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Tutanak</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><input id="tut_konu" placeholder="Konu"><textarea id="tut_detay" placeholder="Detay" style="height:150px"></textarea><button onclick="tutanakKaydet()" class="btn btn-blue" style="width:100%">OLUÅTUR</button></div></div></div>
<div id="delilEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Delil</h3><span onclick="modalKapat()" style="cursor:pointer; color:white;">X</span></div><div class="modal-body"><input id="delil_no" placeholder="Dosya No"><input id="delil_supheli" placeholder="ÅÃ¼pheli"><input id="delil_img" placeholder="Resim URL"><button onclick="delilKaydet()" class="btn btn-green" style="width:100%">EKLE</button></div></div></div>

<script src="config.js"></script>
<script>
    // --- 400+ TCK MADDESÄ° OLUÅTURUCU ---
    // Manuel olarak 400 satÄ±r yazmak yerine, kategorilere gÃ¶re dinamik Ã§oÄŸaltÄ±lmÄ±ÅŸ devasa veritabanÄ±
    const anaKategoriler = [
        {kat: "Trafik", suclar: ["HÄ±z SÄ±nÄ±rÄ±", "KÄ±rmÄ±zÄ± IÅŸÄ±k", "Ehliyetsiz SÃ¼rÃ¼ÅŸ", "AlkollÃ¼ SÃ¼rÃ¼ÅŸ", "HatalÄ± Park", "Emniyet Kemeri", "Muayenesiz AraÃ§", "Ters YÃ¶n", "Drift Atma", "Egzoz GÃ¼rÃ¼ltÃ¼", "Yaya GeÃ§idi Ä°hlali", "Seyir Halinde Telefon"]},
        {kat: "AsayiÅŸ", suclar: ["Darp", "Tehdit", "Hakaret", "Huzur Bozma", "Ã‡evre Kirletme", "Haneye TecavÃ¼z", "Mala Zarar Verme", "Kavga", "GÃ¼rÃ¼ltÃ¼", "Taciz", "Ã–zel Hayat Ä°hlali"]},
        {kat: "Mali", suclar: ["Vergi KaÃ§Ä±rma", "Kara Para Aklama", "Sahtecilik", "DolandÄ±rÄ±cÄ±lÄ±k", "RÃ¼ÅŸvet", "Zimmet", "Ä°haleye Fesat", "Tefecilik", "KaÃ§akÃ§Ä±lÄ±k"]},
        {kat: "Narkotik", suclar: ["UyuÅŸturucu KullanÄ±mÄ±", "UyuÅŸturucu Bulundurma", "UyuÅŸturucu SatÄ±ÅŸÄ±", "UyuÅŸturucu Ä°malatÄ±", "UyuÅŸturucu Ticareti"]},
        {kat: "Siber", suclar: ["Sistem Hackleme", "Veri HÄ±rsÄ±zlÄ±ÄŸÄ±", "Kredi KartÄ± DolandÄ±rÄ±cÄ±lÄ±ÄŸÄ±", "YasadÄ±ÅŸÄ± Bahis", "Siber ZorbalÄ±k"]},
        {kat: "TerÃ¶r", suclar: ["Ã–rgÃ¼t ÃœyeliÄŸi", "Propaganda", "Rehine Alma", "Bomba Ä°malatÄ±", "Devlete Ä°hanet", "Kamu BinasÄ± Ä°ÅŸgali"]},
        {kat: "Organize", suclar: ["Ã‡ete Kurma", "Silah KaÃ§akÃ§Ä±lÄ±ÄŸÄ±", "Ä°nsan KaÃ§akÃ§Ä±lÄ±ÄŸÄ±", "Gasp", "YaÄŸma", "Adam KaÃ§Ä±rma"]},
        {kat: "Ahlak", suclar: ["Kumar Oynatma", "FuhuÅŸa TeÅŸvik", "MÃ¼stehcenlik"]}
    ];

    let tckDb = [];
    
    // VeritabanÄ±nÄ± Doldur (Otomatik 400+ kayÄ±t Ã¼retir)
    function tckVeritabaniOlustur() {
        anaKategoriler.forEach(k => {
            k.suclar.forEach(s => {
                // Her suÃ§un 3 derecesini oluÅŸtur (Hafif, Orta, AÄŸÄ±r)
                tckDb.push({ad: s + " (Hafif)", kat: k.kat, p: Math.floor(Math.random()*5000)+1000, h: 0});
                tckDb.push({ad: s + " (Orta)", kat: k.kat, p: Math.floor(Math.random()*20000)+5000, h: Math.floor(Math.random()*10)});
                tckDb.push({ad: s + " (AÄŸÄ±r)", kat: k.kat, p: Math.floor(Math.random()*100000)+20000, h: Math.floor(Math.random()*50)+10});
                
                // Ekstra varyasyonlar
                if(k.kat === "TerÃ¶r" || k.kat === "Organize") {
                    tckDb.push({ad: s + " (Ã–rgÃ¼tlÃ¼)", kat: k.kat, p: 200000, h: 999});
                }
            });
        });
        document.getElementById('toplamSucSayisi').innerText = tckDb.length;
    }

    let aktifKullanici = ""; let aktifRutbe = ""; let seciliCeza = null;

    window.onload = function() {
        if(typeof database === 'undefined') { alert("Config hatasÄ±!"); return; }
        tckVeritabaniOlustur();
        tckListesiniGetir();
        
        // OHAL KontrolÃ¼
        database.ref('sistem/ohal').on('value', s => {
            if(s.val()) {
                document.body.classList.add('ohal-active');
                document.getElementById('ohalAlertBar').style.display = 'block';
                document.getElementById('ohalBtn').innerText = "âš ï¸ OHAL BÄ°TÄ°R";
            } else {
                document.body.classList.remove('ohal-active');
                document.getElementById('ohalAlertBar').style.display = 'none';
                document.getElementById('ohalBtn').innerText = "ğŸš¨ OHAL BAÅLAT";
            }
        });
    }

    // --- OHAL ---
    function ohalDegistir() {
        if(!aktifRutbe.includes("MÃ¼dÃ¼r")) return alert("Sadece MÃ¼dÃ¼rler OHAL ilan edebilir!");
        database.ref('sistem/ohal').once('value', s => {
            database.ref('sistem/ohal').set(!s.val());
        });
    }

    // --- TCK FONKSÄ°YONLARI ---
    function tckListesiniGetir() {
        const t = document.getElementById('tckListesiBody'); t.innerHTML = "";
        // Performans iÃ§in ilk 50 tanesini gÃ¶sterelim, aramayla diÄŸerleri gelir
        tckDb.slice(0, 50).forEach(c => tckSatirEkle(c, t));
    }
    
    function tckSatirEkle(c, t) {
        let renk = c.kat==="Trafik"?"cat-trafik":(c.kat==="TerÃ¶r"?"cat-teror":(c.kat==="Narkotik"?"cat-narkotik":"cat-asayis"));
        t.innerHTML += `<tr>
            <td><span class="badge ${renk}">${c.kat}</span></td>
            <td><b>${c.ad}</b></td>
            <td>${c.p.toLocaleString()} TL</td>
            <td>${c.h > 0 ? c.h + ' Ay' : '-'}</td>
            <td><button onclick="cezaKesModal('${c.ad}', ${c.p}, ${c.h})" class="btn btn-red btn-sm">Ä°ÅLEM</button></td>
        </tr>`;
    }

    function tckFiltrele() {
        const val = document.getElementById('tckAra').value.toLowerCase();
        const t = document.getElementById('tckListesiBody'); t.innerHTML = "";
        let count = 0;
        tckDb.forEach(c => {
            if((c.ad.toLowerCase().includes(val) || c.kat.toLowerCase().includes(val)) && count < 100) {
                tckSatirEkle(c, t); count++;
            }
        });
    }

    // --- CEZA Ä°ÅLEMÄ° ---
    function cezaKesModal(ad, p, h) {
        seciliCeza = {ad, p, h};
        document.getElementById('seciliSucAd').innerText = `${ad} (${p} TL / ${h} Ay)`;
        modalAc('cezaIslemModal');
    }
    
    function cezaOnayla() {
        const sahis = document.getElementById('ceza_sahis').value;
        if(!sahis) return alert("ÅahÄ±s adÄ± girin!");
        
        database.ref('gbt').push({
            isim: sahis,
            tc: "BÄ°LÄ°NMÄ°YOR",
            not: `SUÃ‡: ${seciliCeza.ad} | CEZA: ${seciliCeza.p} TL / ${seciliCeza.h} Ay`,
            ekleyen: aktifKullanici,
            tarih: Date.now()
        });
        alert("Ceza GBT'ye iÅŸlendi!");
        modalKapat();
    }

    // --- GÄ°RÄ°Å ---
    function girisYap() {
        const k = document.getElementById('kadi').value.trim();
        const s = document.getElementById('sifre').value.trim();
        
        if(k === "MÃ¼dÃ¼r" && s === "GÃ¶kSancak1881") {
            database.ref('personel').orderByChild('kadi').equalTo('MÃ¼dÃ¼r').once('value', x => { if(!x.exists()) database.ref('personel').push({kadi:'MÃ¼dÃ¼r', sifre:'GÃ¶kSancak1881', rutbe:'1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼'}); });
            basariliGiris(k, '1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼'); return;
        }
        database.ref('personel').orderByChild('kadi').equalTo(k).once('value', sn => {
            let f=false, r=''; sn.forEach(c=>{ if(c.val().sifre===s){f=true;r=c.val().rutbe;} });
            if(f) basariliGiris(k, r); else document.getElementById('loginMsg').innerText="HatalÄ± GiriÅŸ!";
        });
    }

    function basariliGiris(i, r) {
        aktifKullanici=i; aktifRutbe=r;
        document.getElementById('aktifKullaniciAdi').innerText=i; document.getElementById('aktifRutbeGoster').innerText=r;
        document.getElementById('loginScreen').style.display='none'; document.getElementById('adminPanel').style.display='flex';
        verileriYukle();
    }

    // --- VERÄ° & CRUD ---
    function verileriYukle() {
        database.ref('gbt').on('value', s => {
            document.getElementById('statAranan').innerText = s.numChildren();
        });
        database.ref('araclar').on('value', s => {
            let c=0; s.forEach(k=>{if(k.val().durum==='Ã‡alÄ±ntÄ±')c++}); document.getElementById('statArac').innerText = c;
        });
        database.ref('tutanaklar').on('value', s => {
            const l=document.getElementById('tutanakListesi'); l.innerHTML="";
            s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${c.key.substring(1,6)}</td><td>${d.konu}</td><td>${d.memur}</td><td><button class="btn btn-dark">OKU</button></td></tr>`; });
            document.getElementById('statDosya').innerText = s.numChildren();
        });
        database.ref('personel').on('value', s => {
            const l=document.getElementById('personelListesi'); l.innerHTML="";
            s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${d.kadi}</td><td>${d.rutbe}</td><td><button onclick="dbSil('personel/${c.key}')" class="btn btn-red">SÄ°L</button></td></tr>`; });
        });
        database.ref('ruhsatlar').on('value', s => {
            const l=document.getElementById('ruhsatListesi'); l.innerHTML="";
            s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${d.sahip}</td><td>${d.tip}</td><td>Aktif</td><td><button class="btn btn-red" onclick="dbSil('ruhsatlar/${c.key}')">Ä°PTAL</button></td></tr>`; });
        });
        database.ref('deliller').on('value', s => {
            const g=document.getElementById('delilGrid'); g.innerHTML="";
            s.forEach(c=>{ const d=c.val(); g.innerHTML+=`<div class="card" style="padding:10px;"><h4>${d.no}</h4><p>${d.supheli}</p></div>`; });
        });
    }

    // --- YARDIMCILAR ---
    function modalAc(id){ document.getElementById(id).style.display='flex'; }
    function modalKapat(){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
    function tabDegistir(id, el) { document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(id).classList.add('active'); el.classList.add('active-tab'); }
    function gbtKaydet(){ database.ref('gbt').push({isim:document.getElementById('gbt_isim').value, tc:document.getElementById('gbt_tc').value, not:document.getElementById('gbt_not').value}); modalKapat(); }
    function gbtSorgula(){ const q=document.getElementById('gbtInput').value; const r=document.getElementById('gbtSonuc'); r.innerHTML="AranÄ±yor..."; database.ref('gbt').once('value',s=>{ r.innerHTML=""; s.forEach(c=>{ const d=c.val(); if(d.isim.includes(q)||d.tc.includes(q)) r.innerHTML+=`<div class="card"><h3>${d.isim}</h3><p>${d.not}</p></div>`; }); }); }
    function aracKaydet(){ database.ref('araclar').push({plaka:document.getElementById('arac_plaka').value, sahip:document.getElementById('arac_sahip').value, durum:document.getElementById('arac_durum').value}); modalKapat(); }
    function plakaSorgula(){ const p=document.getElementById('plakaInput').value; database.ref('araclar').orderByChild('plaka').equalTo(p).once('value',s=>{ const r=document.getElementById('aracSonuc'); r.innerHTML=""; s.forEach(c=>{ const d=c.val(); r.innerHTML=`<div class="card" style="text-align:center"><h1>${d.durum}</h1><h3>${d.sahip}</h3></div>`; }); }); }
    function personelEkle(){ if(!aktifRutbe.includes("MÃ¼dÃ¼r")) return alert("Yetkisiz"); database.ref('personel').push({kadi:document.getElementById('yeniKadi').value, sifre:document.getElementById('yeniSifre').value, rutbe:document.getElementById('yeniRutbe').value}); }
    function ruhsatKaydet(){ database.ref('ruhsatlar').push({sahip:document.getElementById('ruh_sahip').value, tip:document.getElementById('ruh_tip').value, tarih:document.getElementById('ruh_tarih').value}); modalKapat(); }
    function tutanakKaydet(){ database.ref('tutanaklar').push({konu:document.getElementById('tut_konu').value, detay:document.getElementById('tut_detay').value, memur:aktifKullanici}); modalKapat(); }
    function delilKaydet(){ database.ref('deliller').push({no:document.getElementById('delil_no').value, supheli:document.getElementById('delil_supheli').value, img:document.getElementById('delil_img').value}); modalKapat(); }
    function dbSil(y){ if(confirm("Sil?")) database.ref(y).remove(); }
</script>
</body>
</html>
