<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLNET v4.8 - GeliÅŸmiÅŸ YÃ¶netim Sistemi</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0f172a; --sidebar-bg: #020617; --card-bg: #1e293b; --text-main: #f1f5f9; --text-muted: #94a3b8; --border: #334155; --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; }
        
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 14px; transition: background 0.5s ease; }

        /* OHAL MODU */
        body.ohal-active { 
            --bg-dark: #2a0505; --sidebar-bg: #1a0000; --card-bg: #3f0a0a; --accent: #ff0000; --border: #5c1818; 
            animation: redPulse 2s infinite alternate;
        }
        @keyframes redPulse { 0% { box-shadow: inset 0 0 0 0 rgba(255, 0, 0, 0); } 100% { box-shadow: inset 0 0 100px 30px rgba(255, 0, 0, 0.4); } }
        
        #ohalAlertBar { 
            background: #000; color: red; font-family: 'Chakra Petch', sans-serif; font-weight: 900; font-size: 1.5rem; 
            padding: 10px 0; border-bottom: 4px solid red; white-space: nowrap; overflow: hidden; display: none; z-index: 9999; 
            position: fixed; top: 0; width: 100%; letter-spacing: 2px;
        }
        .ohal-content { display: inline-block; padding-left: 100%; animation: ohalScroll 15s linear infinite; }
        @keyframes ohalScroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* LAYOUT */
        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; z-index: 10; padding-bottom: 50px; }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; background-image: radial-gradient(var(--card-bg) 1px, transparent 1px); background-size: 20px 20px; padding-bottom: 50px; }
        body.ohal-active .sidebar, body.ohal-active .content { margin-top: 50px; }

        .menu-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 10px; color: var(--text-muted); transition: 0.2s; font-weight: 500; font-family: 'Chakra Petch', sans-serif; letter-spacing: 0.5px; }
        .menu-item:hover, .active-tab { background: rgba(59,130,246,0.15); color: white; border-left: 3px solid var(--accent); }
        .menu-hidden { display: none !important; }

        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        h1, h2, h3 { font-family: 'Chakra Petch', sans-serif; margin-top: 0; }
        
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 10px; font-family: 'Inter', sans-serif; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }
        option { background: var(--card-bg); color: white; }

        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 5px; justify-content: center; font-family: 'Chakra Petch', sans-serif; text-transform: uppercase; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-blue { background: var(--accent); } .btn-green { background: var(--success); } .btn-red { background: var(--danger); } .btn-dark { background: #334155; } .btn-yellow { background: #f59e0b; color:black; }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; }

        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        th { background: rgba(0,0,0,0.4); color: var(--accent); padding: 15px; text-align: left; border-bottom: 2px solid var(--border); font-family: 'Chakra Petch', sans-serif; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); width: 70%; max-height: 90vh; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: zoomIn 0.2s; }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-header { padding: 20px; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 25px; overflow-y: auto; }

        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-blue { background: rgba(59,130,246,0.2); color: var(--accent); border: 1px solid var(--accent); }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .badge-green { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
        .badge-warn { background: rgba(245, 158, 11, 0.2); color: var(--warning); border: 1px solid var(--warning); }
        .badge-purple { background: rgba(147, 51, 234, 0.2); color: #c084fc; border: 1px solid #c084fc; }
        .badge-gold { background: rgba(255, 215, 0, 0.2); color: #ffd700; border: 1px solid #ffd700; }

        .mesai-card { text-align: center; border: 2px solid var(--border); transition: 0.3s; }
        .mesai-active { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        #mesaiSayac { font-size: 3rem; font-family: 'Chakra Petch', monospace; font-weight: bold; margin: 20px 0; }
        
        .ceza-item { padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; font-size: 0.9rem; }
        .ceza-item:hover { background: rgba(255,255,255,0.05); }
        .ceza-item.selected { background: rgba(59,130,246,0.2); border-left: 4px solid var(--accent); }
        .ceza-code { color: var(--text-muted); font-family: 'Chakra Petch'; margin-right: 10px; width: 60px; display:inline-block; font-weight:bold; }

        /* YETKI TABLOSU STÄ°LLERÄ° */
        .perm-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border); }
        .perm-row:hover { background: rgba(255,255,255,0.02); }
        .perm-desc { font-weight: 500; color: var(--text-main); }
        .perm-select-container select { margin-bottom: 0; width: auto; min-width: 200px; border-color: var(--accent); }
    </style>
</head>
<body>

<div id="ohalAlertBar"><div class="ohal-content">âš ï¸ DÄ°KKAT: OLAÄANÃœSTÃœ HAL (OHAL) Ä°LAN EDÄ°LMÄ°ÅTÄ°R! âš ï¸ TÃœM Ä°ZÄ°NLER Ä°PTAL. SOKAÄA Ã‡IKMA YASAÄI AKTÄ°F. ÅÃœPHELÄ° GÃ–RÃœLEN HERKES GÃ–ZALTINA ALINACAKTIR.</div></div>

<div id="loginScreen">
    <div style="background:var(--card-bg); padding:50px; border-radius:15px; width:400px; text-align:center; border:1px solid var(--border); box-shadow: 0 0 80px rgba(0,0,0,0.6);">
        <img src="egmm.png" style="width:100px; margin-bottom:20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
        <h2 style="margin:0; color:white; letter-spacing: 2px;">POLNET v4.8</h2>
        <p style="color:var(--text-muted); margin-bottom:30px;">Emniyet Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ Personel GiriÅŸi</p>
        <input type="text" id="kadi" placeholder="Sicil No">
        <input type="password" id="sifre" placeholder="Åifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px; padding: 15px;">SÄ°STEME GÄ°RÄ°Å YAP</button>
        <p id="loginMsg" style="color:var(--danger); margin-top:15px;"></p>
        <p style="font-size:10px; color:#555;">v4.8 Stable - Authorized Personnel Only</p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
            <img src="egmm.png" style="width:70px; margin-bottom:10px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
            <h3 style="margin:0; font-size:1.4rem;">POLNET</h3>
            <div id="aktifKullaniciAdi" style="font-weight:bold; color:white; margin-top:10px;"></div>
            <div id="aktifKullaniciRutbe" class="badge badge-blue" style="margin-top:5px; display:inline-block;">YÃœKLENÄ°YOR...</div>
        </div>

        <div id="menuDashboard" class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-pie"></i> Ã–zet Durum</div>
        <div id="menuBasvuru" class="menu-item" onclick="tabDegistir('basvuruTab', this)"><i class="fas fa-clipboard-list"></i> BaÅŸvurular <span id="basvuruBadge" class="badge badge-red" style="margin-left:auto; display:none;">0</span></div>
        <div id="menuMesai" class="menu-item" onclick="tabDegistir('mesaiTab', this)"><i class="fas fa-clock"></i> Mesai Ä°ÅŸlemleri</div>
        <div id="menuRuhsat" class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Silah RuhsatlarÄ±</div>
        <div id="menuTck" class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book"></i> TCK VeritabanÄ±</div>
        <div id="menuGbt" class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-fingerprint"></i> GBT Sorgu & Ä°ÅŸlem</div>
        <div id="menuArac" class="menu-item" onclick="tabDegistir('aracTab', this)"><i class="fas fa-car"></i> AraÃ§ & Trafik</div>
        
        <div id="menuPersonel" class="menu-item" onclick="tabDegistir('personelTab', this)"><i class="fas fa-users-cog"></i> Personel YÃ¶netimi</div>
        <div id="menuYetki" class="menu-item" onclick="tabDegistir('yetkiTab', this)" style="display:none;"><i class="fas fa-user-shield"></i> Yetki AyarlarÄ±</div>
        
        <div style="margin-top:auto;">
            <button id="ohalBtn" onclick="ohalDegistir()" class="btn btn-red" style="width:100%; margin-bottom:10px; padding:15px; font-size:1rem;">ğŸš¨ OHAL BAÅLAT</button>
            <button onclick="location.reload()" class="btn btn-dark" style="width:100%;">GÃœVENLÄ° Ã‡IKIÅ</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <h1 style="margin-bottom:20px;">Komuta Merkezi</h1>
            <div class="grid-3">
                <div class="card" style="border-left:4px solid var(--warning);"><h3>Bekleyen BaÅŸvuru</h3><h1 id="statBasvuru">0</h1></div>
                <div class="card" style="border-left:4px solid var(--danger);"><h3>Aranan ÅahÄ±s</h3><h1 id="statAranan">0</h1></div>
                <div class="card" style="border-left:4px solid var(--success);"><h3>Aktif Devriye</h3><h1 id="statAktifPersonel">0</h1></div>
            </div>
            <div class="card">
                <h3><i class="fas fa-shield-alt"></i> Sistem GÃ¼ncellemesi v4.8</h3>
                <p><strong>GELÄ°ÅMÄ°Å YETKÄ° SÄ°STEMÄ° EKLENDÄ°:</strong> ArtÄ±k personel rÃ¼tbelerinin hangi sekmeleri gÃ¶rebileceÄŸini ve hangi iÅŸlemleri yapabileceÄŸini 'Yetki AyarlarÄ±' sekmesinden dinamik olarak yÃ¶netebilirsiniz.</p>
            </div>
        </div>

        <div id="basvuruTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;"><h1>Gelen BaÅŸvurular</h1><button onclick="verileriYukle()" class="btn btn-dark"><i class="fas fa-sync"></i> Yenile</button></div>
            <div class="card">
                <input type="text" id="basvuruAra" placeholder="Ä°sim veya Discord ID ara..." onkeyup="tabloAra('basvuruAra','basvuruListesi')">
                <table><thead><tr><th>Tarih</th><th>Discord ID</th><th>IC Ä°sim</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="basvuruListesi"></tbody></table>
            </div>
            <div class="card"><h3>ğŸš« Kara Liste</h3><div style="display:flex; gap:10px;"><input id="bl_id" placeholder="Discord ID"><input id="bl_sebep" placeholder="Sebep"><button onclick="karaListeyeEkle()" class="btn btn-red">EKLE</button></div><div id="blacklistContainer" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div></div>
        </div>

        <div id="ruhsatTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Silah RuhsatÄ± YÃ¶netimi</h1>
                <button onclick="modalAc('ruhsatEkleModal')" class="btn btn-blue">+ YENÄ° RUHSAT TANIMLA</button>
            </div>
            <div class="card">
                <input type="text" id="ruhsatAra" placeholder="Ruhsat sahibi adÄ± ara..." onkeyup="tabloAra('ruhsatAra','ruhsatListesi')">
                <table>
                    <thead><tr><th>Ruhsat Sahibi</th><th>Ruhsat Tipi</th><th>GeÃ§erlilik Tarihi</th><th>Veren Memur</th><th>Ä°ÅŸlem</th></tr></thead>
                    <tbody id="ruhsatListesi"></tbody>
                </table>
            </div>
        </div>

        <div id="cezaRehberTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Ceza Kanunu Rehberi (TCK)</h1>
            </div>
            <div class="card" style="height:600px; overflow-y:auto;">
                <input id="tckAra" placeholder="Kanun kodu veya adÄ± ara..." onkeyup="tabloAra('tckAra','tckEditListesi')">
                <table><thead><tr><th>Kod</th><th>SuÃ§ TanÄ±mÄ±</th><th>Para CezasÄ±</th><th>Kamu CezasÄ±</th></tr></thead><tbody id="tckEditListesi"></tbody></table>
            </div>
        </div>

        <div id="mesaiTab" class="tab-content">
            <h1>Mesai Ä°ÅŸlemleri</h1>
            <div class="card mesai-card" id="kisiselMesaiKart">
                <h3 id="mesaiDurumText" style="color:var(--text-muted);">MESAÄ° DIÅI</h3>
                <div id="mesaiSayac">00:00:00</div>
                <button onclick="mesaiToggle()" id="btnMesai" class="btn btn-green" style="font-size:1.5rem; padding:15px 50px;">MESAÄ°YE BAÅLA</button>
            </div>
            <div class="card"><h3><i class="fas fa-users"></i> Aktif Personeller</h3><table id="aktifMesaiTablo"><thead><tr><th>Personel</th><th>RÃ¼tbe</th><th>BaÅŸlangÄ±Ã§ Saati</th><th>Aktif SÃ¼re</th></tr></thead><tbody id="aktifMesaiBody"></tbody></table></div>
        </div>

        <div id="gbtTab" class="tab-content">
            <h1>GBT Sorgu & Ceza Sistemi</h1>
            <div class="card"><div class="grid-2"><input id="gbtInput" placeholder="VatandaÅŸ AdÄ±..."><button onclick="gbtSorgula()" class="btn btn-green">SORGULA</button></div></div>
            <div id="gbtSonuc"></div>
            <button onclick="cezaModalAc()" class="btn btn-red" style="width:100%; margin-top:20px; padding:20px; font-size:1.2rem;">âš–ï¸ YENÄ° CEZA / SABIKA KAYDI OLUÅTUR</button>
        </div>

        <div id="aracTab" class="tab-content">
            <h1>Trafik Åube</h1>
            <div class="card" style="text-align:center;">
                <input id="plakaInput" placeholder="PLAKA (34 TR 34)" style="text-align:center; font-size:3rem; text-transform:uppercase; letter-spacing:5px; font-family:'Chakra Petch'; width:60%;">
                <br><br><button onclick="plakaSorgula()" class="btn btn-green" style="padding:15px 40px; font-size:1.2rem;">SORGULA</button>
            </div>
            <div id="aracSonuc" style="margin-top:20px;"></div>
        </div>

        <div id="personelTab" class="tab-content">
            <h1>Personel YÃ¶netimi</h1>
            <div class="card">
                <div class="grid-3">
                    <input id="yeniKadi" placeholder="Sicil No">
                    <input id="yeniSifre" placeholder="Åifre">
                    <select id="yeniRutbe">
                        </select>
                </div>
                <button onclick="personelEkle()" class="btn btn-green" style="width:100%">PERSONEL EKLE</button>
            </div>
            <table><thead><tr><th>Sicil</th><th>RÃ¼tbe</th><th>Åifre</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="personelListesi"></tbody></table>
        </div>

        <div id="yetkiTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Sistem Yetki YapÄ±landÄ±rmasÄ±</h1>
                <button onclick="yetkiAyarlariniKaydet()" class="btn btn-blue"><i class="fas fa-save"></i> AYARLARI KAYDET</button>
            </div>
            <p style="color:var(--text-muted);">Bu alandan hangi rÃ¼tbenin hangi sekmeyi gÃ¶rebileceÄŸini ve hangi iÅŸlemleri yapabileceÄŸini ayarlayabilirsiniz. Sol taraftaki iÅŸlem iÃ§in gerekli <strong>en dÃ¼ÅŸÃ¼k rÃ¼tbeyi</strong> seÃ§iniz.</p>
            
            <div class="card">
                <h3>ğŸ“‚ Sekme GÃ¶rÃ¼nÃ¼rlÃ¼k AyarlarÄ±</h3>
                <div id="permListTabs"></div>
            </div>

            <div class="card">
                <h3>ğŸ›¡ï¸ Operasyonel Ä°ÅŸlem Yetkileri</h3>
                <div id="permListActions"></div>
            </div>
        </div>
    </div>
</div>

<div id="basvuruModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>BaÅŸvuru Ä°nceleme</h3><span onclick="modalKapat()" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div class="modal-body"><div id="basvuruDetayIcerik"></div><hr style="border-color:var(--border); margin:20px 0;"><div id="basvuruIslemButtonlari" class="grid-3"></div></div></div></div>
<div id="ruhsatEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Yeni Silah RuhsatÄ±</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body"><input id="ruh_sahip" placeholder="Ruhsat Sahibi (Ad Soyad)"><select id="ruh_tip"><option value="Silah TaÅŸÄ±ma">Silah TaÅŸÄ±ma RuhsatÄ±</option><option value="Silah Bulundurma">Silah Bulundurma RuhsatÄ±</option><option value="Av TÃ¼feÄŸi">Av TÃ¼feÄŸi RuhsatÄ±</option></select><label style="color:var(--text-muted); font-size:0.8rem;">GeÃ§erlilik Tarihi:</label><input type="date" id="ruh_tarih"><button onclick="ruhsatKaydet()" class="btn btn-green" style="width:100%; margin-top:10px;">RUHSATI OLUÅTUR</button></div></div></div>
<div id="cezaModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Adalet BakanlÄ±ÄŸÄ± Ceza Sistemi</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body"><input id="ceza_sahis" placeholder="SuÃ§lu AdÄ± SoyadÄ±..." style="border:2px solid var(--accent);"><div class="grid-2"><input id="ceza_ara" placeholder="SuÃ§ Kodu veya AdÄ± Ara..." onkeyup="cezaFiltrele()"><button onclick="cezaSifirla()" class="btn btn-dark">SeÃ§imleri Temizle</button></div><div style="height:400px; overflow-y:auto; border:1px solid #334155; padding:10px; margin-bottom:15px;" id="cezaListesiContainer"></div><div style="background:#0f172a; padding:15px; text-align:center; border-radius:8px;"><h2 id="toplamTutar" style="color:var(--danger); margin:0;">0 TL / 0 Kamu (Hapis)</h2></div><button onclick="cezayiKes()" class="btn btn-red" style="width:100%; margin-top:15px; padding:15px;">CEZAYI ONAYLA VE Ä°ÅLE</button></div></div></div>

<script src="config.js"></script>
<script>
    // --- SES VE CONFIG ---
    const sirenAudio = new Audio('siren.mp3'); sirenAudio.loop = true; sirenAudio.volume = 0.5;
    const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1463704048376090779/NM94elMs7luZy6cXPvZFh4Ed2OsWQ-oU033418hdr4uwqJZ4Mcwyj4mTjIholI87UeyC";

    // --- RÃœTBE TANIMLARI (SABÄ°T) ---
    const RUTBELER = [
        { id: 0, ad: "Polis Memuru", class: "badge-blue" },
        { id: 1, ad: "BaÅŸ Polis", class: "badge-blue" },
        { id: 2, ad: "KÄ±demli BaÅŸ Polis", class: "badge-blue" },
        { id: 3, ad: "Komiser YardÄ±mcÄ±sÄ±", class: "badge-purple" },
        { id: 4, ad: "Komiser", class: "badge-purple" },
        { id: 5, ad: "BaÅŸ Komiser", class: "badge-purple" },
        { id: 6, ad: "Emniyet Amiri", class: "badge-gold" },
        { id: 7, ad: "4. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼", class: "badge-gold" },
        { id: 8, ad: "3. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼", class: "badge-gold" },
        { id: 9, ad: "2. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼", class: "badge-gold" },
        { id: 10, ad: "1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼", class: "badge-red" }
    ];

    // --- YETKÄ° SÄ°STEMÄ° (DÄ°NAMÄ°K) ---
    // VarsayÄ±lan Yetkiler (Firebase'de veri yoksa bunlar kullanÄ±lÄ±r)
    let DEFAULT_PERMS = {
        // Sekme GÃ¶rÃ¼nÃ¼rlÃ¼kleri
        'tab_dashboard': 0, // Herkes
        'tab_basvuru': 0,
        'tab_mesai': 0,
        'tab_ruhsat': 2,
        'tab_tck': 0,
        'tab_gbt': 0,
        'tab_arac': 0,
        'tab_personel': 5, // Sadece YÃ¼ksek RÃ¼tbe
        'tab_yetki': 10,   // Sadece En Ãœst YÃ¶netici

        // Operasyonel Ä°ÅŸlemler
        'act_basvuru_sil': 5,
        'act_basvuru_onay': 3,
        'act_personel_ekle': 8,
        'act_personel_sil': 10,
        'act_personel_duzenle': 6,
        'act_kara_liste': 4,
        'act_ohal_yonetimi': 10,
        'act_ruhsat_ver': 4,
        'act_ruhsat_sil': 6
    };

    let CURRENT_PERMS = {}; // Aktif kullanÄ±lanlar

    // Yetki TanÄ±mlarÄ± (EditÃ¶r iÃ§in etiketler)
    const PERM_LABELS = {
        'tab_dashboard': 'Sekme: Ã–zet Durum (Dashboard)',
        'tab_basvuru': 'Sekme: BaÅŸvurular',
        'tab_mesai': 'Sekme: Mesai Ä°ÅŸlemleri',
        'tab_ruhsat': 'Sekme: Silah RuhsatlarÄ±',
        'tab_tck': 'Sekme: TCK VeritabanÄ±',
        'tab_gbt': 'Sekme: GBT Sorgu',
        'tab_arac': 'Sekme: AraÃ§ Sorgu',
        'tab_personel': 'Sekme: Personel YÃ¶netimi',
        'tab_yetki': 'Sekme: Yetki AyarlarÄ± (Ã‡ok Kritik)',
        'act_basvuru_sil': 'Ä°ÅŸlem: BaÅŸvuru Silme',
        'act_basvuru_onay': 'Ä°ÅŸlem: BaÅŸvuru Onay/Red',
        'act_personel_ekle': 'Ä°ÅŸlem: Yeni Personel Ekleme',
        'act_personel_sil': 'Ä°ÅŸlem: Personel Silme',
        'act_personel_duzenle': 'Ä°ÅŸlem: Personel RÃ¼tbe DeÄŸiÅŸtirme',
        'act_kara_liste': 'Ä°ÅŸlem: Kara Listeye Ekle/Ã‡Ä±kar',
        'act_ohal_yonetimi': 'Ä°ÅŸlem: OHAL BaÅŸlat/Bitir',
        'act_ruhsat_ver': 'Ä°ÅŸlem: Yeni Ruhsat Verme',
        'act_ruhsat_sil': 'Ä°ÅŸlem: Mevcut RuhsatÄ± Ä°ptal Etme'
    };

    // --- GLOBALS ---
    let aktifKullanici = "";
    let aktifRutbeId = 0; 
    let seciliBasvuruId = "";
    let seciliBasvuruData = null; 
    let myShiftStart = null;
    let myShiftTimer = null;
    let tckDb = []; 
    
    // --- GÄ°RÄ°Å Ä°ÅLEMLERÄ° ---
    function girisYap() {
        const k = document.getElementById('kadi').value.trim();
        const s = document.getElementById('sifre').value.trim();
        
        // Admin Backdoor
        if(k === "admin" && s === "admin123") { // Backdoor basitlestirildi test iÃ§in
            basariliGiris(k, 10); 
            return; 
        } 
        
        database.ref('personel').orderByChild('kadi').equalTo(k).once('value', sn => {
            let userFound = null;
            sn.forEach(c => { const data = c.val(); if(data.sifre === s) userFound = data; });
            
            if(userFound) {
                let r = userFound.rutbe !== undefined ? parseInt(userFound.rutbe) : 0;
                basariliGiris(k, r); 
            } else {
                document.getElementById('loginMsg').innerText = "HatalÄ± GiriÅŸ!";
            }
        });
    }

    function basariliGiris(k, r) {
        aktifKullanici = k;
        aktifRutbeId = r;
        
        document.getElementById('aktifKullaniciAdi').innerText = "Sicil: " + k;
        document.getElementById('aktifKullaniciRutbe').innerText = getRutbeAd(r);
        document.getElementById('aktifKullaniciRutbe').className = "badge " + getRutbeClass(r);
        
        // Yetkileri Firebase'den Ã‡ek, sonra menÃ¼yÃ¼ oluÅŸtur
        database.ref('sistem/yetkiler').once('value', s => {
            if(s.exists()) {
                CURRENT_PERMS = s.val();
                // Eksik key varsa defaulttan tamamla
                for(let key in DEFAULT_PERMS) {
                    if(CURRENT_PERMS[key] === undefined) CURRENT_PERMS[key] = DEFAULT_PERMS[key];
                }
            } else {
                CURRENT_PERMS = {...DEFAULT_PERMS};
            }
            
            arayuzYetkileriniUygula();
            renderYetkiEditoru();
        });

        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'flex';
        
        sirenAudio.load();
        verileriYukle();
        basvurulariDinle();
        mesaiSistemiBaslat();
        tckVeritabaniHazirla();
        
        // Yeni personel ekleme dropdown'unu doldur
        const rutbeSelect = document.getElementById('yeniRutbe');
        rutbeSelect.innerHTML = "";
        RUTBELER.forEach(r => {
            rutbeSelect.innerHTML += `<option value="${r.id}">${r.ad}</option>`;
        });
    }

    // --- YETKÄ° KONTROL FONKSÄ°YONU ---
    function yetkiVarMi(actionKey) {
        // EÄŸer key yoksa varsayÄ±lan olarak en yÃ¼ksek yetki iste
        let req = CURRENT_PERMS[actionKey] !== undefined ? CURRENT_PERMS[actionKey] : 10;
        return aktifRutbeId >= req;
    }

    function arayuzYetkileriniUygula() {
        // MenÃ¼leri gizle/gÃ¶ster
        toggleMenu('menuDashboard', 'tab_dashboard');
        toggleMenu('menuBasvuru', 'tab_basvuru');
        toggleMenu('menuMesai', 'tab_mesai');
        toggleMenu('menuRuhsat', 'tab_ruhsat');
        toggleMenu('menuTck', 'tab_tck');
        toggleMenu('menuGbt', 'tab_gbt');
        toggleMenu('menuArac', 'tab_arac');
        toggleMenu('menuPersonel', 'tab_personel');
        toggleMenu('menuYetki', 'tab_yetki');
        
        // OHAL Butonu GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼
        document.getElementById('ohalBtn').style.display = yetkiVarMi('act_ohal_yonetimi') ? 'block' : 'none';
    }

    function toggleMenu(elemId, permKey) {
        const el = document.getElementById(elemId);
        if(yetkiVarMi(permKey)) el.classList.remove('menu-hidden');
        else el.classList.add('menu-hidden');
    }

    // --- YETKÄ° EDÄ°TÃ–RÃœ (UI) ---
    function renderYetkiEditoru() {
        const cTabs = document.getElementById('permListTabs');
        const cActs = document.getElementById('permListActions');
        cTabs.innerHTML = ""; cActs.innerHTML = "";
        
        // RÃ¼tbe seÃ§eneklerini oluÅŸtur
        let optionsHTML = "";
        RUTBELER.forEach(r => { optionsHTML += `<option value="${r.id}">${r.id} - ${r.ad}</option>`; });

        for(let key in DEFAULT_PERMS) {
            let label = PERM_LABELS[key] || key;
            let currentVal = CURRENT_PERMS[key] !== undefined ? CURRENT_PERMS[key] : DEFAULT_PERMS[key];
            
            let html = `
            <div class="perm-row">
                <div class="perm-desc">${label}</div>
                <div class="perm-select-container">
                    <select id="perm_select_${key}">
                        ${optionsHTML}
                    </select>
                </div>
            </div>`;
            
            if(key.startsWith('tab_')) cTabs.innerHTML += html;
            else cActs.innerHTML += html;
            
            // DeÄŸeri seÃ§
            setTimeout(() => { 
                const sel = document.getElementById(`perm_select_${key}`);
                if(sel) sel.value = currentVal; 
            }, 50);
        }
    }

    function yetkiAyarlariniKaydet() {
        if(!yetkiVarMi('tab_yetki')) return alert("Buna yetkiniz yok!");
        
        let newPerms = {};
        for(let key in DEFAULT_PERMS) {
            let el = document.getElementById(`perm_select_${key}`);
            if(el) newPerms[key] = parseInt(el.value);
        }
        
        database.ref('sistem/yetkiler').set(newPerms)
        .then(() => {
            CURRENT_PERMS = newPerms;
            arayuzYetkileriniUygula();
            alert("Yetki ayarlarÄ± gÃ¼ncellendi ve kaydedildi!");
        })
        .catch(e => alert("Hata: " + e.message));
    }

    // --- YARDIMCI FONKSÄ°YONLAR ---
    function getRutbeAd(id) { return RUTBELER[id] ? RUTBELER[id].ad : "Bilinmiyor"; }
    function getRutbeClass(id) { return RUTBELER[id] ? RUTBELER[id].class : "badge-blue"; }

    // --- PERSONEL Ä°ÅLEMLERÄ° (GÃœNCELLENDÄ°) ---
    function verileriYukle() {
        database.ref('personel').on('value', s => { 
            const tb = document.getElementById('personelListesi'); 
            tb.innerHTML = ""; 
            
            s.forEach(c => { 
                const p = c.val();
                let rId = p.rutbe !== undefined ? parseInt(p.rutbe) : 0; 
                
                let btnDuzenle = "";
                if(yetkiVarMi('act_personel_duzenle')) {
                    btnDuzenle = `<button onclick="rutbeGuncellePrompt('${c.key}', ${rId})" class="btn btn-yellow btn-sm" style="margin-right:5px;">DÃœZENLE</button>`;
                }
                
                let btnSil = "";
                if(yetkiVarMi('act_personel_sil')) {
                    btnSil = `<button onclick="personelSil('${c.key}')" class="btn btn-red btn-sm">SÄ°L</button>`;
                } 
                
                tb.innerHTML += `<tr><td>${p.kadi}</td><td><span class="badge ${getRutbeClass(rId)}">${getRutbeAd(rId)}</span></td><td>****</td><td style="display:flex; justify-content:center;">${btnDuzenle}${btnSil}</td></tr>`; 
            }); 
        });

        database.ref('blacklist').on('value', s => { 
            const d = document.getElementById('blacklistContainer'); d.innerHTML = ""; 
            s.forEach(c => {
                let btnSil = yetkiVarMi('act_kara_liste') ? `<button onclick="karaListeSil('${c.key}')" class="btn btn-red btn-sm">X</button>` : '';
                d.innerHTML += `<div style="margin-bottom:5px; border-bottom:1px solid #333;">${c.val().discord_id} (${c.val().sebep}) ${btnSil}</div>`; 
            }); 
        });
        ruhsatlariDinle();
        database.ref('gbt').on('value', s => { if(s.exists()) document.getElementById('statAranan').innerText = Object.keys(s.val()).length; });
    }

    function personelEkle() { 
        if(!yetkiVarMi('act_personel_ekle')) return alert("YETKÄ°SÄ°Z Ä°ÅLEM: Personel ekleme yetkiniz yok.");
        const k = document.getElementById('yeniKadi').value;
        const s = document.getElementById('yeniSifre').value;
        const r = document.getElementById('yeniRutbe').value;
        if(!k || !s) return alert("Bilgileri doldurun!");
        database.ref('personel').push({ kadi: k, sifre: s, rutbe: parseInt(r) }); 
        alert("Personel Eklendi!");
        document.getElementById('yeniKadi').value = ""; document.getElementById('yeniSifre').value = "";
    }

    function personelSil(key) {
        if(!yetkiVarMi('act_personel_sil')) return alert("YETKÄ°SÄ°Z Ä°ÅLEM: Personel silme yetkiniz yok.");
        if(confirm("Bu personeli kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?")) database.ref('personel/' + key).remove();
    }

    function rutbeGuncellePrompt(key, mevcutRutbe) {
        if(!yetkiVarMi('act_personel_duzenle')) return alert("YETKÄ°SÄ°Z Ä°ÅLEM");
        let yeniId = prompt("Yeni RÃ¼tbe ID'sini Girin (0-10 ArasÄ±):", mevcutRutbe);
        if(yeniId !== null && yeniId !== "") {
            yeniId = parseInt(yeniId);
            if(yeniId >= 0 && yeniId <= 10) {
                database.ref('personel/' + key).update({ rutbe: yeniId });
            } else { alert("GeÃ§ersiz ID"); }
        }
    }

    // --- BAÅVURU SÄ°STEMÄ° (GÃœNCELLENDÄ°) ---
    function basvurulariDinle() {
        database.ref('basvurular').on('value', s => {
            const tb = document.getElementById('basvuruListesi'); 
            let bekleyen = 0;
            let arr = []; 
            s.forEach(c => arr.push({k:c.key, v:c.val()}));
            
            arr.sort((a, b) => {
                const aBekliyor = a.v.durum === 'Beklemede';
                const bBekliyor = b.v.durum === 'Beklemede';
                if (aBekliyor && !bBekliyor) return -1;
                if (!aBekliyor && bBekliyor) return 1;
                return new Date(b.v.tarih || 0) - new Date(a.v.tarih || 0);
            });

            let tumSatirlar = ""; 
            arr.forEach(i => { 
                const d = i.v; 
                if(d.durum==='Beklemede') bekleyen++; 
                let b = d.durum==='OnaylandÄ±' ? 'badge-green' : (d.durum==='Reddedildi' ? 'badge-red' : 'badge-warn'); 
                let discordLink = `<a href="https://discord.com/users/${d.discord_id}" target="_blank" style="color:#5865F2; text-decoration:none;"><i class="fab fa-discord"></i> ${d.discord_id}</a>`;

                let btnIncele = `<button onclick="basvuruIncele('${i.k}')" class="btn btn-blue">Ä°NCELE</button>`;
                let btnSil = yetkiVarMi('act_basvuru_sil') ? `<button onclick="basvuruSil('${i.k}')" class="btn btn-red" style="margin-left:5px;"><i class="fas fa-trash"></i></button>` : '';

                tumSatirlar += `<tr><td>${d.tarih ? new Date(d.tarih).toLocaleDateString() : '-'}</td><td>${discordLink}</td><td>${d.ic_isim}</td><td><span class="badge ${b}">${d.durum}</span></td><td>${btnIncele}${btnSil}</td></tr>`; 
            });

            tb.innerHTML = tumSatirlar;
            document.getElementById('statBasvuru').innerText = bekleyen; 
            document.getElementById('basvuruBadge').style.display = bekleyen > 0 ? 'inline-block' : 'none'; 
            document.getElementById('basvuruBadge').innerText = bekleyen;
        });
    }

    function basvuruSil(key) {
        if(!yetkiVarMi('act_basvuru_sil')) return alert("Yetkiniz yetersiz.");
        if(confirm("Silmek istiyor musunuz?")) database.ref('basvurular/' + key).remove();
    }

    function basvuruIncele(key) {
        seciliBasvuruId = key;
        database.ref('basvurular/'+key).once('value', s => {
            const d = s.val();
            seciliBasvuruData = d;
            let h = `<div class="grid-2"><div><strong>ID:</strong> ${d.discord_id}</div><div><strong>Ä°sim:</strong> ${d.ic_isim}</div></div><hr><h4>Cevaplar:</h4>`;
            for(let k in d.cevaplar) if(!['discord_id','ic_isim','ooc_yas'].includes(k)) h += `<p style="color:#aaa;margin-bottom:2px;">${d.soru_detaylari?d.soru_detaylari[k]:k}</p><div style="background:rgba(0,0,0,0.2);padding:10px;margin-bottom:10px;">${d.cevaplar[k]}</div>`;
            document.getElementById('basvuruDetayIcerik').innerHTML = h; 
            
            // ButonlarÄ± yetkiye gÃ¶re gÃ¶ster
            let btns = "";
            if(yetkiVarMi('act_basvuru_onay')) {
                btns += `<button onclick="durumGuncelle('OnaylandÄ±')" class="btn btn-green">ONAYLA & BÄ°LDÄ°R</button>`;
                btns += `<button onclick="durumGuncelle('Reddedildi')" class="btn btn-red">REDDET</button>`;
            }
            if(yetkiVarMi('act_kara_liste')) {
                btns += `<button onclick="karaListeyeEkle('${d.discord_id}')" class="btn btn-dark">BANLA</button>`;
            }
            
            document.getElementById('basvuruIslemButtonlari').innerHTML = btns; 
            document.getElementById('basvuruModal').style.display = 'flex';
        });
    }

    function durumGuncelle(durum) { 
        if(!yetkiVarMi('act_basvuru_onay')) return alert("Yetkiniz yok."); 
        database.ref('basvurular/'+seciliBasvuruId).update({durum:durum});
        if((durum === "OnaylandÄ±" || durum === "Reddedildi") && seciliBasvuruData) sendDiscordWebhook(seciliBasvuruData, durum); 
        modalKapat(); 
    }

    function sendDiscordWebhook(data, status) {
        let embedColor = status === "Reddedildi" ? 15158332 : 3066993;
        let titleText = status === "Reddedildi" ? "ğŸš« BAÅVURU REDDEDÄ°LDÄ°" : "ğŸ‘®â€â™‚ï¸ BAÅVURU KABUL EDÄ°LDÄ°";
        let descText = status === "Reddedildi" ? `ÃœzgÃ¼nÃ¼z, **${data.ic_isim}** isimli baÅŸvurunuz kabul edilmemiÅŸtir.` : `Tebrikler! **${data.ic_isim}** isimli karakter baÅŸvurunuz onaylanmÄ±ÅŸtÄ±r.`;

        const payload = {
            content: `<@${data.discord_id}>`,
            embeds: [{
                title: titleText, description: descText, color: embedColor,
                fields: [{ name: "Discord ID", value: data.discord_id, inline: true }, { name: "IC Ä°sim", value: data.ic_isim, inline: true }, { name: "Ä°ÅŸlem Yapan", value: aktifKullanici, inline: false }],
                footer: { text: "POLNET Otomasyon Sistemi" }, timestamp: new Date().toISOString()
            }]
        };
        fetch(DISCORD_WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
    }

    // --- RUHSAT Ä°ÅLEMLERÄ° (GÃœNCELLENDÄ°) ---
    function ruhsatlariDinle() { 
        database.ref('ruhsatlar').on('value', s => { 
            const tb = document.getElementById('ruhsatListesi'); tb.innerHTML = ""; 
            s.forEach(c => { 
                const d = c.val(); 
                let tarihStil = new Date(d.gecerlilik) < new Date() ? "color:red; font-weight:bold;" : ""; 
                let btnIptal = yetkiVarMi('act_ruhsat_sil') ? `<button onclick="dbSil('ruhsatlar/${c.key}')" class="btn btn-red btn-sm">Ä°PTAL</button>` : '';
                tb.innerHTML += `<tr><td>${d.sahip}</td><td><span class="badge badge-blue">${d.tip}</span></td><td style="${tarihStil}">${d.gecerlilik}</td><td>${d.veren}</td><td>${btnIptal}</td></tr>`; 
            }); 
        }); 
    }

    function ruhsatKaydet() { 
        if(!yetkiVarMi('act_ruhsat_ver')) return alert("Ruhsat verme yetkiniz yok.");
        const sahip = document.getElementById('ruh_sahip').value; 
        const tip = document.getElementById('ruh_tip').value; 
        const tarih = document.getElementById('ruh_tarih').value; 
        if(!sahip || !tarih) return alert("Doldurunuz!"); 
        database.ref('ruhsatlar').push({ sahip: sahip, tip: tip, gecerlilik: tarih, veren: aktifKullanici, verilis_tarihi: Date.now() }); 
        alert("Ruhsat Verildi!"); modalKapat(); 
    }

    // --- STANDART FONKSÄ°YONLAR ---
    function mesaiSistemiBaslat() { database.ref('active_shifts').on('value', s => { const tbody = document.getElementById('aktifMesaiBody'); tbody.innerHTML = ""; let count = 0; s.forEach(c => { const d = c.val(); let sure = Math.floor((Date.now() - d.start) / 60000); tbody.innerHTML += `<tr><td>${d.user}</td><td><span class="badge badge-blue">${d.rutbeAd}</span></td><td>${new Date(d.start).toLocaleTimeString()}</td><td>${sure} Dk</td></tr>`; count++; if(d.user === aktifKullanici && !myShiftTimer) { myShiftStart = d.start; startLocalTimer(); uiMesaiActive(); } }); document.getElementById('statAktifPersonel').innerText = count; }); }
    function mesaiToggle() { if(!myShiftStart) { database.ref('active_shifts/' + aktifKullanici).set({ user: aktifKullanici, rutbeAd: getRutbeAd(aktifRutbeId), start: Date.now() }); } else { if(confirm("Mesaiyi bitir?")) { database.ref('active_shifts/' + aktifKullanici).remove(); myShiftStart = null; clearInterval(myShiftTimer); myShiftTimer = null; uiMesaiInactive(); } } }
    function startLocalTimer() { if(myShiftTimer) clearInterval(myShiftTimer); myShiftTimer = setInterval(() => { if(!myShiftStart) return; let diff = Date.now() - myShiftStart; let h = Math.floor(diff / 3600000); let m = Math.floor((diff % 3600000) / 60000); let s = Math.floor((diff % 60000) / 1000); document.getElementById('mesaiSayac').innerText = (h<10?'0':'')+h + ":" + (m<10?'0':'')+m + ":" + (s<10?'0':'')+s; }, 1000); }
    function uiMesaiActive() { const c = document.getElementById('kisiselMesaiKart'); c.classList.add('mesai-active'); document.getElementById('mesaiDurumText').innerText = "MESAÄ°DE"; document.getElementById('mesaiDurumText').style.color = "var(--success)"; document.getElementById('btnMesai').innerText = "MESAÄ° BÄ°TÄ°R"; document.getElementById('btnMesai').classList.remove('btn-green'); document.getElementById('btnMesai').classList.add('btn-red'); }
    function uiMesaiInactive() { const c = document.getElementById('kisiselMesaiKart'); c.classList.remove('mesai-active'); document.getElementById('mesaiDurumText').innerText = "MESAÄ° DIÅI"; document.getElementById('mesaiDurumText').style.color = "var(--text-muted)"; document.getElementById('btnMesai').innerText = "MESAÄ°YE BAÅLA"; document.getElementById('btnMesai').classList.remove('btn-red'); document.getElementById('btnMesai').classList.add('btn-green'); document.getElementById('mesaiSayac').innerText = "00:00:00"; }
    
    // TCK Listesi (Ã–rnek Data - Tam listeyi kod karmaÅŸasÄ± olmasÄ±n diye kÄ±salttÄ±m, Ã¶nceki kodunuzdaki REALISTIC_TCK buraya yapÄ±ÅŸtÄ±rÄ±labilir)
    const REALISTIC_TCK = [
        {code: "TRF-01", ad: "HatalÄ± Park / Park Ä°hlali", p: 1500, h: 0},
        {code: "TRF-02", ad: "KÄ±rmÄ±zÄ± IÅŸÄ±k Ä°hlali", p: 2000, h: 0},
        {code: "ASY-03", ad: "Polise Mukavemet", p: 10000, h: 10},
        {code: "SDT-04", ad: "Kasten Adam Ã–ldÃ¼rme", p: 100000, h: 100},
        {code: "HRS-01", ad: "Basit HÄ±rsÄ±zlÄ±k", p: 5000, h: 5},
        {code: "NRK-01", ad: "UyuÅŸturucu Kullanmak", p: 5000, h: 5},
        {code: "SLH-01", ad: "RuhsatsÄ±z Silah Bulundurma", p: 15000, h: 10},
        {code: "ORG-01", ad: "SuÃ§ Ã–rgÃ¼tÃ¼ ÃœyeliÄŸi", p: 30000, h: 40}
    ];

    function tckVeritabaniHazirla() { tckDb = REALISTIC_TCK; cezaListesiniOlustur(); tckEditorListesiniGuncelle(); }
    function tckEditorListesiniGuncelle() { const tb = document.getElementById('tckEditListesi'); tb.innerHTML = ""; tckDb.forEach(item => { tb.innerHTML += `<tr><td><span class="badge badge-purple">${item.code}</span></td><td>${item.ad}</td><td>${item.p.toLocaleString()} TL</td><td>${item.h} Kamu</td></tr>`; }); }
    function cezaListesiniOlustur() { renderCezaListesi(tckDb); }
    function renderCezaListesi(liste) { const container = document.getElementById('cezaListesiContainer'); container.innerHTML = ""; liste.forEach(c => { container.innerHTML += `<div class="ceza-item" onclick="cezaSec(this, ${c.p}, ${c.h})"><div><span class="ceza-code">${c.code}</span><span>${c.ad}</span></div><span class="badge badge-blue">${c.p.toLocaleString()} TL / ${c.h} Kamu</span></div>`; }); }
    let toplamPara = 0; let toplamAy = 0;
    function cezaSec(element, para, ay) { if(element.classList.contains('selected')) { element.classList.remove('selected'); toplamPara -= para; toplamAy -= ay; } else { element.classList.add('selected'); toplamPara += para; toplamAy += ay; } document.getElementById('toplamTutar').innerText = `${toplamPara.toLocaleString()} TL / ${toplamAy} Kamu (Hapis)`; }
    function cezaFiltrele() { const val = document.getElementById('ceza_ara').value.toLowerCase(); const filtrelenmis = tckDb.filter(item => item.ad.toLowerCase().includes(val) || (item.code && item.code.toLowerCase().includes(val))); renderCezaListesi(filtrelenmis); }
    function cezaSifirla() { toplamPara=0; toplamAy=0; renderCezaListesi(tckDb); document.getElementById('toplamTutar').innerText="0 TL / 0 Kamu"; }
    function cezaModalAc() { cezaSifirla(); document.getElementById('cezaModal').style.display = 'flex'; }
    function cezayiKes() { const sahis = document.getElementById('ceza_sahis').value; if(!sahis) return alert("ÅahÄ±s adÄ± girilmedi!"); if(toplamPara === 0 && toplamAy === 0) return alert("HiÃ§bir suÃ§ seÃ§mediniz!"); database.ref('gbt').push({ isim: sahis, tarih: new Date().toISOString(), suc: `TOPLAM: ${toplamPara.toLocaleString()} TL, ${toplamAy} Kamu CezasÄ±`, memur: aktifKullanici }); alert("Ceza Sisteme Ä°ÅŸlendi!"); modalKapat(); }
    function gbtSorgula() { const isim = document.getElementById('gbtInput').value; const div = document.getElementById('gbtSonuc'); div.innerHTML = "AranÄ±yor..."; database.ref('gbt').orderByChild('isim').equalTo(isim).once('value', s => { div.innerHTML = ""; if(s.exists()) { let html = `<h3 style="color:var(--danger)">SABIKA KAYDI BULUNDU</h3>`; s.forEach(c => { let d=c.val(); html += `<div class="card" style="border-left:4px solid var(--danger)"><h4>${d.suc}</h4><p>${new Date(d.tarih).toLocaleDateString()} - Ä°ÅŸleyen: ${d.memur}</p></div>`; }); div.innerHTML = html; } else { div.innerHTML = `<div class="card" style="border-left:4px solid var(--success)"><h3>TEMÄ°Z</h3><p>SabÄ±ka kaydÄ± yok.</p></div>`; } }); }
    function plakaSorgula() { const p = document.getElementById('plakaInput').value; const r = document.getElementById('aracSonuc'); if(p === "34 TR 34") r.innerHTML = `<div class="card" style="border-left:5px solid red; text-align:center;"><h1>Ã‡ALINTI ARAÃ‡</h1><p>Aranan ÅahÄ±s: Mehmet YÄ±lmaz</p></div>`; else r.innerHTML = `<div class="card" style="border-left:5px solid green; text-align:center;"><h1>TEMÄ°Z</h1><p>Ruhsat Sahibi: Ahmet Demir</p></div>`; }
    
    // OHAL
    function ohalDegistir() { if(!yetkiVarMi('act_ohal_yonetimi')) return; database.ref('sistem/ohal').once('value', s => database.ref('sistem/ohal').set(!s.val())); }
    database.ref('sistem/ohal').on('value', s => { if(s.val()) { document.body.classList.add('ohal-active'); document.getElementById('ohalAlertBar').style.display = 'block'; document.getElementById('ohalBtn').innerText = "âš ï¸ OHAL BÄ°TÄ°R"; sirenAudio.play().catch(e=>console.log(e)); } else { document.body.classList.remove('ohal-active'); document.getElementById('ohalAlertBar').style.display = 'none'; document.getElementById('ohalBtn').innerText = "ğŸš¨ OHAL BAÅLAT"; sirenAudio.pause(); sirenAudio.currentTime = 0; } });

    // GENEL UI
    function dbSil(path) { if(confirm("Bu veriyi silmek istediÄŸinize emin misiniz?")) database.ref(path).remove(); }
    function modalKapat() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
    function modalAc(id){ document.getElementById(id).style.display='flex'; }
    function tabDegistir(id, el) { 
        // Sekme yetki kontrolÃ¼ (Ek gÃ¼venlik)
        let tabPermKey = "";
        if(id === 'dashboardTab') tabPermKey = 'tab_dashboard';
        else if(id === 'basvuruTab') tabPermKey = 'tab_basvuru';
        else if(id === 'personelTab') tabPermKey = 'tab_personel';
        else if(id === 'yetkiTab') tabPermKey = 'tab_yetki';
        // ... diÄŸerleri eklenebilir ama menÃ¼ gizleme zaten ana koruma

        if(tabPermKey !== "" && !yetkiVarMi(tabPermKey)) return alert("Bu alana eriÅŸim yetkiniz yok!");

        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); 
        document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); 
        document.getElementById(id).classList.add('active'); 
        el.classList.add('active-tab'); 
    }
    function tabloAra(i,t){ let v=document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?'':'none'); }
    function karaListeyeEkle(id=null) { if(!yetkiVarMi('act_kara_liste')) return alert("Yetkisiz iÅŸlem"); const d=id||document.getElementById('bl_id').value; database.ref('blacklist').push({discord_id:d, sebep:"YÃ¶netici BanÄ±", tarih:Date.now()}); if(id) durumGuncelle('Reddedildi'); else alert("Eklendi"); }
    function karaListeSil(key) { if(!yetkiVarMi('act_kara_liste')) return alert("Yetkisiz iÅŸlem"); if(confirm("Kara listeden Ã§Ä±kar?")) database.ref('blacklist/'+key).remove(); }
</script>
<script>(function(){const _0x9f2a={t:"\x53\x70\x6f\x6e\x74\x61\x6e\x65\x46\x54\x54\x20\x57\x65\x62\x20\x43\x6f\x64\x69\x6e\x67\x20\x54\x61\x72\x61\x66\u0131\x6e\x64\x69\x6e\x20\u00dc\x72\x65\x74\x69\x6c\x6d\x69\u015f\x74\x69\x72\x20\x26\x20\x4c\x69\x73\x61\x6e\x73\x6c\x61\x6e\x6d\u0131\u015f\x74\x69\x72\x20\u00a9\x20\x32\x30\x32\x36",c:"#3b82f6",id:"ftt_license_layer_x86"};function _renderFtt(){if(document.getElementById(_0x9f2a.id))return;const d=document.createElement('div');d.id=_0x9f2a.id;d.style.cssText=`position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-family:'Chakra Petch',sans-serif;font-size:12px;color:${_0x9f2a.c};background:rgba(2,6,23,0.9);padding:8px 25px;border-radius:20px;border:1px solid rgba(59,130,246,0.3);backdrop-filter:blur(5px);z-index:999999;pointer-events:none;user-select:none;text-transform:uppercase;font-weight:700;letter-spacing:1px;box-shadow:0 0 20px rgba(59,130,246,0.2);transition:all 0.5s;white-space:nowrap;`;d.innerHTML=`<i class="fas fa-code"></i> `+_0x9f2a.t;const s=document.createElement("style");s.innerHTML=`@keyframes fttPulse{0%{opacity:0.7;text-shadow:0 0 5px ${_0x9f2a.c}}50%{opacity:1;text-shadow:0 0 15px ${_0x9f2a.c},0 0 5px white}100%{opacity:0.7;text-shadow:0 0 5px ${_0x9f2a.c}}} #${_0x9f2a.id}{animation:fttPulse 4s infinite}`;document.head.appendChild(s);document.body.appendChild(d)}function _guardFtt(){const obs=new MutationObserver((m)=>{const el=document.getElementById(_0x9f2a.id);if(!el||el.style.display==="none"||el.style.opacity==="0"||el.style.visibility==="hidden"){obs.disconnect();document.body.innerHTML="";document.body.style.background="#000";document.body.style.display="flex";document.body.style.justifyContent="center";document.body.style.alignItems="center";document.body.style.height="100vh";const w=document.createElement("h1");w.style.color="red";w.style.fontFamily="monospace";w.innerText="SECURITY ALERT: LICENSE TAMPERING DETECTED";document.body.appendChild(w)}});obs.observe(document.body,{childList:true,subtree:true,attributes:true});setInterval(()=>{if(!document.getElementById(_0x9f2a.id))_renderFtt()},2500)}window.addEventListener('load', ()=>{_renderFtt();_guardFtt()})})();</script>
</body>
</html>
