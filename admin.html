<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLNET v6.3 - Salary System Fix</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0f172a; --sidebar-bg: #020617; --card-bg: #1e293b; --text-main: #f1f5f9; --text-muted: #94a3b8; --border: #334155; --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; }
        
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 14px; transition: background 0.5s ease; }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -280px; top: 0; height: 100%; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.5); }
            .sidebar.active { left: 0; }
            .content { padding: 15px; width: 100%; margin-left: 0 !important; }
            #mobileMenuBtn { display: block !important; }
        }
        #mobileMenuBtn { display: none; position: fixed; top: 15px; left: 15px; z-index: 2000; font-size: 1.5rem; background: var(--card-bg); padding: 10px; border-radius: 5px; border: 1px solid var(--border); cursor: pointer; }

        #toastContainer { position: fixed; top: 20px; right: 20px; z-index: 5000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--card-bg); border-left: 4px solid var(--accent); padding: 15px; min-width: 250px; border-radius: 4px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideIn 0.3s; display: flex; align-items: center; justify-content: space-between; }
        .toast.success { border-color: var(--success); } .toast.error { border-color: var(--danger); } .toast.warning { border-color: var(--warning); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        body.ohal-active { --bg-dark: #2a0505; --sidebar-bg: #1a0000; --card-bg: #3f0a0a; --accent: #ff0000; --border: #5c1818; animation: redPulse 2s infinite alternate; }
        @keyframes redPulse { 0% { box-shadow: inset 0 0 0 0 rgba(255, 0, 0, 0); } 100% { box-shadow: inset 0 0 100px 30px rgba(255, 0, 0, 0.4); } }
        
        #ohalAlertBar { background: #000; color: red; font-family: 'Chakra Petch', sans-serif; font-weight: 900; font-size: 1.5rem; padding: 10px 0; border-bottom: 4px solid red; white-space: nowrap; overflow: hidden; display: none; z-index: 9999; position: fixed; top: 0; width: 100%; letter-spacing: 2px; }
        .ohal-content { display: inline-block; padding-left: 100%; animation: ohalScroll 15s linear infinite; }
        @keyframes ohalScroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; z-index: 100; padding-bottom: 50px; }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; background-image: radial-gradient(var(--card-bg) 1px, transparent 1px); background-size: 20px 20px; padding-bottom: 50px; }
        body.ohal-active .sidebar, body.ohal-active .content { margin-top: 50px; }

        .menu-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 10px; color: var(--text-muted); transition: 0.2s; font-weight: 500; font-family: 'Chakra Petch', sans-serif; letter-spacing: 0.5px; }
        .menu-item:hover, .active-tab { background: rgba(59,130,246,0.15); color: white; border-left: 3px solid var(--accent); }
        .menu-hidden { display: none !important; }

        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        h1, h2, h3 { font-family: 'Chakra Petch', sans-serif; margin-top: 0; }
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 10px; font-family: 'Inter', sans-serif; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }
        option { background: var(--card-bg); color: white; }

        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 5px; justify-content: center; font-family: 'Chakra Petch', sans-serif; text-transform: uppercase; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-blue { background: var(--accent); } .btn-green { background: var(--success); } .btn-red { background: var(--danger); } .btn-dark { background: #334155; } .btn-yellow { background: #f59e0b; color:black; } .btn-purple { background: #9333ea; }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; }

        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        th { background: rgba(0,0,0,0.4); color: var(--accent); padding: 15px; text-align: left; border-bottom: 2px solid var(--border); font-family: 'Chakra Petch', sans-serif; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); width: 70%; max-height: 90vh; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: zoomIn 0.2s; }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-header { padding: 20px; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 25px; overflow-y: auto; }

        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-blue { background: rgba(59,130,246,0.2); color: var(--accent); border: 1px solid var(--accent); }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .badge-green { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
        .badge-warn { background: rgba(245, 158, 11, 0.2); color: var(--warning); border: 1px solid var(--warning); }
        .badge-purple { background: rgba(147, 51, 234, 0.2); color: #c084fc; border: 1px solid #c084fc; }
        .badge-gold { background: rgba(255, 215, 0, 0.2); color: #ffd700; border: 1px solid #ffd700; }

        .mesai-card { text-align: center; border: 2px solid var(--border); transition: 0.3s; }
        .mesai-active { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        #mesaiSayac { font-size: 3rem; font-family: 'Chakra Petch', monospace; font-weight: bold; margin: 20px 0; }
        
        .ceza-item { padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; font-size: 0.9rem; }
        .ceza-item:hover { background: rgba(255,255,255,0.05); }
        .ceza-item.selected { background: rgba(59,130,246,0.2); border-left: 4px solid var(--accent); }
        .ceza-code { color: var(--text-muted); font-family: 'Chakra Petch'; margin-right: 10px; width: 60px; display:inline-block; font-weight:bold; }
        
        #boloContainer::-webkit-scrollbar { height: 8px; }
        #boloContainer::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        #boloContainer::-webkit-scrollbar-thumb { background: var(--danger); border-radius: 4px; }
        
        .log-row { font-family: monospace; font-size: 0.85rem; }
        .log-action { font-weight: bold; color: var(--accent); }
    </style>
</head>
<body>

<div id="ohalAlertBar"><div class="ohal-content">âš ï¸ DÄ°KKAT: OLAÄANÃœSTÃœ HAL (OHAL) Ä°LAN EDÄ°LMÄ°ÅTÄ°R! âš ï¸ TÃœM Ä°ZÄ°NLER Ä°PTAL. SOKAÄA Ã‡IKMA YASAÄI AKTÄ°F. ÅÃœPHELÄ° GÃ–RÃœLEN HERKES GÃ–ZALTINA ALINACAKTIR.</div></div>
<div id="toastContainer"></div>
<i class="fas fa-bars" id="mobileMenuBtn" onclick="toggleSidebar()"></i>

<div id="loginScreen">
    <div style="background:var(--card-bg); padding:50px; border-radius:15px; width:400px; text-align:center; border:1px solid var(--border); box-shadow: 0 0 80px rgba(0,0,0,0.6);">
        <img src="egmm.png" style="width:100px; margin-bottom:20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
        <h2 style="margin:0; color:white; letter-spacing: 2px;">POLNET v6.3</h2>
        <p style="color:var(--text-muted); margin-bottom:30px;">Emniyet Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ Personel GiriÅŸi</p>
        <input type="text" id="kadi" placeholder="Sicil No">
        <input type="password" id="sifre" placeholder="Åifre">
        <button onclick="sesCal('click'); girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px; padding: 15px;">SÄ°STEME GÄ°RÄ°Å YAP</button>
        <p id="loginMsg" style="color:var(--danger); margin-top:15px;"></p>
        <p style="font-size:10px; color:#555;">v6.3 Salary System Fix</p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar" id="mainSidebar">
        <div style="text-align:center; margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
            <img src="egmm.png" style="width:70px; margin-bottom:10px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
            <h3 style="margin:0; font-size:1.4rem;">POLNET</h3>
            <div id="aktifKullaniciAdi" style="font-weight:bold; color:white; margin-top:10px;"></div>
            <div id="aktifKullaniciRutbe" class="badge badge-blue" style="margin-top:5px; display:inline-block;">YÃœKLENÄ°YOR...</div>
        </div>

        <div id="menuDashboard" class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-pie"></i> Ã–zet Durum</div>
        <div id="menuBasvuru" class="menu-item" onclick="tabDegistir('basvuruTab', this)"><i class="fas fa-clipboard-list"></i> BaÅŸvurular <span id="basvuruBadge" class="badge badge-red" style="margin-left:auto; display:none;">0</span></div>
        <div id="menuMesai" class="menu-item" onclick="tabDegistir('mesaiTab', this)"><i class="fas fa-clock"></i> Mesai & MaaÅŸ</div>
        <div id="menuRuhsat" class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Silah RuhsatlarÄ±</div>
        <div id="menuTck" class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book"></i> TCK VeritabanÄ±</div>
        <div id="menuTckEdit" class="menu-item menu-hidden" onclick="tabDegistir('tckAdminTab', this)" style="color:#f59e0b;"><i class="fas fa-balance-scale"></i> Kanun YÃ¶netimi</div>
        <div id="menuGbt" class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-fingerprint"></i> GBT Sorgu & Ä°ÅŸlem</div>
        <div id="menuArac" class="menu-item" onclick="tabDegistir('aracTab', this)"><i class="fas fa-car"></i> AraÃ§ & Trafik</div>
        <div id="menuPersonel" class="menu-item" onclick="tabDegistir('personelTab', this)"><i class="fas fa-users-cog"></i> Personel YÃ¶netimi</div>
        <div id="menuLogs" class="menu-item menu-hidden" onclick="tabDegistir('logTab', this)" style="color:#a855f7;"><i class="fas fa-history"></i> Denetim KayÄ±tlarÄ±</div>
        
        <div style="margin-top:auto;">
            <button id="ohalBtn" onclick="sesCal('click'); ohalDegistir()" class="btn btn-red" style="width:100%; margin-bottom:10px; padding:15px; font-size:1rem;">ğŸš¨ OHAL BAÅLAT</button>
            <button onclick="location.reload()" class="btn btn-dark" style="width:100%;">GÃœVENLÄ° Ã‡IKIÅ</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <h1 style="margin-bottom:20px;">Komuta Merkezi</h1>
            
            <div class="card" style="border-top: 4px solid var(--danger); margin-bottom:20px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h3 style="margin:0;"><i class="fas fa-binoculars"></i> BOLO (Acil AranÄ±yor)</h3>
                    <button onclick="boloEklePrompt()" class="btn btn-red btn-sm">+ BOLO EKLE</button>
                </div>
                <div id="boloContainer" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; min-height:80px;">
                    <div style="color:#666; padding:10px;">Aktif aranma kaydÄ± bulunmamaktadÄ±r.</div>
                </div>
            </div>

            <div class="grid-3">
                <div class="card" style="border-left:4px solid var(--warning);"><h3>Bekleyen BaÅŸvuru</h3><h1 id="statBasvuru">0</h1></div>
                <div class="card" style="border-left:4px solid var(--danger);"><h3>Aranan ÅahÄ±s</h3><h1 id="statAranan">0</h1></div>
                <div class="card" style="border-left:4px solid var(--success);"><h3>Aktif Devriye</h3><h1 id="statAktifPersonel">0</h1></div>
            </div>
        </div>

        <div id="basvuruTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;"><h1>Gelen BaÅŸvurular</h1><button onclick="sesCal('click'); verileriYukle()" class="btn btn-dark"><i class="fas fa-sync"></i> Yenile</button></div>
            <div class="card">
                <input type="text" id="basvuruAra" placeholder="Ä°sim veya Discord ID ara..." onkeyup="tabloAra('basvuruAra','basvuruListesi')">
                <table><thead><tr><th>Tarih</th><th>Discord ID</th><th>IC Ä°sim</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="basvuruListesi"></tbody></table>
            </div>
            <div class="card"><h3>ğŸš« Kara Liste</h3><div style="display:flex; gap:10px;"><input id="bl_id" placeholder="Discord ID"><input id="bl_sebep" placeholder="Sebep"><button onclick="sesCal('click'); karaListeyeEkle()" class="btn btn-red">EKLE</button></div><div id="blacklistContainer" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div></div>
        </div>

        <div id="ruhsatTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Silah RuhsatÄ± YÃ¶netimi</h1>
                <button onclick="sesCal('click'); modalAc('ruhsatEkleModal')" class="btn btn-blue">+ YENÄ° RUHSAT TANIMLA</button>
            </div>
            <div class="card">
                <input type="text" id="ruhsatAra" placeholder="Ruhsat sahibi adÄ± ara..." onkeyup="tabloAra('ruhsatAra','ruhsatListesi')">
                <table><thead><tr><th>Ruhsat Sahibi</th><th>Ruhsat Tipi</th><th>GeÃ§erlilik Tarihi</th><th>Veren Memur</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="ruhsatListesi"></tbody></table>
            </div>
        </div>

        <div id="cezaRehberTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;"><h1>Ceza Kanunu Rehberi (TCK)</h1></div>
            <div class="card" style="height:600px; overflow-y:auto;">
                <input id="tckAra" placeholder="Kanun kodu veya adÄ± ara..." onkeyup="tabloAra('tckAra','tckEditListesi')">
                <table><thead><tr><th>Kod</th><th>SuÃ§ TanÄ±mÄ±</th><th>Para CezasÄ±</th><th>Kamu CezasÄ±</th></tr></thead><tbody id="tckEditListesi"></tbody></table>
            </div>
        </div>

        <div id="tckAdminTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Kanun YÃ¶netimi (Admin)</h1>
                <div>
                    <button onclick="sesCal('click'); tckSifirla()" class="btn btn-red btn-sm">VARSAYILANA DÃ–N</button>
                    <button onclick="sesCal('click'); modalAc('tckEkleModal')" class="btn btn-green">+ YENÄ° KANUN EKLE</button>
                </div>
            </div>
            <p style="color:var(--warning);">Dikkat: Burada yapÄ±lan deÄŸiÅŸiklikler anÄ±nda tÃ¼m personelin ekranÄ±na yansÄ±r.</p>
            <div class="card">
                <input type="text" id="tckAdminAra" placeholder="DÃ¼zenlenecek kanun ara..." onkeyup="tabloAra('tckAdminAra','tckAdminListesi')">
                <table><thead><tr><th>Kod</th><th>SuÃ§ TanÄ±mÄ±</th><th>Para (TL)</th><th>Hapis (Kamu)</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="tckAdminListesi"></tbody></table>
            </div>
        </div>

        <div id="mesaiTab" class="tab-content">
            <h1>Mesai Ä°ÅŸlemleri</h1>
            <div class="grid-2">
                <div class="card mesai-card" id="kisiselMesaiKart">
                    <h3 id="mesaiDurumText" style="color:var(--text-muted);">MESAÄ° DIÅI</h3>
                    <div id="mesaiSayac">00:00:00</div>
                    <button onclick="sesCal('click'); mesaiToggle()" id="btnMesai" class="btn btn-green" style="font-size:1.5rem; padding:15px 50px;">MESAÄ°YE BAÅLA</button>
                </div>
                <div class="card" style="display:flex; flex-direction:column; justify-content:center; align-items:center;">
                    <h3><i class="fas fa-coins"></i> Muhasebe</h3>
                    <p style="text-align:center; color:#aaa;">Ay sonu prim ve maaÅŸ hesaplamalarÄ± iÃ§in.</p>
                    <button onclick="maasModalAc()" class="btn btn-yellow" style="width:80%; margin-bottom:10px;">MAAÅLARI HESAPLA</button>
                    <button id="btnMaasDuzenle" onclick="maasDuzenleModalAc()" class="btn btn-purple menu-hidden" style="width:80%; font-size:0.8rem; margin-bottom:10px;"><i class="fas fa-edit"></i> MAAÅ AYARLARI</button>
                    <button id="btnMesaiSifirla" onclick="mesaiSifirla()" class="btn btn-red menu-hidden" style="width:80%; font-size:0.8rem;"><i class="fas fa-trash"></i> MESAÄ° GEÃ‡MÄ°ÅÄ°NÄ° SIFIRLA</button>
                </div>
            </div>
            
            <div class="card"><h3><i class="fas fa-users"></i> Aktif Personeller</h3><table id="aktifMesaiTablo"><thead><tr><th>Personel</th><th>RÃ¼tbe</th><th>BaÅŸlangÄ±Ã§ Saati</th><th>Aktif SÃ¼re</th></tr></thead><tbody id="aktifMesaiBody"></tbody></table></div>
        </div>

        <div id="gbtTab" class="tab-content">
            <h1>GBT Sorgu & Ceza Sistemi</h1>
            <div class="card"><div class="grid-2"><input id="gbtInput" placeholder="VatandaÅŸ AdÄ±..."><button onclick="sesCal('click'); gbtSorgula()" class="btn btn-green">SORGULA</button></div></div>
            <div id="gbtSonuc"></div>
            <button onclick="sesCal('click'); cezaModalAc()" class="btn btn-red" style="width:100%; margin-top:20px; padding:20px; font-size:1.2rem;">âš–ï¸ YENÄ° CEZA / SABIKA KAYDI OLUÅTUR</button>
        </div>

        <div id="aracTab" class="tab-content">
            <h1>Trafik Åube</h1>
            <div class="card" style="text-align:center;">
                <input id="plakaInput" placeholder="PLAKA (34 TR 34)" style="text-align:center; font-size:3rem; text-transform:uppercase; letter-spacing:5px; font-family:'Chakra Petch'; width:60%;">
                <br><br><button onclick="sesCal('click'); plakaSorgula()" class="btn btn-green" style="padding:15px 40px; font-size:1.2rem;">SORGULA</button>
            </div>
            <div id="aracSonuc" style="margin-top:20px;"></div>
        </div>

        <div id="personelTab" class="tab-content">
            <h1>Personel YÃ¶netimi</h1>
            <div class="card">
                <div class="grid-3">
                    <input id="yeniKadi" placeholder="Sicil No">
                    <input id="yeniSifre" placeholder="Åifre">
                    <select id="yeniRutbe"></select>
                </div>
                <button onclick="sesCal('click'); personelEkle()" class="btn btn-green" style="width:100%">PERSONEL EKLE</button>
            </div>
            <table><thead><tr><th>Sicil</th><th>RÃ¼tbe</th><th>Åifre</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="personelListesi"></tbody></table>
        </div>

        <div id="logTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Sistem Denetim KayÄ±tlarÄ± (Logs)</h1>
                <button onclick="database.ref('sistem/logs').remove()" class="btn btn-red btn-sm">TEMÄ°ZLE</button>
            </div>
            <div class="card" style="height:600px; overflow-y:auto;">
                <table><thead><tr><th>Tarih</th><th>Memur</th><th>Ä°ÅŸlem DetayÄ±</th></tr></thead><tbody id="logListesi"></tbody></table>
            </div>
        </div>
    </div>
</div>

<div id="tckEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Yeni Kanun Ekle</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body">
    <input id="tck_yeni_kod" placeholder="Kanun Kodu (Ã–rn: TRF-99)">
    <input id="tck_yeni_ad" placeholder="SuÃ§ TanÄ±mÄ±">
    <input type="number" id="tck_yeni_p" placeholder="Para CezasÄ± (TL)">
    <input type="number" id="tck_yeni_h" placeholder="Kamu CezasÄ± (Ay/Tur)">
    <button onclick="tckKaydet()" class="btn btn-green" style="width:100%">KANUNU KAYDET</button>
</div></div></div>

<div id="maasModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>MaaÅŸ Hesaplama Tablosu</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body">
    <p>AÅŸaÄŸÄ±daki tablo, sistemdeki kayÄ±tlÄ± tamamlanmÄ±ÅŸ mesai sÃ¼relerine gÃ¶re hesaplanmÄ±ÅŸtÄ±r.</p>
    <table style="font-size:0.9rem;"><thead><tr><th>Personel</th><th>RÃ¼tbe</th><th>Toplam SÃ¼re (Saat)</th><th>Saatlik Ãœcret</th><th>Hak EdiÅŸ</th></tr></thead><tbody id="maasTabloBody"></tbody></table>
    <div style="background:rgba(255,255,255,0.05); padding:10px; margin-top:10px; text-align:right;">
        <strong>Toplam DaÄŸÄ±tÄ±lacak: </strong> <span id="maasToplamTutar" style="color:var(--success); font-size:1.2rem;">0 TL</span>
    </div>
</div></div></div>

<div id="maasDuzenleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>RÃ¼tbe MaaÅŸlarÄ±nÄ± DÃ¼zenle</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body">
    <div id="maasInputContainer" style="height:400px; overflow-y:auto;"></div>
    <button onclick="maaslariKaydet()" class="btn btn-green" style="width:100%; margin-top:10px;">KAYDET VE GÃœNCELLE</button>
</div></div></div>

<div id="basvuruModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>BaÅŸvuru Ä°nceleme</h3><span onclick="modalKapat()" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div class="modal-body"><div id="basvuruDetayIcerik"></div><hr style="border-color:var(--border); margin:20px 0;"><div id="basvuruIslemButtonlari" class="grid-3"></div></div></div></div>
<div id="ruhsatEkleModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Yeni Silah RuhsatÄ±</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body"><input id="ruh_sahip" placeholder="Ruhsat Sahibi (Ad Soyad)"><select id="ruh_tip"><option value="Silah TaÅŸÄ±ma">Silah TaÅŸÄ±ma RuhsatÄ±</option><option value="Silah Bulundurma">Silah Bulundurma RuhsatÄ±</option><option value="Av TÃ¼feÄŸi">Av TÃ¼feÄŸi RuhsatÄ±</option></select><label style="color:var(--text-muted); font-size:0.8rem;">GeÃ§erlilik Tarihi:</label><input type="date" id="ruh_tarih"><button onclick="ruhsatKaydet()" class="btn btn-green" style="width:100%; margin-top:10px;">RUHSATI OLUÅTUR</button></div></div></div>

<div id="cezaModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>Adalet BakanlÄ±ÄŸÄ± Ceza Sistemi</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body">
    <div class="grid-2">
        <input id="ceza_sahis" placeholder="SuÃ§lu AdÄ± SoyadÄ±..." style="border:2px solid var(--accent);">
        <input id="ceza_kanit" placeholder="KanÄ±t FotoÄŸrafÄ± (URL) - Zorunlu DeÄŸil">
    </div>
    <div class="grid-2"><input id="ceza_ara" placeholder="SuÃ§ Kodu veya AdÄ± Ara..." onkeyup="cezaFiltrele()"><button onclick="sesCal('click'); cezaSifirla()" class="btn btn-dark">SeÃ§imleri Temizle</button></div>
    <div style="height:400px; overflow-y:auto; border:1px solid #334155; padding:10px; margin-bottom:15px;" id="cezaListesiContainer"></div>
    <div style="background:#0f172a; padding:15px; text-align:center; border-radius:8px;"><h2 id="toplamTutar" style="color:var(--danger); margin:0;">0 TL / 0 Kamu (Hapis)</h2></div>
    <button onclick="cezayiKes()" class="btn btn-red" style="width:100%; margin-top:15px; padding:15px;">CEZAYI ONAYLA VE Ä°ÅLE</button>
</div></div></div>

<div id="kisiselYetkiModal" class="modal"><div class="modal-content" style="width: 500px;"><div class="modal-header"><h3><i class="fas fa-user-shield"></i> Ã–zel Yetki YapÄ±landÄ±rmasÄ±</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div><div class="modal-body"><h4 id="yetkiModalUserTitle" style="margin-top:0; color:var(--accent);">KullanÄ±cÄ±: ...</h4><p style="color:var(--text-muted); font-size:0.9rem;"><strong>Dikkat:</strong> AÅŸaÄŸÄ±daki yetkiler seÃ§ildiÄŸinde, kullanÄ±cÄ±nÄ±n rÃ¼tbesi yetersiz olsa bile iÅŸlemi yapmasÄ±na izin verilir.</p>
<div class="perm-list-container">
    <div class="perm-item" onclick="togglePermCheckbox('perm_basvuru_yonet')"><input type="checkbox" id="perm_basvuru_yonet" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-clipboard-list"></i> BaÅŸvuru YÃ¶netimi</span><span class="perm-desc">BaÅŸvurularÄ± onaylayabilir/reddedebilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_ruhsat_ver')"><input type="checkbox" id="perm_ruhsat_ver" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-id-card"></i> Silah RuhsatÄ± Verme</span><span class="perm-desc">Yeni ruhsat tanÄ±mlayabilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_ceza_yaz')"><input type="checkbox" id="perm_ceza_yaz" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-gavel"></i> Ceza Yazma Yetkisi</span><span class="perm-desc">Ceza kesebilir ve sisteme iÅŸleyebilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_personel_yonet')"><input type="checkbox" id="perm_personel_yonet" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-users-cog"></i> Personel YÃ¶netimi (Ekle/DÃ¼zenle)</span><span class="perm-desc">Personel ekleyebilir ve rÃ¼tbe dÃ¼zenleyebilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_personel_sil')"><input type="checkbox" id="perm_personel_sil" class="perm-checkbox"><div class="perm-info"><span class="perm-title" style="color:var(--danger);"><i class="fas fa-user-times"></i> Personel Kovma Yetkisi</span><span class="perm-desc">Personeli sistemden kalÄ±cÄ± olarak SÄ°LEBÄ°LÄ°R.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_yetki_yonet')"><input type="checkbox" id="perm_yetki_yonet" class="perm-checkbox"><div class="perm-info"><span class="perm-title" style="color:#a855f7;"><i class="fas fa-key"></i> Yetki YÃ¶netimi (EriÅŸim)</span><span class="perm-desc">Personel listesindeki mor 'YETKÄ°' butonunu gÃ¶rebilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_kara_liste')"><input type="checkbox" id="perm_kara_liste" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-ban"></i> Kara Liste YÃ¶netimi</span><span class="perm-desc">KiÅŸileri banlayabilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_ohal')"><input type="checkbox" id="perm_ohal" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-radiation-alt"></i> OHAL Yetkisi</span><span class="perm-desc">OHAL durumunu deÄŸiÅŸtirebilir.</span></div></div>
    <div class="perm-item" onclick="togglePermCheckbox('perm_ceza_sil')"><input type="checkbox" id="perm_ceza_sil" class="perm-checkbox"><div class="perm-info"><span class="perm-title"><i class="fas fa-eraser"></i> KayÄ±t Silme</span><span class="perm-desc">Ruhsat veya sabÄ±ka silebilir.</span></div></div>
</div>
<button onclick="sesCal('click'); kisiselYetkiKaydet()" class="btn btn-green" style="width:100%; margin-top:20px; padding:15px;">YETKÄ°LERÄ° GÃœNCELLE</button></div></div></div>

<script src="config.js"></script>
<script>
    const sounds = { click: new Audio('click.mp3'), error: new Audio('error.mp3'), success: new Audio('success.mp3') };
    function sesCal(tip) { if(sounds[tip]) { sounds[tip].currentTime = 0; sounds[tip].play().catch(e => console.log("Audio error", e)); } }

    const sirenAudio = new Audio('siren.mp3'); sirenAudio.loop = true; sirenAudio.volume = 0.5;
    
    const DISCORD_APP_WEBHOOK = "https://discord.com/api/webhooks/1463704048376090779/NM94elMs7luZy6cXPvZFh4Ed2OsWQ-oU033418hdr4uwqJZ4Mcwyj4mTjIholI87UeyC";
    const DISCORD_SHIFT_WEBHOOK = "https://discord.com/api/webhooks/1464022469433229409/jw4_BOviCKI1suE7JSBgae4o2xi-sl48Io8NdnN1UopDOq3YP5SW5gT-wEa25t28yGaR";
    const DISCORD_OHAL_WEBHOOK = "https://discord.com/api/webhooks/1464414142688395336/Md9KeD670VTiNWRyFGmwuoWgudsCcaP39cm0bgYCQWUiW-0Vi7DP-5iIFc3-3SUuIeyQ";
    
    const RUTBELER = [{id:0,ad:"Polis Memuru",class:"badge-blue",defMaas:5000},{id:1,ad:"BaÅŸ Polis",class:"badge-blue",defMaas:6000},{id:2,ad:"KÄ±demli BaÅŸ Polis",class:"badge-blue",defMaas:7000},{id:3,ad:"Komiser YardÄ±mcÄ±sÄ±",class:"badge-purple",defMaas:8500},{id:4,ad:"Komiser",class:"badge-purple",defMaas:10000},{id:5,ad:"BaÅŸ Komiser",class:"badge-purple",defMaas:12000},{id:6,ad:"Emniyet Amiri",class:"badge-gold",defMaas:15000},{id:7,ad:"4. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼",class:"badge-gold",defMaas:20000},{id:8,ad:"3. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼",class:"badge-gold",defMaas:25000},{id:9,ad:"2. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼",class:"badge-gold",defMaas:30000},{id:10,ad:"1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼",class:"badge-red",defMaas:50000}];
    const MIN_RUTBE_GEREKSINIMLERI = {'perm_ceza_yaz': 3, 'perm_basvuru_yonet': 4, 'perm_ruhsat_ver': 6, 'perm_kara_liste': 6, 'perm_ceza_sil': 8, 'perm_personel_yonet': 9, 'perm_personel_sil': 10, 'perm_ohal': 10, 'perm_personel_gor': 5, 'perm_yetki_yonet': 10};
    
    let aktifKullanici = "", aktifRutbeId = 0, aktifOzelYetkiler = {}, seciliBasvuruId = "", seciliBasvuruData = null, myShiftStart = null, myShiftTimer = null, tckDb = [], yetkiDuzenlenenPersonelKey = "";
    let globalMaaslar = {};

    function showToast(msg, type = 'success') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        let icon = type === 'success' ? 'fa-check-circle' : (type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle');
        toast.innerHTML = `<div><i class="fas ${icon}" style="margin-right:10px;"></i> ${msg}</div>`;
        container.appendChild(toast);
        sesCal(type === 'error' ? 'error' : 'click');
        setTimeout(() => { toast.style.animation = 'fadeOut 0.5s forwards'; setTimeout(() => toast.remove(), 500); }, 4000);
    }

    function toggleSidebar() { document.getElementById('mainSidebar').classList.toggle('active'); }
    function yetkiVarMi(permKey) { if(aktifOzelYetkiler && aktifOzelYetkiler[permKey] === true) return true; let gerekenRutbe = MIN_RUTBE_GEREKSINIMLERI[permKey]; if(gerekenRutbe === undefined) gerekenRutbe = 10; return aktifRutbeId >= gerekenRutbe; }
    
    function girisYap() { 
        const k = document.getElementById('kadi').value.trim(); const s = document.getElementById('sifre').value.trim(); 
        if(k === "SpontaneFTT" && s === "GÃ¶kSancak1881") { basariliGiris(k, 10, {}); return; } 
        database.ref('personel').orderByChild('kadi').equalTo(k).once('value', sn => { 
            let userFound = null; sn.forEach(c => { const data = c.val(); if(data.sifre === s) userFound = data; }); 
            if(userFound) { basariliGiris(k, userFound.rutbe !== undefined ? parseInt(userFound.rutbe) : 0, userFound.ozel_yetkiler || {}); } 
            else { sesCal('error'); document.getElementById('loginMsg').innerText = "HatalÄ± GiriÅŸ!"; } 
        }); 
    }

    function basariliGiris(k, r, ozel) { 
        aktifKullanici = k; aktifRutbeId = r; aktifOzelYetkiler = ozel; 
        document.getElementById('aktifKullaniciAdi').innerText = "Sicil: " + k; 
        document.getElementById('aktifKullaniciRutbe').innerText = RUTBELER[r]?RUTBELER[r].ad:"-"; 
        document.getElementById('aktifKullaniciRutbe').className = "badge " + (RUTBELER[r]?RUTBELER[r].class:"badge-blue"); 
        document.getElementById('loginScreen').style.display = 'none'; 
        document.getElementById('adminPanel').style.display = 'flex'; 
        arayuzYetkileriniUygula(); 
        sirenAudio.load(); 
        verileriYukle(); 
        basvurulariDinle(); 
        mesaiSistemiBaslat(); 
        tckVeritabaniHazirla(); 
        maaslariGetir();
        boloDinle(); 
        loglariDinle(); 
        const rs = document.getElementById('yeniRutbe'); rs.innerHTML = ""; RUTBELER.forEach(r => { rs.innerHTML += `<option value="${r.id}">${r.ad}</option>`; }); 
        showToast(`HoÅŸgeldiniz, ${k}`);
        if(aktifRutbeId >= 10) toggleMenu('menuTckEdit', true);
        if(aktifRutbeId >= 8) toggleMenu('menuLogs', true);
        if(aktifRutbeId >= 10) { toggleMenu('btnMaasDuzenle', true); toggleMenu('btnMesaiSifirla', true); }
    }

    function arayuzYetkileriniUygula() { toggleMenu('menuDashboard', true); toggleMenu('menuBasvuru', true); toggleMenu('menuMesai', true); toggleMenu('menuRuhsat', true); toggleMenu('menuTck', true); toggleMenu('menuGbt', true); toggleMenu('menuArac', true); toggleMenu('menuPersonel', yetkiVarMi('perm_personel_gor')); document.getElementById('ohalBtn').style.display = yetkiVarMi('perm_ohal') ? 'block' : 'none'; }
    function toggleMenu(id, st) { const el = document.getElementById(id); if(st) el.classList.remove('menu-hidden'); else el.classList.add('menu-hidden'); }
    
    // --- MAAÅ YÃ–NETÄ°MÄ° ---
    function maaslariGetir() {
        database.ref('sistem/maas_config').on('value', s => {
            if(s.exists()) {
                globalMaaslar = s.val();
            } else {
                RUTBELER.forEach(r => globalMaaslar[r.id] = r.defMaas);
                database.ref('sistem/maas_config').set(globalMaaslar);
            }
        });
    }

    function maasDuzenleModalAc() {
        if(aktifRutbeId < 10) return alert("Sadece 1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼ eriÅŸebilir!");
        const div = document.getElementById('maasInputContainer'); div.innerHTML = "";
        RUTBELER.forEach(r => {
            let val = globalMaaslar[r.id] || r.defMaas;
            div.innerHTML += `
            <div style="margin-bottom:10px; background:rgba(0,0,0,0.2); padding:10px; border-radius:5px;">
                <label style="color:var(--accent); font-weight:bold;">${r.ad}</label>
                <input type="number" id="maas_inp_${r.id}" value="${val}" style="margin-top:5px;">
            </div>`;
        });
        modalAc('maasDuzenleModal');
    }

    function maaslariKaydet() {
        let yeniMaaslar = {};
        RUTBELER.forEach(r => {
            let val = parseInt(document.getElementById(`maas_inp_${r.id}`).value);
            yeniMaaslar[r.id] = val;
        });
        database.ref('sistem/maas_config').set(yeniMaaslar).then(() => {
            showToast("MaaÅŸlar gÃ¼ncellendi!");
            logEkle("MaaÅŸ tablosu gÃ¼ncellendi.");
            modalKapat();
        });
    }

    function maasModalAc() {
        if(!yetkiVarMi('perm_personel_gor')) return alert("Yetkisiz!");
        modalAc('maasModal');
        const tbody = document.getElementById('maasTabloBody'); tbody.innerHTML = "<tr><td colspan='5'>HesaplanÄ±yor...</td></tr>";
        let toplamOdenecek = 0;
        
        // Ã–NCE MESAÄ° GEÃ‡MÄ°ÅÄ°NÄ° Ã‡EK
        database.ref('shift_history').once('value', historySnapshot => {
            const history = historySnapshot.val() || {};
            
            // SONRA PERSONEL LÄ°STESÄ°NÄ° Ã‡EK VE HESAPLA
            database.ref('personel').once('value', ps => {
                tbody.innerHTML = "";
                ps.forEach(p => {
                    const pd = p.val();
                    const rId = pd.rutbe || 0;
                    const rAd = RUTBELER[rId].ad;
                    const saatlikUcret = globalMaaslar[rId] || RUTBELER[rId].defMaas;
                    
                    // KULLANICININ TOPLAM SÃœRESÄ°NÄ° HESAPLA
                    let totalMs = 0;
                    if(history[pd.kadi]) {
                        // KullanÄ±cÄ±nÄ±n tÃ¼m geÃ§miÅŸ kayÄ±tlarÄ±nÄ± topla
                        Object.values(history[pd.kadi]).forEach(record => {
                            if(record.duration) totalMs += record.duration;
                        });
                    }
                    
                    const totalHours = (totalMs / 3600000); // Milisaniyeyi saate Ã§evir
                    const displayHours = totalHours.toFixed(2); // Ekranda gÃ¶rÃ¼necek (28.4 gibi)
                    
                    const hakedis = Math.floor(totalHours * saatlikUcret);
                    
                    if(hakedis > 0) {
                        toplamOdenecek += hakedis;
                        tbody.innerHTML += `<tr><td>${pd.kadi}</td><td>${rAd}</td><td>${displayHours} Saat</td><td>${saatlikUcret} TL</td><td>${hakedis.toLocaleString()} TL</td></tr>`;
                    }
                });
                
                if(toplamOdenecek === 0) {
                     tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>HenÃ¼z tamamlanmÄ±ÅŸ mesai kaydÄ± bulunmamaktadÄ±r.</td></tr>";
                }
                
                document.getElementById('maasToplamTutar').innerText = toplamOdenecek.toLocaleString() + " TL";
            });
        });
    }

    // --- MESAÄ° SIFIRLAMA ---
    function mesaiSifirla() {
        if(aktifRutbeId < 10) return alert("Sadece 1. SÄ±nÄ±f Emniyet MÃ¼dÃ¼rÃ¼!");
        if(confirm("DÄ°KKAT: TÃ¼m personelin mesai kayÄ±tlarÄ± (GEÃ‡MÄ°Å DAHÄ°L) ve aktif durumlarÄ± SIFIRLANACAK.\n\nBu iÅŸlem maaÅŸlar daÄŸÄ±tÄ±ldÄ±ktan sonra yapÄ±lmalÄ±dÄ±r. OnaylÄ±yor musunuz?")) {
            database.ref('active_shifts').remove(); // Aktifleri sil
            database.ref('shift_history').remove(); // GeÃ§miÅŸi sil (MaaÅŸ tablosunu sÄ±fÄ±rlar)
            
            logEkle("TÃœM MESAÄ° VE MAAÅ GEÃ‡MÄ°ÅÄ° SIFIRLANDI!");
            showToast("Mesai veritabanÄ± tamamen temizlendi.", "warning");
        }
    }

    // --- BOLO SÄ°STEMÄ° ---
    function boloEklePrompt() {
        const tip = prompt("Aranan Nedir? (AraÃ§ / ÅahÄ±s / EÅŸkal)");
        const detay = prompt("Detay (Plaka, Model, Ä°sim vb.)");
        if(tip && detay) {
            database.ref('bolo').push({ tip: tip, detay: detay, ekleyen: aktifKullanici, tarih: Date.now() });
            showToast("BOLO YayÄ±nlandÄ±!", "warning");
            logEkle(`BOLO YayÄ±nlandÄ±: ${detay} (${tip})`);
        }
    }
    function boloDinle() {
        database.ref('bolo').on('value', s => {
            const c = document.getElementById('boloContainer'); c.innerHTML = "";
            s.forEach(shot => {
                const d = shot.val();
                c.innerHTML += `<div style="min-width:200px; background:rgba(239, 68, 68, 0.1); border:1px solid var(--danger); padding:10px; border-radius:5px;"><h4 style="margin:0; color:var(--danger)">${d.tip}</h4><div style="font-size:1.1rem; font-weight:bold; margin:5px 0;">${d.detay}</div><div style="font-size:0.7rem; color:#aaa;">${d.ekleyen}</div><button onclick="boloKaldir('${shot.key}')" class="btn btn-dark btn-sm" style="width:100%; margin-top:5px;">YAKALANDI</button></div>`;
            });
            if(!s.exists()) c.innerHTML = "<div style='padding:10px; color:#666;'>Aktif aranma kaydÄ± yok.</div>";
        });
    }
    function boloKaldir(key) { if(confirm("BOLO kaldÄ±rÄ±lÄ±yor?")) { database.ref('bolo/'+key).remove(); showToast("BOLO KaldÄ±rÄ±ldÄ±."); logEkle("BOLO kaldÄ±rÄ±ldÄ±."); } }

    // --- LOG SÄ°STEMÄ° ---
    function logEkle(msg) { database.ref('sistem/logs').push({memur: aktifKullanici, mesaj: msg, tarih: Date.now()}); }
    function loglariDinle() {
        database.ref('sistem/logs').limitToLast(50).on('value', s => {
            const tb = document.getElementById('logListesi'); tb.innerHTML = "";
            let arr = [];
            s.forEach(c => arr.push(c.val())); 
            arr.reverse(); 
            arr.forEach(l => {
                tb.innerHTML += `<tr class="log-row"><td>${new Date(l.tarih).toLocaleTimeString()}</td><td class="log-action">${l.memur}</td><td>${l.mesaj}</td></tr>`;
            });
        });
    }

    // --- REALISTIC TCK ---
    const REALISTIC_TCK = [{code: "TRF-01", ad: "HatalÄ± Park", p: 2500, h: 0}, {code: "TRF-02", ad: "KÄ±rmÄ±zÄ± IÅŸÄ±k Ä°hlali", p: 3500, h: 0}, {code: "TRF-03", ad: "HÄ±z SÄ±nÄ±rÄ± Ä°hlali (%10-30)", p: 4000, h: 0}, {code: "TRF-04", ad: "HÄ±z SÄ±nÄ±rÄ± Ä°hlali (%50+)", p: 10000, h: 0}, {code: "ASY-01", ad: "Kimlik Beyan Etmemek", p: 5000, h: 5}, {code: "ASY-04", ad: "Sokak KavgasÄ±", p: 8000, h: 5}, {code: "SLH-01", ad: "RuhsatsÄ±z Tabanca", p: 50000, h: 40}, {code: "NRK-01", ad: "UyuÅŸturucu KullanÄ±mÄ±", p: 15000, h: 10}, {code: "ORG-05", ad: "Banka Soygunu", p: 150000, h: 100}];

    function tckVeritabaniHazirla() { 
        database.ref('sistem/tck').on('value', s => {
            if(s.exists()) { tckDb = Array.isArray(s.val()) ? s.val() : Object.values(s.val()); } 
            else { tckDb = REALISTIC_TCK; database.ref('sistem/tck').set(REALISTIC_TCK); }
            cezaListesiniOlustur(); tckTabloGuncelle();
        });
    }

    function tckTabloGuncelle() {
        const tb = document.getElementById('tckEditListesi'); tb.innerHTML=""; 
        tckDb.forEach(i => tb.innerHTML+=`<tr><td>${i.code}</td><td>${i.ad}</td><td>${i.p.toLocaleString()} TL</td><td>${i.h} Kamu</td></tr>`);
        if(aktifRutbeId >= 10) {
            const adminTb = document.getElementById('tckAdminListesi'); adminTb.innerHTML = "";
            tckDb.forEach((i, idx) => { adminTb.innerHTML += `<tr><td>${i.code}</td><td>${i.ad}</td><td>${i.p}</td><td>${i.h}</td><td><button onclick="tckSil(${idx})" class="btn btn-red btn-sm">SÄ°L</button></td></tr>`; });
        }
    }
    function tckKaydet() {
        const kod = document.getElementById('tck_yeni_kod').value; const ad = document.getElementById('tck_yeni_ad').value; const p = parseInt(document.getElementById('tck_yeni_p').value); const h = parseInt(document.getElementById('tck_yeni_h').value);
        if(!kod || !ad) return alert("Eksik bilgi!");
        let yeniDb = [...tckDb]; yeniDb.push({code: kod, ad: ad, p: p, h: h});
        database.ref('sistem/tck').set(yeniDb).then(() => { modalKapat(); showToast("Yeni kanun eklendi!"); logEkle(`Kanun Eklendi: ${kod}`); });
    }
    function tckSil(idx) { if(confirm("Siliniyor?")) { let yeniDb = [...tckDb]; yeniDb.splice(idx, 1); database.ref('sistem/tck').set(yeniDb); logEkle("Kanun Silindi"); } }
    function tckSifirla() { if(confirm("Reset?")) database.ref('sistem/tck').set(REALISTIC_TCK); }

    function cezaListesiniOlustur() { renderCezaListesi(tckDb); }
    function renderCezaListesi(l) { document.getElementById('cezaListesiContainer').innerHTML = l.map(c => `<div class="ceza-item" onclick="sesCal('click'); cezaSec(this, ${c.p}, ${c.h})"><div><span class="ceza-code">${c.code}</span><span>${c.ad}</span></div><span class="badge badge-blue">${c.p.toLocaleString()} TL / ${c.h} Kamu</span></div>`).join(''); }
    let tp = 0; let ta = 0;
    function cezaSec(el, p, a) { if(el.classList.contains('selected')) { el.classList.remove('selected'); tp-=p; ta-=a; } else { el.classList.add('selected'); tp+=p; ta+=a; } document.getElementById('toplamTutar').innerText = `${tp.toLocaleString()} TL / ${ta} Kamu`; }
    function cezaFiltrele() { const v = document.getElementById('ceza_ara').value.toLowerCase(); renderCezaListesi(tckDb.filter(i => i.ad.toLowerCase().includes(v) || i.code.toLowerCase().includes(v))); }
    function cezaSifirla() { tp=0; ta=0; renderCezaListesi(tckDb); document.getElementById('toplamTutar').innerText="0 TL"; }
    function cezaModalAc() { cezaSifirla(); modalAc('cezaModal'); }
    function cezayiKes() { 
        if(!yetkiVarMi('perm_ceza_yaz')) { sesCal('error'); return alert("Yetkisiz!"); }
        const s = document.getElementById('ceza_sahis').value; const k = document.getElementById('ceza_kanit').value; 
        if(!s || tp===0) { sesCal('error'); return alert("Eksik!"); } 
        database.ref('gbt').push({ isim: s, tarih: new Date().toISOString(), suc: `TOPLAM: ${tp.toLocaleString()} TL, ${ta} Kamu`, kanit: k, memur: aktifKullanici }); 
        sesCal('success'); showToast("Ceza iÅŸlendi.", "success"); logEkle(`${s} ÅŸahsÄ±na ceza kesildi.`); modalKapat(); 
    }

    function verileriYukle() { 
        database.ref('personel').on('value', s => { 
            const tb = document.getElementById('personelListesi'); tb.innerHTML = ""; 
            s.forEach(c => { 
                const p = c.val(); let rId = p.rutbe !== undefined ? parseInt(p.rutbe) : 0; 
                let btnDuzenle = yetkiVarMi('perm_personel_yonet') ? `<button onclick="rutbeGuncellePrompt('${c.key}', ${rId})" class="btn btn-yellow btn-sm" style="margin-right:5px;">DÃœZ</button>` : ""; 
                let btnSil = yetkiVarMi('perm_personel_sil') ? `<button onclick="personelSil('${c.key}')" class="btn btn-red btn-sm">SÄ°L</button>` : ""; 
                let btnOzel = yetkiVarMi('perm_yetki_yonet') ? `<button onclick="yetkiModalAc('${c.key}', '${p.kadi}')" class="btn btn-purple btn-sm" style="margin-right:5px;">YETKÄ°</button>` : ""; 
                tb.innerHTML += `<tr><td>${p.kadi}</td><td><span class="badge ${RUTBELER[rId]?RUTBELER[rId].class:"badge-blue"}">${RUTBELER[rId]?RUTBELER[rId].ad:"-"}</span></td><td>****</td><td style="display:flex; justify-content:center;">${btnOzel}${btnDuzenle}${btnSil}</td></tr>`; 
            }); 
        }); 
        database.ref('blacklist').on('value', s => { const d = document.getElementById('blacklistContainer'); d.innerHTML = ""; s.forEach(c => { let btnSil = yetkiVarMi('perm_kara_liste') ? `<button onclick="karaListeSil('${c.key}')" class="btn btn-red btn-sm">X</button>` : ''; d.innerHTML += `<div style="margin-bottom:5px; border-bottom:1px solid #333;">${c.val().discord_id} (${c.val().sebep}) ${btnSil}</div>`; }); }); ruhsatlariDinle(); database.ref('gbt').on('value', s => { if(s.exists()) document.getElementById('statAranan').innerText = Object.keys(s.val()).length; }); 
    }
    
    function yetkiModalAc(key, name) { yetkiDuzenlenenPersonelKey = key; document.getElementById('yetkiModalUserTitle').innerText = "KullanÄ±cÄ±: " + name; document.querySelectorAll('.perm-checkbox').forEach(cb => cb.checked = false); database.ref('personel/' + key + '/ozel_yetkiler').once('value', s => { if(s.exists()) { const yetkiler = s.val(); for (const [permKey, val] of Object.entries(yetkiler)) { const cb = document.getElementById(permKey); if(cb) cb.checked = val; } } modalAc('kisiselYetkiModal'); }); }
    function togglePermCheckbox(id) { const el = document.getElementById(id); el.checked = !el.checked; } document.querySelectorAll('.perm-checkbox').forEach(el => { el.onclick = function(e) { e.stopPropagation(); } });
    function kisiselYetkiKaydet() { if(!yetkiDuzenlenenPersonelKey) return; const yeniYetkiler = { perm_basvuru_yonet: document.getElementById('perm_basvuru_yonet').checked, perm_ruhsat_ver: document.getElementById('perm_ruhsat_ver').checked, perm_ceza_yaz: document.getElementById('perm_ceza_yaz').checked, perm_personel_yonet: document.getElementById('perm_personel_yonet').checked, perm_personel_sil: document.getElementById('perm_personel_sil').checked, perm_yetki_yonet: document.getElementById('perm_yetki_yonet').checked, perm_kara_liste: document.getElementById('perm_kara_liste').checked, perm_ohal: document.getElementById('perm_ohal').checked, perm_ceza_sil: document.getElementById('perm_ceza_sil').checked }; database.ref('personel/' + yetkiDuzenlenenPersonelKey).update({ ozel_yetkiler: yeniYetkiler }).then(() => { showToast("Yetkiler gÃ¼ncellendi!"); modalKapat(); logEkle("Ã–zel yetki dÃ¼zenlendi"); }); }
    function personelEkle() { if(!yetkiVarMi('perm_personel_yonet')) return alert("Yetersiz!"); const k = document.getElementById('yeniKadi').value; const s = document.getElementById('yeniSifre').value; const r = document.getElementById('yeniRutbe').value; if(!k || !s) return alert("Eksik!"); database.ref('personel').push({ kadi: k, sifre: s, rutbe: parseInt(r) }); showToast("Eklendi!"); logEkle(`Personel eklendi: ${k}`); document.getElementById('yeniKadi').value=""; document.getElementById('yeniSifre').value=""; }
    function personelSil(key) { if(!yetkiVarMi('perm_personel_sil')) return alert("YETKÄ°SÄ°Z!"); if(confirm("Kov?")) { database.ref('personel/'+key).remove(); logEkle("Personel silindi."); } }
    function rutbeGuncellePrompt(key, r) { if(!yetkiVarMi('perm_personel_yonet')) return alert("Yetkisiz!"); let n = prompt("Yeni RÃ¼tbe ID (0-10):", r); if(n) { let h = parseInt(n); if(h > 10 || h < 0) return alert("GeÃ§ersiz!"); if (h > aktifRutbeId) return alert("HATA: Kendi rÃ¼tbenizden yÃ¼ksek atayamazsÄ±nÄ±z!"); database.ref('personel/'+key).update({rutbe: h}); logEkle("RÃ¼tbe deÄŸiÅŸtirildi."); } }
    function basvuruSil(key) { if(!yetkiVarMi('perm_basvuru_yonet')) return alert("Yetkisiz!"); if(confirm("Sil?")) database.ref('basvurular/'+key).remove(); }
    function basvuruIncele(key) { seciliBasvuruId = key; database.ref('basvurular/'+key).once('value', s => { const d = s.val(); seciliBasvuruData = d; let h = `<div class="grid-2"><div>ID: ${d.discord_id}</div><div>Ä°sim: ${d.ic_isim}</div></div><hr><h4>Cevaplar:</h4>`; for(let k in d.cevaplar) if(!['discord_id','ic_isim','ooc_yas'].includes(k)) h += `<p style="color:#aaa;margin:2px;">${d.soru_detaylari?d.soru_detaylari[k]:k}</p><div style="background:rgba(0,0,0,0.2);padding:10px;margin-bottom:10px;">${d.cevaplar[k]}</div>`; document.getElementById('basvuruDetayIcerik').innerHTML = h; let btns = ""; if(yetkiVarMi('perm_basvuru_yonet')) { btns += `<button onclick="durumGuncelle('OnaylandÄ±')" class="btn btn-green">ONAYLA</button><button onclick="durumGuncelle('Reddedildi')" class="btn btn-red">REDDET</button>`; } if(yetkiVarMi('perm_kara_liste')) btns += `<button onclick="karaListeyeEkle('${d.discord_id}')" class="btn btn-dark">BANLA</button>`; document.getElementById('basvuruIslemButtonlari').innerHTML = btns; modalAc('basvuruModal'); }); }
    function durumGuncelle(d) { if(!yetkiVarMi('perm_basvuru_yonet')) return alert("Yetkisiz!"); database.ref('basvurular/'+seciliBasvuruId).update({durum:d}); sendDiscordWebhook(seciliBasvuruData, d); modalKapat(); showToast(`BaÅŸvuru ${d}`); logEkle(`BaÅŸvuru ${d}: ${seciliBasvuruData.ic_isim}`); }
    function ruhsatKaydet() { if(!yetkiVarMi('perm_ruhsat_ver')) return alert("Yetkisiz!"); const s=document.getElementById('ruh_sahip').value; const t=document.getElementById('ruh_tip').value; const g=document.getElementById('ruh_tarih').value; if(!s||!g) return alert("BoÅŸ!"); database.ref('ruhsatlar').push({sahip:s, tip:t, gecerlilik:g, veren:aktifKullanici}); showToast("Ruhsat Verildi!"); modalKapat(); logEkle(`Ruhsat verildi: ${s}`); }
    function dbSil(p) { if(!yetkiVarMi('perm_ceza_sil')) return alert("Yetkisiz!"); if(confirm("Sil?")) database.ref(p).remove(); }
    
    // YENÄ° WEBHOOK SÄ°STEMÄ° Ä°LE OHAL FONKSÄ°YONU
    function sendOhalWebhook(aktif) {
        const embed = aktif ? {
            title: "âš ï¸ DÄ°KKAT: OLAÄANÃœSTÃœ HAL (OHAL) Ä°LAN EDÄ°LDÄ°!",
            description: "**ÅEHÄ°RDEKÄ° TÃœM VATANDAÅLARIN DÄ°KKATÄ°NE!**\n\nÅehirde artan gÃ¼venlik tehditleri nedeniyle Emniyet MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ tarafÄ±ndan **OHAL** ilan edilmiÅŸtir.\n\nâ›” **SokaÄŸa Ã‡Ä±kma YasaÄŸÄ±:** AKTÄ°F\nğŸ”« **GÃ¼venlik ProtokolÃ¼:** GÃ–RÃœLDÃœÄÃœ YERDE VUR EMRÄ°\n\nLÃ¼tfen can gÃ¼venliÄŸiniz iÃ§in derhal evlerinize dÃ¶nÃ¼nÃ¼z ve pencerelerden uzak durunuz.",
            color: 15548997, 
            footer: { text: "Emniyet Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ - Komuta Kontrol Merkezi" },
            timestamp: new Date().toISOString(),
            thumbnail: { url: "https://cdn-icons-png.flaticon.com/512/10336/10336343.png" }
        } : {
            title: "ğŸŸ¢ OHAL DURUMU SONA ERDÄ°",
            description: "Tehdit unsurlarÄ± etkisiz hale getirilmiÅŸ ve ÅŸehir gÃ¼venliÄŸi yeniden saÄŸlanmÄ±ÅŸtÄ±r.\n\nSokaÄŸa Ã§Ä±kma yasaklarÄ± kaldÄ±rÄ±lmÄ±ÅŸtÄ±r. Ä°ÅŸbirliÄŸiniz iÃ§in teÅŸekkÃ¼r ederiz.",
            color: 5763719,
            footer: { text: "Emniyet Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼" },
            timestamp: new Date().toISOString()
        };

        const payload = {
            username: "POLNET Duyuru Sistemi",
            avatar_url: "https://cdn-icons-png.flaticon.com/512/9203/9203764.png",
            content: aktif ? "@everyone ğŸš¨ **ACÄ°L DURUM BÄ°LDÄ°RÄ°SÄ°**" : "âœ… **GÃœVENLÄ°K GÃœNCELLEMESÄ°**",
            embeds: [embed]
        };

        fetch(DISCORD_OHAL_WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        }).catch(err => console.error("Webhook hatasÄ±:", err));
    }

    function ohalDegistir() { 
        if(!yetkiVarMi('perm_ohal')) return alert("Yetkisiz!"); 
        database.ref('sistem/ohal').once('value', s => { 
            const yeniDurum = !s.val();
            database.ref('sistem/ohal').set(yeniDurum); 
            logEkle(yeniDurum ? "OHAL BAÅLATILDI" : "OHAL BÄ°TÄ°RÄ°LDÄ°");
            sendOhalWebhook(yeniDurum);
        }); 
    }

    function basvurulariDinle() { database.ref('basvurular').on('value', s => { const tb = document.getElementById('basvuruListesi'); let bekleyen=0; let arr=[]; s.forEach(c => arr.push({k:c.key, v:c.val()})); arr.sort((a,b)=>(a.v.durum==='Beklemede'&&b.v.durum!=='Beklemede')?-1:1); let html=""; arr.forEach(i=>{ const d=i.v; if(d.durum==='Beklemede') bekleyen++; let b=d.durum==='OnaylandÄ±'?'badge-green':(d.durum==='Reddedildi'?'badge-red':'badge-warn'); let silBtn = yetkiVarMi('perm_basvuru_yonet') ? `<button onclick="basvuruSil('${i.k}')" class="btn btn-red" style="margin-left:5px;"><i class="fas fa-trash"></i></button>` : ''; html+=`<tr><td>${d.tarih?new Date(d.tarih).toLocaleDateString():'-'}</td><td>${d.discord_id}</td><td>${d.ic_isim}</td><td><span class="badge ${b}">${d.durum}</span></td><td><button onclick="sesCal('click'); basvuruIncele('${i.k}')" class="btn btn-blue">Ä°NCELE</button>${silBtn}</td></tr>`; }); tb.innerHTML=html; document.getElementById('statBasvuru').innerText=bekleyen; document.getElementById('basvuruBadge').innerText=bekleyen; document.getElementById('basvuruBadge').style.display=bekleyen>0?'inline':'none'; }); }
    
    // DISCORD WEBHOOK FONKSÄ°YONLARI (BAÅVURU + MESAÄ°)
    function sendDiscordWebhook(data, status) { 
        let c = status === "Reddedildi" ? 15158332 : 3066993; 
        let t = status === "Reddedildi" ? "ğŸš« BAÅVURU REDDEDÄ°LDÄ°" : "ğŸ‘®â€â™‚ï¸ BAÅVURU KABUL EDÄ°LDÄ°"; 
        fetch(DISCORD_APP_WEBHOOK, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ content: `<@${data.discord_id}>`, embeds: [{ title: t, description: `Ä°ÅŸlem: **${status}**`, color: c, fields: [{ name: "IC Ä°sim", value: data.ic_isim, inline: true }, { name: "Yetkili", value: aktifKullanici, inline: true }] }] }) }); 
    }

    function sendShiftWebhook(user, type, duration = "") {
        const color = type === "GiriÅŸ" ? 3066993 : 15158332; // YeÅŸil / KÄ±rmÄ±zÄ±
        const message = type === "GiriÅŸ" 
            ? `ğŸŸ¢ **MESAÄ° BAÅLADI**\nPersonel: ${user}` 
            : `ğŸ”´ **MESAÄ° BÄ°TTÄ°**\nPersonel: ${user}\nÃ‡alÄ±ÅŸÄ±lan SÃ¼re: ${duration}`;

        fetch(DISCORD_SHIFT_WEBHOOK, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                embeds: [{
                    description: message,
                    color: color,
                    footer: { text: "POLNET Shift System" },
                    timestamp: new Date()
                }]
            })
        });
    }

    function ruhsatlariDinle() { database.ref('ruhsatlar').on('value', s => { const tb = document.getElementById('ruhsatListesi'); tb.innerHTML = ""; s.forEach(c => { const d = c.val(); let btn = yetkiVarMi('perm_ceza_sil') ? `<button onclick="dbSil('ruhsatlar/${c.key}')" class="btn btn-red btn-sm">Ä°PTAL</button>` : ''; tb.innerHTML += `<tr><td>${d.sahip}</td><td><span class="badge badge-blue">${d.tip}</span></td><td>${d.gecerlilik}</td><td>${d.veren}</td><td>${btn}</td></tr>`; }); }); }
    function mesaiSistemiBaslat() { database.ref('active_shifts').on('value', s => { const tbody = document.getElementById('aktifMesaiBody'); tbody.innerHTML = ""; s.forEach(c => { const d = c.val(); if(d.user === aktifKullanici && !myShiftTimer) { myShiftStart = d.start; startLocalTimer(); document.getElementById('kisiselMesaiKart').classList.add('mesai-active'); document.getElementById('btnMesai').innerText="MESAÄ° BÄ°TÄ°R"; document.getElementById('btnMesai').className="btn btn-red"; document.getElementById('mesaiDurumText').innerText="MESAÄ°DE"; document.getElementById('mesaiDurumText').style.color="var(--success)"; } tbody.innerHTML += `<tr><td>${d.user}</td><td>${d.rutbeAd}</td><td>${new Date(d.start).toLocaleTimeString()}</td><td>${Math.floor((Date.now()-d.start)/60000)} Dk</td></tr>`; }); }); }
    
    function mesaiToggle() { 
        if(!myShiftStart) { 
            // 1. MESAÄ°YE GÄ°RÄ°Å
            database.ref('active_shifts/'+aktifKullanici).set({user:aktifKullanici, rutbeAd:RUTBELER[aktifRutbeId]?RUTBELER[aktifRutbeId].ad:"-", start:Date.now()}); 
            logEkle("Mesaiye baÅŸladÄ±."); 
            sendShiftWebhook(aktifKullanici, "GiriÅŸ");
        } else { 
            // 2. MESAÄ° Ã‡IKIÅ (SÃœREYÄ° KAYDET)
            const bitisZamani = Date.now();
            const sureMs = bitisZamani - myShiftStart; // Milisaniye cinsinden sÃ¼re
            
            // GeÃ§miÅŸe kaydet (MaaÅŸ hesaplamasÄ± iÃ§in)
            database.ref('shift_history/' + aktifKullanici).push({
                start: myShiftStart,
                end: bitisZamani,
                duration: sureMs
            });

            // SÃ¼re GÃ¶sterimi (Webhook iÃ§in)
            let h = Math.floor(sureMs/3600000); 
            let m = Math.floor((sureMs%3600000)/60000);
            let sureStr = `${h} Saat ${m} Dakika`;

            // Aktif mesaiyi sil
            database.ref('active_shifts/'+aktifKullanici).remove(); 
            
            myShiftStart=null; 
            clearInterval(myShiftTimer); 
            myShiftTimer=null; 
            
            // UI GÃ¼ncelleme
            document.getElementById('kisiselMesaiKart').classList.remove('mesai-active'); 
            document.getElementById('btnMesai').innerText="MESAÄ°YE BAÅLA"; 
            document.getElementById('btnMesai').className="btn btn-green"; 
            document.getElementById('mesaiDurumText').innerText="MESAÄ° DIÅI"; 
            document.getElementById('mesaiDurumText').style.color="var(--text-muted)"; 
            document.getElementById('mesaiSayac').innerText="00:00:00"; 
            
            logEkle("Mesaiyi bitirdi."); 
            sendShiftWebhook(aktifKullanici, "Ã‡Ä±kÄ±ÅŸ", sureStr);
        } 
    }
    
    function startLocalTimer() { if(myShiftTimer) clearInterval(myShiftTimer); myShiftTimer = setInterval(() => { if(!myShiftStart) return; let d = Date.now() - myShiftStart; let h = Math.floor(d/3600000); let m = Math.floor((d%3600000)/60000); let s = Math.floor((d%60000)/1000); document.getElementById('mesaiSayac').innerText = (h<10?'0':'')+h+":"+(m<10?'0':'')+m+":"+(s<10?'0':'')+s; }, 1000); }
    function gbtSorgula() { const n = document.getElementById('gbtInput').value; database.ref('gbt').orderByChild('isim').equalTo(n).once('value', s => { 
        let html = "";
        if(s.exists()) {
            sesCal('error');
            html = `<h3 style="color:red">SABIKALI (KayÄ±t SayÄ±sÄ±: ${Object.keys(s.val()).length})</h3>`;
            s.forEach(c => {
                const r = c.val();
                let kanitBtn = r.kanit ? `<a href="${r.kanit}" target="_blank" class="btn btn-sm btn-blue" style="margin-left:5px;">KANIT FOTO</a>` : '';
                html += `<div class="card" style="border-left:4px solid red; font-size:0.9rem;"><strong>Tarih:</strong> ${new Date(r.tarih).toLocaleDateString()}<br><strong>SuÃ§:</strong> ${r.suc}<br><strong>Memur:</strong> ${r.memur} ${kanitBtn}</div>`;
            });
        } else {
            sesCal('success');
            html = `<div class="card" style="border-left:4px solid green"><h3>TEMÄ°Z</h3></div>`;
        }
        document.getElementById('gbtSonuc').innerHTML = html;
        logEkle(`GBT Sorgusu: ${n}`);
    }); }
    function plakaSorgula() { const p = document.getElementById('plakaInput').value; let isStolen = p==="34 TR 34"; document.getElementById('aracSonuc').innerHTML = isStolen ? `<div class="card" style="border-left:5px solid red;text-align:center"><h1>Ã‡ALINTI</h1></div>` : `<div class="card" style="border-left:5px solid green;text-align:center"><h1>TEMÄ°Z</h1></div>`; if(isStolen) sesCal('error'); else sesCal('success'); logEkle(`Plaka Sorgusu: ${p}`); }
    function modalKapat() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
    function modalAc(id){ document.getElementById(id).style.display='flex'; }
    function tabDegistir(id, el) { if(id === 'personelTab' && !yetkiVarMi('perm_personel_gor')) return alert("Yetkisiz!"); if(id === 'logTab' && aktifRutbeId < 8) return alert("Sadece Ã¼st yÃ¶netim!"); if(window.innerWidth <= 768) document.getElementById('mainSidebar').classList.remove('active'); document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(id).classList.add('active'); el.classList.add('active-tab'); }
    function tabloAra(i,t){ let v=document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?'':'none'); }
    function karaListeyeEkle(id=null) { if(!yetkiVarMi('perm_kara_liste')) return alert("Yetkisiz!"); const d=id||document.getElementById('bl_id').value; database.ref('blacklist').push({discord_id:d, sebep:"Ban", tarih:Date.now()}); if(id) durumGuncelle('Reddedildi'); else showToast("Kara listeye eklendi!"); logEkle(`BanlandÄ±: ${d}`); }
    function karaListeSil(key) { if(!yetkiVarMi('perm_kara_liste')) return alert("Yetkisiz!"); if(confirm("KaldÄ±r?")) database.ref('blacklist/'+key).remove(); }
    database.ref('sistem/ohal').on('value', s => { if(s.val()) { document.body.classList.add('ohal-active'); document.getElementById('ohalAlertBar').style.display='block'; document.getElementById('ohalBtn').innerText="âš ï¸ OHAL BÄ°TÄ°R"; sirenAudio.play().catch(e=>console.log(e)); } else { document.body.classList.remove('ohal-active'); document.getElementById('ohalAlertBar').style.display='none'; document.getElementById('ohalBtn').innerText="ğŸš¨ OHAL BAÅLAT"; sirenAudio.pause(); sirenAudio.currentTime=0; } });
</script>
<script>(function(){const _0x9f2a={t:"\x53\x70\x6f\x6e\x74\x61\x6e\x65\x46\x54\x54\x20\x57\x65\x62\x20\x43\x6f\x64\x69\x6e\x67\x20\x54\x61\x72\x61\x66\u0131\x6e\x64\x69\x6e\x20\u00dc\x72\x65\x74\x69\x6c\x6d\x69\u015f\x74\x69\x72\x20\x26\x20\x4c\x69\x73\x61\x6e\x73\x6c\x61\x6e\x6d\u0131\u015f\x74\x69\x72\x20\u00a9\x20\x32\x30\x32\x36",c:"#3b82f6",id:"ftt_license_layer_x86"};function _renderFtt(){if(document.getElementById(_0x9f2a.id))return;const d=document.createElement('div');d.id=_0x9f2a.id;d.style.cssText=`position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-family:'Chakra Petch',sans-serif;font-size:12px;color:${_0x9f2a.c};background:rgba(2,6,23,0.9);padding:8px 25px;border-radius:20px;border:1px solid rgba(59,130,246,0.3);backdrop-filter:blur(5px);z-index:999999;pointer-events:none;user-select:none;text-transform:uppercase;font-weight:700;letter-spacing:1px;box-shadow:0 0 20px rgba(59,130,246,0.2);transition:all 0.5s;white-space:nowrap;`;d.innerHTML=`<i class="fas fa-code"></i> `+_0x9f2a.t;const s=document.createElement("style");s.innerHTML=`@keyframes fttPulse{0%{opacity:0.7;text-shadow:0 0 5px ${_0x9f2a.c}}50%{opacity:1;text-shadow:0 0 15px ${_0x9f2a.c},0 0 5px white}100%{opacity:0.7;text-shadow:0 0 5px ${_0x9f2a.c}}} #${_0x9f2a.id}{animation:fttPulse 4s infinite}`;document.head.appendChild(s);document.body.appendChild(d)}function _guardFtt(){const obs=new MutationObserver((m)=>{const el=document.getElementById(_0x9f2a.id);if(!el||el.style.display==="none"||el.style.opacity==="0"||el.style.visibility==="hidden"){obs.disconnect();document.body.innerHTML="";document.body.style.background="#000";document.body.style.display="flex";document.body.style.justifyContent="center";document.body.style.alignItems="center";document.body.style.height="100vh";const w=document.createElement("h1");w.style.color="red";w.style.fontFamily="monospace";w.innerText="SECURITY ALERT: LICENSE TAMPERING DETECTED";document.body.appendChild(w)}});obs.observe(document.body,{childList:true,subtree:true,attributes:true});setInterval(()=>{if(!document.getElementById(_0x9f2a.id))_renderFtt()},2500)}window.addEventListener('load', ()=>{_renderFtt();_guardFtt()})})();</script>
</body>
</html>
