<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Personel YÃ¶netim</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background: #162447; color: white; display: flex; flex-direction: column; padding: 20px; }
        .content { flex: 1; padding: 40px; overflow-y: auto; background: #eef2f5; }
        
        /* Tablo Stilleri */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #1f4068; color: white; }
        
        /* Butonlar */
        .btn { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; color: white; margin-right: 5px; font-weight: bold; transition: 0.2s; }
        .btn:hover { opacity: 0.8; }
        .btn-green { background: #28a745; } 
        .btn-red { background: #dc3545; } 
        .btn-blue { background: #007bff; }
        .btn-dark { background: #343a40; } /* Silme butonu iÃ§in */
        
        /* Login EkranÄ± */
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #162447; z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 10px; width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        
        /* Sidebar MenÃ¼ */
        .tab-content { display: none; } .tab-content.active { display: block; }
        .menu-item { padding: 15px; cursor: pointer; color: #ccc; border-radius: 5px; margin-bottom: 5px; } 
        .menu-item:hover, .active-tab { color: white; background: rgba(255,255,255,0.1); }

        /* --- DETAY PENCERESÄ° (MODAL) STÄ°LLERÄ° --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 0; border: 1px solid #888; width: 60%; max-width: 800px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideDown 0.3s; }
        .modal-header { padding: 20px; background-color: #162447; color: white; border-top-left-radius: 10px; border-top-right-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; max-height: 60vh; overflow-y: auto; line-height: 1.6; color: #333; }
        .modal-footer { padding: 15px; background-color: #eee; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; text-align: right; }
        .close-btn { color: white; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-btn:hover { color: #ffd700; }
        .soru-cevap-item { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .soru-baslik { font-weight: bold; color: #162447; display: block; margin-bottom: 5px; }

        @keyframes slideDown { from {top: -50px; opacity: 0;} to {top: 0; opacity: 1;} }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <h2 style="color:#162447; margin-bottom:5px;">YÃ–NETÄ°M PANELÄ°</h2>
        <p style="color:#777; font-size:0.9rem; margin-bottom:20px;">Personel Daire BaÅŸkanlÄ±ÄŸÄ±</p>
        
        <input type="text" id="kadi" class="login-input" placeholder="KullanÄ±cÄ± AdÄ±">
        <input type="password" id="sifre" class="login-input" placeholder="Åifre">
        
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; padding:12px; font-size:1.1rem; margin-top:10px; background:#162447;">GiriÅŸ Yap</button>
        <p id="loginMsg" style="color:#dc3545; margin-top:15px; font-weight:bold; font-size:0.9rem;"></p>
    </div>
</div>

<div id="detayModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 style="margin:0;">BaÅŸvuru DetaylarÄ±</h2>
            <span class="close-btn" onclick="modalKapat()">&times;</span>
        </div>
        <div class="modal-body" id="modalIcerik">
            </div>
        <div class="modal-footer">
            <button onclick="modalKapat()" class="btn btn-red">Kapat</button>
        </div>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <h2 style="color:#ffd700; text-align:center;">MÃœDÃœRLÃœK</h2>
        <div class="menu-item active-tab" onclick="tabDegistir('basvurularTab', this)">ğŸ“„ BaÅŸvurular</div>
        <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)">ğŸ‘®â€â™‚ï¸ Personel Listesi</div>
        <div class="menu-item" onclick="location.reload()" style="margin-top:auto; color:#e43f5a;">ğŸšª Ã‡Ä±kÄ±ÅŸ</div>
    </div>

    <div class="content">
        <div id="basvurularTab" class="tab-content active">
            <h2 style="color:#162447;">Gelen BaÅŸvurular</h2>
            <table>
                <thead>
                    <tr>
                        <th>Discord ID</th>
                        <th>IC Ä°sim</th>
                        <th>YaÅŸ</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody id="basvuruListesi"></tbody>
            </table>
        </div>

        <div id="yoneticilerTab" class="tab-content">
            <h2 style="color:#162447;">Personel & YÃ¶netici Listesi</h2>
            <div style="background:white; padding:20px; border-radius:8px; display:flex; gap:10px; align-items:center;">
                <b style="color:#162447;">+ Yeni Personel:</b>
                <input type="text" id="yeniKadi" placeholder="KullanÄ±cÄ± AdÄ±" style="padding:8px; border:1px solid #ccc; border-radius:4px;">
                <input type="password" id="yeniSifre" placeholder="Åifre" style="padding:8px; border:1px solid #ccc; border-radius:4px;">
                <button onclick="yetkiliEkle()" class="btn btn-green" style="padding:8px 15px;">Ekle</button>
            </div>
            <table>
                <thead><tr><th>KullanÄ±cÄ±</th><th>Åifre</th><th>Ä°ÅŸlem</th></tr></thead>
                <tbody id="yoneticiListesi"></tbody>
            </table>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    // Global veri tutucu (Modal aÃ§arken kullanacaÄŸÄ±z)
    let basvuruVerileri = {};

    function girisYap() {
        const kadi = document.getElementById('kadi').value.trim();
        const sifre = document.getElementById('sifre').value.trim();

        if (kadi === "MÃ¼dÃ¼r" && sifre === "GÃ¶kSancak1881") {
            panelAc();
            database.ref('yetkililer').orderByChild('kadi').equalTo('MÃ¼dÃ¼r').once('value', s => {
                if(!s.exists()) database.ref('yetkililer').push({kadi: 'MÃ¼dÃ¼r', sifre: 'GÃ¶kSancak1881'});
            });
            return;
        }

        database.ref('yetkililer').orderByChild('kadi').equalTo(kadi).once('value', snapshot => {
            let girisBasarili = false;
            snapshot.forEach(child => { 
                if(child.val().sifre === sifre) girisBasarili = true; 
            });
            
            if (girisBasarili) panelAc();
            else document.getElementById('loginMsg').innerText = "HatalÄ± KullanÄ±cÄ± AdÄ± veya Åifre!";
        });
    }

    function panelAc() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'flex';
        verileriGetir();
        yoneticileriGetir();
    }

    function verileriGetir() {
        database.ref('basvurular').on('value', snapshot => {
            const liste = document.getElementById('basvuruListesi');
            liste.innerHTML = "";
            basvuruVerileri = {}; // Verileri sÄ±fÄ±rla

            if(!snapshot.exists()) {
                liste.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>HenÃ¼z baÅŸvuru yok.</td></tr>";
                return;
            }

            snapshot.forEach(child => {
                const data = child.val();
                const key = child.key;
                
                // Veriyi global deÄŸiÅŸkene kaydet (Modal iÃ§in)
                basvuruVerileri[key] = data;

                let renk = data.durum === 'OnaylandÄ±' ? 'green' : (data.durum === 'Reddedildi' ? 'red' : 'orange');
                let durumYazi = data.durum === 'Beklemede' ? 'DEÄERLENDÄ°RÄ°LÄ°YOR' : data.durum;

                liste.innerHTML += `
                <tr>
                    <td>${data.discord_id}</td>
                    <td>${data.ic_isim}</td>
                    <td>${data.ooc_yas}</td>
                    <td style="color:${renk}; font-weight:bold;">${durumYazi}</td>
                    <td>
                        <button onclick="detayAc('${key}')" class="btn btn-blue">Ä°ncele</button>
                        <button onclick="dbGuncelle('basvurular/${key}', {durum:'OnaylandÄ±'})" class="btn btn-green">âœ“</button>
                        <button onclick="dbGuncelle('basvurular/${key}', {durum:'Reddedildi'})" class="btn btn-red">âœ—</button>
                        <button onclick="basvuruSil('${key}')" class="btn btn-dark" title="BaÅŸvuruyu Sil">ğŸ—‘ï¸</button>
                    </td>
                </tr>`;
            });
        });
    }

    // --- YENÄ° EKLENEN FONKSÄ°YONLAR ---

    // 1. Detay ModalÄ±nÄ± AÃ§ma (Hata vermeyen yÃ¶ntem)
    function detayAc(key) {
        const data = basvuruVerileri[key];
        const modalBody = document.getElementById('modalIcerik');
        
        let htmlIcerik = `<h3 style="border-bottom:2px solid #ddd; padding-bottom:10px;">${data.ic_isim} (YaÅŸ: ${data.ooc_yas})</h3>`;
        htmlIcerik += `<p><strong>Discord ID:</strong> ${data.discord_id}</p>`;
        htmlIcerik += `<p><strong>Durum:</strong> ${data.durum}</p><br>`;
        
        if(data.cevaplar) {
            for(const [soruID, cevap] of Object.entries(data.cevaplar)) {
                // Soru ID'sini okunaklÄ± yap (opsiyonel) veya direkt gÃ¶ster
                htmlIcerik += `
                <div class="soru-cevap-item">
                    <span class="soru-baslik">Soru (${soruID}):</span>
                    <span>${cevap}</span>
                </div>`;
            }
        } else {
            htmlIcerik += "<p>Cevap bulunamadÄ±.</p>";
        }

        modalBody.innerHTML = htmlIcerik;
        document.getElementById('detayModal').style.display = "block";
    }

    // 2. ModalÄ± Kapatma
    function modalKapat() {
        document.getElementById('detayModal').style.display = "none";
    }

    // 3. Silme Ä°ÅŸlemi
    function basvuruSil(key) {
        if(confirm("Bu baÅŸvuruyu kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz?")) {
            database.ref('basvurular/' + key).remove()
            .then(() => { alert("BaÅŸvuru silindi."); })
            .catch((error) => { alert("Hata: " + error.message); });
        }
    }

    // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapatma
    window.onclick = function(event) {
        const modal = document.getElementById('detayModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    // --- DÄ°ÄER STANDART FONKSÄ°YONLAR ---

    function yoneticileriGetir() {
        database.ref('yetkililer').on('value', snapshot => {
            const liste = document.getElementById('yoneticiListesi');
            liste.innerHTML = "";
            snapshot.forEach(child => {
                const d = child.val();
                let silBtn = d.kadi === 'MÃ¼dÃ¼r' ? 'ğŸ”’' : `<button onclick="dbSil('yetkililer/${child.key}')" class="btn btn-red">Sil</button>`;
                liste.innerHTML += `<tr><td>${d.kadi}</td><td>â€¢â€¢â€¢â€¢â€¢â€¢</td><td>${silBtn}</td></tr>`;
            });
        });
    }

    function yetkiliEkle() {
        const k = document.getElementById('yeniKadi').value.trim();
        const s = document.getElementById('yeniSifre').value.trim();
        if(k && s) { 
            database.ref('yetkililer').push({kadi: k, sifre: s});
            alert("Personel eklendi!");
            document.getElementById('yeniKadi').value = "";
            document.getElementById('yeniSifre').value = "";
        }
    }

    function dbGuncelle(yol, veri) { database.ref(yol).update(veri); }
    function dbSil(yol) { if(confirm('Bu personeli silmek istediÄŸinize emin misiniz?')) database.ref(yol).remove(); }
    
    function tabDegistir(id, el) {
        document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active-tab');
    }
</script>
</body>
</html>
