<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Operasyon Merkezi v10.1</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://meet.jit.si/external_api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root { --bg-color: #0f172a; --text-color: #e2e8f0; --sidebar-bg: #020617; --sidebar-text: #94a3b8; --card-bg: #1e293b; --table-header: #334155; --accent: #3b82f6; --alert-color: #ef4444; }
        
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; height: 100vh; overflow: hidden; transition: 0.3s; flex-direction: column; }
        
        /* BOLO */
        .bolo-ticker { background: #ef4444; color: white; padding: 5px; font-weight: bold; white-space: nowrap; overflow: hidden; position: relative; z-index: 10; font-size: 0.9rem; display: flex; align-items: center; }
        .bolo-content { display: inline-block; padding-left: 100%; animation: ticker 25s linear infinite; }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }
        
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 260px; background: var(--sidebar-bg); color: var(--sidebar-text); display: flex; flex-direction: column; padding: 20px; z-index: 2; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        
        .menu-item { padding: 12px 15px; cursor: pointer; color: inherit; border-radius: 8px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; transition: 0.2s; font-size: 0.95rem; }
        .menu-item:hover, .active-tab { background: rgba(255,255,255,0.1); color: #fff; transform: translateX(5px); border-left: 4px solid var(--accent); }
        
        .stats-container { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { flex: 1; background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: space-between; border-left: 5px solid #007bff; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 10px; overflow: hidden; margin-bottom: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05); }
        th { background: var(--table-header); color: white; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-red { background: #ef4444; } .btn-green { background: #10b981; } .btn-blue { background: #3b82f6; } .btn-dark { background: #334155; } .btn-yellow { background: #f59e0b; color:black; }
        
        .search-box { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.2); color: white; box-sizing: border-box; }

        /* Login & Modal */
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: #1e293b; padding: 40px; border-radius: 15px; width: 350px; text-align: center; border: 1px solid #334155; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #444; border-radius: 6px; background: #0f172a; color: white; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); margin: 2% auto; padding: 0; width: 70%; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; max-height: 90vh; border: 1px solid rgba(255,255,255,0.1); }
        .tab-content { display: none; animation: fadeIn 0.3s; } .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Delil Kartlarƒ± */
        .evidence-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .evidence-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; transition: 0.3s; }
        .evidence-img-container { width: 100%; height: 150px; background: #000; overflow: hidden; cursor: pointer; }
        .evidence-img-container img { width: 100%; height: 100%; object-fit: cover; }
        .evidence-body { padding: 15px; }

        /* GBT & Ceza */
        .gbt-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .ceza-list { max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .ceza-item { padding: 10px; background: rgba(0,0,0,0.2); border-radius: 5px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }
        .ceza-item:hover { background: rgba(255,255,255,0.05); }
        .rutbe-badge { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; background: #334155; }

        /* Telsiz */
        .radio-room-container { display: flex; height: 70vh; gap: 20px; }
        .radio-control { width: 300px; background: var(--sidebar-bg); border-radius: 10px; display: flex; flex-direction: column; overflow: hidden; }
        .chat-area { flex: 1; background: var(--card-bg); border-radius: 10px; display: flex; flex-direction: column; border: 1px solid rgba(255,255,255,0.1); }
        .chat-messages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px; border-radius: 8px; max-width: 80%; font-size: 0.9rem; }
        .msg-mine { align-self: flex-end; background: #3b82f6; color: white; }
        .msg-other { align-self: flex-start; background: #f1f5f9; color: #333; }

        /* Hƒ±zlƒ± Not */
        #quickNotepad { position: fixed; bottom: 20px; right: 20px; width: 250px; background: var(--card-bg); border: 1px solid var(--accent); border-radius: 8px; z-index: 999; box-shadow: 0 5px 15px rgba(0,0,0,0.5); overflow: hidden; transition: 0.3s; }
        #notepadArea { width: 100%; height: 150px; background: rgba(0,0,0,0.3); border: none; padding: 10px; color: white; resize: none; box-sizing: border-box; font-family: monospace; }
        .notepad-min { height: 35px !important; }
        .patrol-card { background: var(--card-bg); border: 1px solid var(--accent); padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="bolo-ticker" id="boloTicker">
    <div style="background:rgba(0,0,0,0.5); padding:0 20px; z-index:11;">üö® BOLO:</div>
    <div class="bolo-content" id="boloText">Sistem aktif.</div>
    <div style="position:absolute; right:10px; z-index:11;"><button onclick="boloDuzenle()" class="btn btn-dark" style="padding:2px 5px; font-size:0.7rem;">G√úNCELLE</button></div>
</div>

<div id="loginScreen">
    <div class="login-box">
        <img src="egmm.png" style="width:80px; margin-bottom:10px;">
        <h2 style="color:white; margin:0; letter-spacing:2px;">EGM G√ñZ</h2>
        <p style="color:#64748b;">Operasyonel Veri Tabanƒ±</p>
        <input type="text" id="kadi" class="login-input" placeholder="Kullanƒ±cƒ± Adƒ±">
        <input type="password" id="sifre" class="login-input" placeholder="≈ûifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px;">Sƒ∞STEME Gƒ∞R</button>
        <p id="loginMsg" style="color:red; margin-top:10px;"></p>
    </div>
</div>

<div id="trafficModal" class="modal"><div class="modal-content" style="width:50%;"><div style="padding:20px; background:var(--sidebar-bg); display:flex; justify-content:space-between;"><h3 style="margin:0">üöî Ara√ß Sorgu</h3><span onclick="document.getElementById('trafficModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div style="padding:30px; text-align:center;"><div id="trafficResult"></div></div></div></div>
<div id="recordModal" class="modal"><div class="modal-content" style="width:50%;"><div style="padding:20px; background:var(--sidebar-bg); display:flex; justify-content:space-between;"><h3 style="margin:0" id="recordTitle">Kayƒ±t</h3><span onclick="document.getElementById('recordModal').style.display='none'" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div id="recordForm" style="padding:30px;"></div></div></div>
<div id="cezaModal" class="modal"><div class="modal-content" style="width:60%;"><div style="padding:20px; display:flex; justify-content:space-between;"><h3>‚öñÔ∏è CEZA Sƒ∞STEMƒ∞</h3><span onclick="document.getElementById('cezaModal').style.display='none'" style="cursor:pointer;">X</span></div><div style="padding:20px;"><input id="ceza_suclu_adi" class="search-box" placeholder="Su√ßlu Adƒ±..."><div id="cezaListesi" class="ceza-list"></div><h2 id="toplamCeza" style="text-align:center; margin:20px 0;">0 TL</h2><button onclick="cezayiKesVeIsle()" class="btn btn-red" style="width:100%;">GBT'YE ƒ∞≈ûLE</button></div></div></div>
<div id="detayModal" class="modal"><div class="modal-content"><div style="padding:20px; display:flex; justify-content:space-between;"><h3>Detay</h3><span onclick="document.getElementById('detayModal').style.display='none'" style="cursor:pointer;">X</span></div><div style="padding:30px;" id="modalIcerik"></div></div></div>

<div class="main-container" id="adminPanel" style="display:none;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px;">
            <img src="egmm.png" style="width:50px;">
            <h3 style="margin:5px 0; font-size:1.1rem;">EGM MDT</h3>
            <span id="aktifKullaniciAdi" style="font-size:0.9rem; font-weight:bold; color:#60a5fa;"></span><br>
            <span id="aktifRutbeGoster" class="rutbe-badge"></span>
            <div id="dijitalSaat" style="margin-top:5px; font-family:monospace; color:#aaa;">00:00:00</div>
        </div>
        <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-line"></i> √ñzet</div>
        <div class="menu-item" onclick="tabDegistir('patrolTab', this)"><i class="fas fa-car-side"></i> Aktif Devriyeler</div>
        <div class="menu-item" onclick="tabDegistir('warrantTab', this)"><i class="fas fa-file-signature"></i> Arama ƒ∞zinleri</div>
        <div class="menu-item" onclick="tabDegistir('tutanakTab', this)"><i class="fas fa-clipboard-list"></i> Olay Tutanaklarƒ±</div>
        <div class="menu-item" onclick="tabDegistir('trafficTab', this)"><i class="fas fa-car"></i> Trafik & Ara√ß</div>
        <div class="menu-item" onclick="tabDegistir('delilTab', this)"><i class="fas fa-folder-open"></i> Delil & Kanƒ±t</div>
        <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-search"></i> GBT Sorgu</div>
        <div class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book"></i> Ceza Kƒ±lavuzu</div>
        <div class="menu-item" onclick="cezaModalAc()"><i class="fas fa-gavel"></i> Ceza Kes</div>
        <div class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Ruhsatlar</div>
        <div class="menu-item" onclick="tabDegistir('basvurularTab', this)"><i class="fas fa-file-contract"></i> Ba≈üvurular</div>
        <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)"><i class="fas fa-users"></i> Personel</div>
        <div class="menu-item" onclick="tabDegistir('sohbetTab', this)"><i class="fas fa-walkie-talkie"></i> Telsiz</div>
        
        <div style="margin-top:auto;">
            <button onclick="cikisYap()" class="btn btn-red" style="width:100%;">√áIKI≈û</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <div class="stats-container">
                <div class="stat-card"><h3 id="statToplam">0</h3><p>Ba≈üvuru</p></div>
                <div class="stat-card"><h3 id="statAranan">0</h3><p>Aranan</p></div>
                <div class="stat-card"><h3 id="statOlay">0</h3><p>Dosya</p></div>
            </div>
        </div>

        <div id="patrolTab" class="tab-content">
            <div style="display:flex; justify-content:space-between;"><h2>üöî Aktif Devriyeler</h2><button onclick="devriyeBaslatModal()" class="btn btn-blue">Devriyeye √áƒ±k</button></div>
            <table><thead><tr><th>Kod</th><th>Birim</th><th>B√∂lge</th><th>Memur</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="patrolListesi"></tbody></table>
        </div>

        <div id="warrantTab" class="tab-content">
            <div style="display:flex; justify-content:space-between;"><h2>‚öñÔ∏è Arama ƒ∞zni (Savcƒ±lƒ±k)</h2><button onclick="warrantEkleModal()" class="btn btn-yellow">ƒ∞zin Talep Et</button></div>
            <div id="warrantListesi"></div>
        </div>

        <div id="tutanakTab" class="tab-content">
            <div style="display:flex; justify-content:space-between;"><h2>üìù Olay Tutanaklarƒ±</h2><button onclick="tutanakEkleModal()" class="btn btn-blue">+ Tutanak Yaz</button></div>
            <table><thead><tr><th>Olay No</th><th>Konu</th><th>Yazan</th><th>Tarih</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="tutanakListesi"></tbody></table>
        </div>

        <div id="trafficTab" class="tab-content">
            <h2>üöî Trafik ≈ûube</h2>
            <div style="background:var(--card-bg); padding:20px; border-radius:8px; margin-bottom:20px; display:flex; gap:10px;">
                <input type="text" id="plakaInput" class="search-box" placeholder="PLAKA (34 ABC 12)" style="margin:0; text-transform:uppercase; text-align:center;">
                <button onclick="plakaSorgula()" class="btn btn-green">SORGULA</button>
            </div>
            <table id="aracListesiTablo"><thead><tr><th>Plaka</th><th>Durum</th><th>Not</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="aracListesiBody"></tbody></table>
        </div>

        <div id="delilTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><h2>üìÅ Delil & Kanƒ±t</h2><button onclick="delilEkleModal()" class="btn btn-blue">+ YENƒ∞ DOSYA</button></div>
            <input type="text" id="delilAra" class="search-box" placeholder="Ara..." onkeyup="delilFiltrele()">
            <div class="evidence-grid" id="evidenceGrid"></div>
        </div>

        <div id="gbtTab" class="tab-content"><h2>GBT Sorgulama</h2><div style="background:var(--card-bg); padding:20px; border-radius:8px; margin-bottom:20px;"><input type="text" id="gbtInput" class="search-box" placeholder="Kimlik/ƒ∞sim..."><button onclick="gbtSorgula()" class="btn btn-green" style="width:100%;">SORGULA</button></div><div id="gbtSonucAlani"></div></div>
        
        <div id="cezaRehberTab" class="tab-content"><h2>TCK Rehberi</h2><input type="text" id="rehberAra" class="search-box" placeholder="Su√ß ara..." onkeyup="tabloAra('rehberAra', 'rehberListesi')"><table><thead><tr><th>Su√ß</th><th>Para</th><th>Kamu</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="rehberListesi"></tbody></table></div>
        
        <div id="ruhsatTab" class="tab-content"><div style="display:flex; justify-content:space-between;"><h2>Ruhsatlar</h2><button onclick="ruhsatEkleModal()" class="btn btn-blue">+ Ekle</button></div><table><thead><tr><th>Sahip</th><th>Tip</th><th>No</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="ruhsatListesi"></tbody></table></div>
        <div id="basvurularTab" class="tab-content"><h2>Ba≈üvurular</h2><button onclick="excelIndir()" class="btn btn-green" style="float:right;">Excel</button><input type="text" id="basvuruAra" class="search-box" placeholder="Ara..." onkeyup="tabloAra('basvuruAra', 'basvuruListesi')"><table><thead><tr><th>ID</th><th>ƒ∞sim</th><th>Durum</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="basvuruListesi"></tbody></table></div>
        <div id="yoneticilerTab" class="tab-content"><h2>Personel</h2><div style="display:flex; gap:10px; margin-bottom:10px;"><input id="yeniKadi" class="search-box" placeholder="Kullanƒ±cƒ±"><input id="yeniSifre" class="search-box" placeholder="≈ûifre"><select id="yeniRutbe" class="search-box"><option>Memur</option><option>Komiser</option><option>M√ºd√ºr</option></select><button onclick="yetkiliEkle()" class="btn btn-green">Ekle</button></div><table><thead><tr><th>Kullanƒ±cƒ±</th><th>R√ºtbe</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="yoneticiListesi"></tbody></table></div>
        <div id="sohbetTab" class="tab-content"><h2>Komuta</h2><div class="radio-room-container"><div class="radio-control"><div style="padding:20px; text-align:center;"><button id="btnConnectRadio" onclick="telsizDurumDegistir()" class="btn btn-red" style="width:100%;">BAƒûLAN</button></div><div id="jitsi-embed-container" style="flex:1; background:black;"></div></div><div class="chat-area"><div class="chat-messages" id="chatMessages"></div><div style="padding:15px; display:flex; gap:10px;"><input type="text" id="chatInput" class="search-box" style="margin:0;" onkeydown="enterBas(event)"><button onclick="mesajGonder()" class="btn btn-blue">G√ñNDER</button></div></div></div></div>
        
        <div id="ayarlarTab" class="tab-content">
            <h2>Ayarlar</h2>
            <div style="background:var(--card-bg); padding:20px; border-radius:8px;">
                <label>Webhook:</label><input type="password" id="webhookUrl" class="search-box" onchange="webhookKaydet()">
                <label>Harita:</label><input type="text" id="mapUrlInput" class="search-box" onchange="mapUrlKaydet()">
                <button onclick="temaDegistir()" class="btn btn-dark">Tema Deƒüi≈ütir</button>
            </div>
            <h3 style="color:red;">Kara Liste</h3>
            <div style="display:flex; gap:10px;"><input type="text" id="yasakliID" placeholder="ID" class="search-box" style="margin:0;"><button onclick="yasakla()" class="btn btn-red">BAN</button></div>
            <table><thead><tr><th>ID</th><th>ƒ∞≈ülem</th></tr></thead><tbody id="blacklistListesi"></tbody></table>
        </div>
    </div>
</div>

<div id="quickNotepad">
    <div id="notepadHeader" onclick="toggleNotepad()">üìù Hƒ±zlƒ± Not <span id="noteToggleIcon">_</span></div>
    <textarea id="notepadArea" placeholder="Plaka, isim, not al... (Otomatik Kaydedilir)" oninput="notuKaydetLocal()"></textarea>
</div>

<script src="config.js"></script>
<script>
    const SFX = { success: new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"), error: new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"), alert: new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg"), click: new Audio("https://actions.google.com/sounds/v1/ui/click_on.ogg") };
    let basvuruVerileri = {}; let aktifKullanici = ""; let aktifRutbe = ""; let jitsiApi = null; let aktifBasvuruKey = null; let mesaiBaslangic = null;
    const cezaKatalogu = [{ad:"Hƒ±z ƒ∞hlali",p:2000,h:0},{ad:"Kƒ±rmƒ±zƒ± I≈üƒ±k",p:1500,h:0},{ad:"Ehliyetsiz",p:5000,h:5},{ad:"Alkoll√º",p:8000,h:10},{ad:"Mukavemet",p:15000,h:25},{ad:"Silahlƒ± Soygun",p:50000,h:60},{ad:"Cinayet",p:200000,h:80}];

    window.onload = function() {
        if(typeof database === 'undefined') { alert("Firebase Hatasƒ±: config.js y√ºklenemedi!"); return; }
        const wh=localStorage.getItem('discordWebhook'); if(wh) document.getElementById('webhookUrl').value=wh;
        const mp=localStorage.getItem('mapUrl'); if(mp) document.getElementById('mapUrlInput').value=mp;
        document.body.setAttribute('data-theme','dark');
        boloGetir(); rehberTablosunuDoldur();
        if(localStorage.getItem('myNote')) document.getElementById('notepadArea').value = localStorage.getItem('myNote');
        setInterval(() => { document.getElementById('dijitalSaat').innerText = new Date().toLocaleTimeString(); }, 1000);
    }

    // --- Gƒ∞Rƒ∞≈û ---
    function girisYap() {
        const k = document.getElementById('kadi').value.trim();
        const s = document.getElementById('sifre').value.trim();
        if(!k || !s) return alert("Bo≈ü alan bƒ±rakmayƒ±nƒ±z.");
        
        if (k === "M√ºd√ºr" && s === "G√∂kSancak1881") {
            database.ref('yetkililer').orderByChild('kadi').equalTo('M√ºd√ºr').once('value', x => { 
                if(!x.exists()) database.ref('yetkililer').push({kadi: 'M√ºd√ºr', sifre: 'G√∂kSancak1881', rutbe:'M√ºd√ºr'}); 
            }); 
            basariliGiris(k, 'M√ºd√ºr'); 
            return;
        }
        
        database.ref('yetkililer').orderByChild('kadi').equalTo(k).once('value')
        .then(snapshot => {
            let found = false; let r = 'Memur';
            snapshot.forEach(c => { if(c.val().sifre === s) { found = true; r = c.val().rutbe || 'Memur'; } });
            
            if(found) basariliGiris(k, r);
            else document.getElementById('loginMsg').innerText = "Hatalƒ± kullanƒ±cƒ± adƒ± veya ≈üifre!";
        })
        .catch(err => {
            alert("Veritabanƒ± hatasƒ±: " + err.message);
        });
    }

    function basariliGiris(isim, rutbe) {
        SFX.success.play(); aktifKullanici = isim; aktifRutbe = rutbe; mesaiBaslangic = Date.now();
        document.getElementById('aktifKullaniciAdi').innerText = isim; 
        document.getElementById('aktifRutbeGoster').innerText = rutbe;
        document.getElementById('aktifRutbeGoster').className = `rutbe-badge rutbe-${rutbe.toLowerCase().replace('√º','u').replace('√∂','o')}`;
        document.getElementById('loginScreen').style.display = 'none'; 
        document.getElementById('adminPanel').style.display = 'flex';
        
        // Verileri Y√ºkle
        verileriGetir(); yoneticileriGetir(); blacklistGetir(); 
        chatBaslat(); gbtGetir(); delilGetir(); ruhsatGetir(); 
        istatistikGuncelle(); aracListesiDinle(); patrolGetir(); warrantGetir(); tutanakGetir();
    }

    function cikisYap() { location.reload(); }
    
    // --- FONKSƒ∞YONLAR ---
    function yetkiKontrol(izinler) { if (!izinler.includes(aktifRutbe)) { alert("Yetkisiz!"); return false; } return true; }
    
    function notuKaydetLocal() { localStorage.setItem('myNote', document.getElementById('notepadArea').value); }
    function toggleNotepad() { document.getElementById('quickNotepad').classList.toggle('notepad-min'); }

    // --- DEVRƒ∞YE ---
    function devriyeBaslatModal() { document.getElementById('recordTitle').innerText="Devriye"; document.getElementById('recordForm').innerHTML=`<input id="p_code" class="search-box" placeholder="Kod"><input id="p_car" class="search-box" placeholder="Ara√ß"><input id="p_area" class="search-box" placeholder="B√∂lge"><button onclick="patrolEkle()" class="btn btn-green" style="width:100%">BA≈ûLA</button>`; document.getElementById('recordModal').style.display='block'; }
    function patrolEkle() { const c=document.getElementById('p_code').value; const v=document.getElementById('p_car').value; const a=document.getElementById('p_area').value; if(c){ database.ref('active_patrols').push({code:c, car:v, area:a, officer:aktifKullanici}); document.getElementById('recordModal').style.display='none'; } }
    function patrolGetir() { database.ref('active_patrols').on('value', s => { const l=document.getElementById('patrolListesi'); l.innerHTML=""; s.forEach(c => { const d=c.val(); l.innerHTML+=`<tr><td>${d.code}</td><td>${d.car}</td><td>${d.area}</td><td>${d.officer}</td><td><button onclick="dbSil('active_patrols/${c.key}')" class="btn btn-red">Bƒ∞Tƒ∞R</button></td></tr>`; }); }); }

    // --- WARRANT ---
    function warrantEkleModal() { document.getElementById('recordTitle').innerText="Arama ƒ∞zni"; document.getElementById('recordForm').innerHTML=`<input id="w_target" class="search-box" placeholder="Hedef"><textarea id="w_reason" class="search-box" placeholder="Sebep"></textarea><button onclick="warrantEkle()" class="btn btn-yellow" style="width:100%">TALEP ET</button>`; document.getElementById('recordModal').style.display='block'; }
    function warrantEkle() { const t=document.getElementById('w_target').value; const r=document.getElementById('w_reason').value; if(t){ database.ref('warrants').push({target:t, reason:r, status:'Beklemede', officer:aktifKullanici}); document.getElementById('recordModal').style.display='none'; } }
    function warrantGetir() { database.ref('warrants').on('value', s => { const l=document.getElementById('warrantListesi'); l.innerHTML=""; s.forEach(c => { const d=c.val(); let btn = (aktifRutbe==='M√ºd√ºr' && d.status==='Beklemede') ? `<button onclick="warrantDurum('${c.key}','Onaylandƒ±')">ONAY</button>` : ''; l.innerHTML+=`<div class="patrol-card"><div><b>${d.target}</b><br>${d.reason}</div>${btn}</div>`; }); }); }
    function warrantDurum(k,s){ database.ref('warrants/'+k).update({status:s}); }

    // --- CEZA & GBT ---
    function cezaModalAc(preSelectIndex = -1) { const list=document.getElementById('cezaListesi'); list.innerHTML=""; cezaKatalogu.forEach((c,i)=>{ list.innerHTML+=`<div class="ceza-item" onclick="cezaSec(${i},this)"><input type="checkbox" id="cezaCheck${i}"><span>${c.ad}</span><span style="font-size:0.8rem;color:gray;">${c.p} TL / ${c.h} K</span></div>`; }); cezaSifirla(); document.getElementById('cezaModal').style.display='block'; }
    function cezaSec(i,d){ const c=document.getElementById(`cezaCheck${i}`); c.checked=!c.checked; d.style.background=c.checked?"#d1fae5":"rgba(0,0,0,0.05)"; cezaHesapla(); }
    function cezaHesapla(){ let p=0; let h=0; cezaKatalogu.forEach((c,i)=>{ if(document.getElementById(`cezaCheck${i}`).checked) { p+=c.p; h+=c.h; } }); document.getElementById('toplamCeza').innerText=`${p} TL / ${h} Kamu`; }
    function cezaSifirla(){ document.getElementById('toplamCeza').innerText="0 TL / 0 Kamu"; }
    function cezayiKesVeIsle() { const suclu = document.getElementById('ceza_suclu_adi').value.trim(); const cezaTxt = document.getElementById('toplamCeza').innerText; if(!suclu) return alert("ƒ∞sim?"); database.ref('gbt_kayitlari').push({ vatandas: suclu, suc: cezaTxt, durum: "ƒ∞≈ülendi", ekleyen: aktifKullanici, tarih: Date.now() }); alert("ƒ∞≈ülendi!"); document.getElementById('cezaModal').style.display='none'; }
    function rehberTablosunuDoldur() { const t = document.getElementById('rehberListesi'); t.innerHTML = ""; cezaKatalogu.forEach((c,i) => { t.innerHTML += `<tr><td>${c.ad}</td><td>${c.p} TL</td><td>${c.h} K</td><td><button onclick="cezaModalAc(${i})" class="btn btn-blue" style="padding:2px 8px;">SE√á</button></td></tr>`; }); }
    function gbtSorgula() { const q=document.getElementById('gbtInput').value.toLowerCase(); const a=document.getElementById('gbtSonucAlani'); a.innerHTML=""; database.ref('gbt_kayitlari').once('value',s=>{ s.forEach(c=>{ const d=c.val(); if(d.vatandas.toLowerCase().includes(q)) a.innerHTML+=`<div class="gbt-card"><b>${d.vatandas}</b> - ${d.suc} <button onclick="dbSil('gbt_kayitlari/${c.key}')" class="btn btn-red">Sil</button></div>`; }); }); }
    function gbtGetir() { database.ref('gbt_kayitlari').on('value', s => { document.getElementById('statAranan').innerText = s.numChildren(); }); }

    // --- Dƒ∞ƒûER ---
    function plakaSorgula() { const p=document.getElementById('plakaInput').value.toUpperCase(); database.ref('araclar').orderByChild('plaka').equalTo(p).once('value',s=>{ if(s.exists()){ s.forEach(c=>{ alert(c.val().durum); }); } else { if(confirm("Kayƒ±t yok. Olu≈ütur?")) database.ref('araclar').push({plaka:p, durum:'Temiz'}); } }); }
    function aracListesiDinle() { database.ref('araclar').limitToLast(10).on('value',s=>{ const t=document.getElementById('aracListesiBody'); t.innerHTML=""; s.forEach(c=>{ const d=c.val(); t.innerHTML+=`<tr><td>${d.plaka}</td><td>${d.durum}</td><td>${d.not||'-'}</td><td><button onclick="dbSil('araclar/${c.key}')">Sil</button></td></tr>`; }); }); }
    function boloDuzenle(){ if(!yetkiKontrol(['M√ºd√ºr']))return; const m=prompt("BOLO:"); if(m) database.ref('bolo').set(m); }
    function boloGetir(){ database.ref('bolo').on('value',s=>{document.getElementById('boloText').innerText=s.val()||"Temiz.";}); }
    
    // --- STANDART CRUD ---
    function verileriGetir() { database.ref('basvurular').on('value',s=>{ const l=document.getElementById('basvuruListesi'); l.innerHTML=""; s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${d.discord_id}</td><td>${d.ic_isim}</td><td>${d.durum}</td><td><button onclick="dbSil('basvurular/${c.key}')">Sil</button></td></tr>`; }); document.getElementById('statToplam').innerText=s.numChildren(); }); }
    function delilEkleModal(){ document.getElementById('recordModal').style.display='block'; } // (Basitle≈ütirildi)
    function delilKaydet(){ const n=document.getElementById('delil_no').value; if(n){ database.ref('delil_dosyalari').push({no:n, tarih:Date.now()}); document.getElementById('recordModal').style.display='none'; } }
    function delilGetir(){ database.ref('delil_dosyalari').on('value',s=>{ const g=document.getElementById('evidenceGrid'); g.innerHTML=""; s.forEach(c=>{ const d=c.val(); g.innerHTML+=`<div class="evidence-card"><div class="evidence-body"><b>#${d.no}</b><br><button onclick="dbSil('delil_dosyalari/${c.key}')" class="btn btn-red">Sil</button></div></div>`; }); document.getElementById('statOlay').innerText=s.numChildren(); }); }
    function delilFiltrele(){ } 
    
    function ruhsatEkleModal(){ const s=prompt("Sahip?"); if(s) database.ref('ruhsat_kayitlari').push({sahip:s, durum:'Aktif'}); }
    function ruhsatGetir(){ database.ref('ruhsat_kayitlari').on('value',s=>{ const l=document.getElementById('ruhsatListesi'); l.innerHTML=""; s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${d.sahip}</td><td>-</td><td>-</td><td>${d.durum}</td><td><button onclick="dbSil('ruhsat_kayitlari/${c.key}')">Sil</button></td></tr>`; }); }); }
    
    function yoneticileriGetir(){ database.ref('yetkililer').on('value',s=>{ const l=document.getElementById('yoneticiListesi'); l.innerHTML=""; s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>${d.kadi}</td><td>${d.rutbe}</td><td><button onclick="dbSil('yetkililer/${c.key}')">Sil</button></td></tr>`; }); }); }
    function yetkiliEkle(){ if(!yetkiKontrol(['M√ºd√ºr']))return; const k=document.getElementById('yeniKadi').value; const s=document.getElementById('yeniSifre').value; const r=document.getElementById('yeniRutbe').value; if(k) database.ref('yetkililer').push({kadi:k, sifre:s, rutbe:r}); }
    
    function tutanakEkleModal(){ const k=prompt("Konu?"); if(k) database.ref('tutanaklar').push({konu:k, memur:aktifKullanici, tarih:Date.now()}); }
    function tutanakGetir(){ database.ref('tutanaklar').on('value',s=>{ const l=document.getElementById('tutanakListesi'); l.innerHTML=""; s.forEach(c=>{ const d=c.val(); l.innerHTML+=`<tr><td>-</td><td>${d.konu}</td><td>${d.memur}</td><td>-</td><td>-</td></tr>`; }); }); }
    
    function dbSil(y){ if(confirm("Sil?")) database.ref(y).remove(); }
    function istatistikGuncelle(){}
    function blacklistGetir(){}
    function yasakla(){}
    function tabDegistir(i,e){ document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(i).classList.add('active'); e.classList.add('active-tab'); }
    function tabloAra(i,t){ let v=document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?'':'none'); }
    function temaDegistir(){ if(document.body.getAttribute('data-theme')==='dark'){ document.body.removeAttribute('data-theme'); localStorage.setItem('tema','light'); }else{ document.body.setAttribute('data-theme','dark'); localStorage.setItem('tema','dark'); } }
    function webhookKaydet(){ localStorage.setItem('discordWebhook',document.getElementById('webhookUrl').value); }
    function mapUrlKaydet(){ localStorage.setItem('mapUrl',document.getElementById('mapUrlInput').value); }
    function excelIndir(){ alert("ƒ∞ndiriliyor..."); }
    function mesaiBitirVeCikis(){ if(confirm("√áƒ±kƒ±≈ü?")) location.reload(); }

    function telsizDurumDegistir(){ const c=document.getElementById('jitsi-embed-container'); if(jitsiApi){jitsiApi.dispose();jitsiApi=null;c.innerHTML="";}else{jitsiApi=new JitsiMeetExternalAPI("meet.jit.si",{roomName:"EGM_Ozel_Kanal_2024",width:"100%",height:"100%",parentNode:c,configOverwrite:{startWithAudioMuted:false,startWithVideoMuted:true,prejoinPageEnabled:false},userInfo:{displayName:aktifKullanici}});}}
    function chatBaslat(){ database.ref('chat').limitToLast(50).on('child_added',s=>{const d=s.val();document.getElementById('chatMessages').innerHTML+=`<div class="message ${d.gonderen===aktifKullanici?'msg-mine':'msg-other'}"><b>${d.gonderen}:</b> ${d.mesaj}</div>`;}); }
    function mesajGonder(){ const i=document.getElementById('chatInput'); if(i.value){database.ref('chat').push({gonderen:aktifKullanici,mesaj:i.value,zaman:Date.now()}); i.value="";} }
    function enterBas(e){ if(e.key==='Enter')mesajGonder(); }
</script>
</body>
</html>
