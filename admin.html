<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLNET v18.5 - EGM Yönetim</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0f172a; --sidebar-bg: #020617; --card-bg: #1e293b; --text-main: #f1f5f9; --text-muted: #94a3b8; --border: #334155; --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 15px; }
        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; overflow-y: auto; z-index: 10; }
        .content { flex: 1; padding: 30px; overflow-y: auto; background-image: radial-gradient(var(--card-bg) 1px, transparent 1px); background-size: 20px 20px; }
        .menu-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 10px; color: var(--text-muted); transition: 0.2s; }
        .menu-item:hover, .active-tab { background: rgba(59,130,246,0.15); color: white; border-left: 3px solid var(--accent); }
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 10px; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 5px; justify-content: center; }
        .btn-blue { background: var(--accent); } .btn-green { background: var(--success); } .btn-red { background: var(--danger); }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th { background: rgba(0,0,0,0.4); color: var(--accent); padding: 15px; text-align: left; border-bottom: 2px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { background: var(--card-bg); width: 60%; max-height: 90vh; border-radius: 12px; overflow-y: auto; padding: 25px; }
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; }
        .badge-blue { background: rgba(59,130,246,0.2); color: var(--accent); }
    </style>
</head>
<body>

<div id="loginScreen">
    <div style="background:var(--card-bg); padding:50px; border-radius:15px; width:400px; text-align:center;">
        <img src="egmm.png" style="width:100px; margin-bottom:20px;">
        <h2>POLNET GİRİŞ</h2>
        <input type="text" id="kadi" placeholder="Sicil No">
        <input type="password" id="sifre" placeholder="Şifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%;">GİRİŞ YAP</button>
        <p id="loginMsg" style="color:var(--danger); margin-top:15px;"></p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px;">
            <img src="egmm.png" style="width:70px;">
            <h3 id="aktifKullaniciAdi">POLNET</h3>
            <div id="aktifRutbeGoster" class="badge badge-blue"></div>
        </div>
        <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-home"></i> Panel</div>
        <div class="menu-item" onclick="tabDegistir('basvuruTab', this)"><i class="fas fa-file-signature"></i> Başvurular</div>
        <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-fingerprint"></i> GBT</div>
        <div class="menu-item" onclick="tabDegistir('personelTab', this)"><i class="fas fa-users"></i> Personel</div>
        <button onclick="location.reload()" class="btn btn-red" style="margin-top:auto;">ÇIKIŞ</button>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <h1>Özet Durum</h1>
            <div class="grid-3">
                <div class="card"><h3>Bekleyen Başvuru</h3><h1 id="statBasvuru">0</h1></div>
                <div class="card"><h3>Aranan Şahıs</h3><h1 id="statAranan">0</h1></div>
                <div class="card"><h3>Toplam Tutanak</h3><h1 id="statDosya">0</h1></div>
            </div>
        </div>

        <div id="basvuruTab" class="tab-content">
            <h1>Aday Başvuruları</h1>
            <table>
                <thead><tr><th>İsim (IC)</th><th>Discord ID</th><th>Yaş</th><th>Durum</th><th>İşlem</th></tr></thead>
                <tbody id="basvuruListesi"></tbody>
            </table>
        </div>

        <div id="gbtTab" class="tab-content">
            <h1>GBT Sorgu</h1>
            <div class="card"><input id="gbtInput" placeholder="İsim ara..."><button onclick="gbtSorgula()" class="btn btn-blue">ARA</button></div>
            <div id="gbtSonuc"></div>
        </div>
        
        <div id="personelTab" class="tab-content">
            <h1>Personel</h1>
            <table><thead><tr><th>Sicil</th><th>Rütbe</th></tr></thead><tbody id="personelListesi"></tbody></table>
        </div>
    </div>
</div>

<div id="basvuruModal" class="modal">
    <div class="modal-content">
        <h2 id="m_isim"></h2>
        <div id="m_cevaplar" style="background:rgba(0,0,0,0.2); padding:15px; border-radius:8px;"></div>
        <div style="margin-top:20px;">
            <textarea id="redSebebi" placeholder="Red sebebi (Opsiyonel)"></textarea>
            <button onclick="basvuruKarar('Onaylandı')" class="btn btn-green">ONAYLA</button>
            <button onclick="basvuruKarar('Reddedildi')" class="btn btn-red">REDDET</button>
            <button onclick="modalKapat()" class="btn">KAPAT</button>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    let aktifKullanici = ""; let seciliBasvuruKey = "";

    function girisYap() {
        const k = document.getElementById('kadi').value;
        const s = document.getElementById('sifre').value;
        // Basit kontrol (Firebase'deki personel tablosuna göre geliştirilebilir)
        if(k === "admin" && s === "1234") {
            basariliGiris(k, "Müdür");
        } else {
            document.getElementById('loginMsg').innerText = "Hatalı Giriş!";
        }
    }

    function basariliGiris(k, r) {
        aktifKullanici = k;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'flex';
        document.getElementById('aktifKullaniciAdi').innerText = k;
        document.getElementById('aktifRutbeGoster').innerText = r;
        verileriYukle();
    }

    function verileriYukle() {
        // Başvuruları Getir
        database.ref('basvurular').on('value', s => {
            const tbody = document.getElementById('basvuruListesi');
            tbody.innerHTML = "";
            let bekleyen = 0;
            s.forEach(c => {
                const d = c.val();
                if(d.durum === 'Beklemede') bekleyen++;
                tbody.innerHTML += `<tr>
                    <td>${d.ic_isim}</td>
                    <td>${d.discord_id}</td>
                    <td>${d.ooc_yas}</td>
                    <td>${d.durum}</td>
                    <td><button onclick="basvuruDetay('${c.key}')" class="btn btn-blue">İNCELE</button></td>
                </tr>`;
            });
            document.getElementById('statBasvuru').innerText = bekleyen;
        });

        // Diğer İstatistikler
        database.ref('gbt').on('value', s => {
            let aranan = 0;
            if(s.exists()) s.forEach(c => { if(c.val().not.includes("Aranıyor")) aranan++; });
            document.getElementById('statAranan').innerText = aranan;
        });
    }

    function basvuruDetay(key) {
        seciliBasvuruKey = key;
        database.ref('basvurular/' + key).once('value', s => {
            const d = s.val();
            document.getElementById('m_isim').innerText = d.ic_isim;
            let html = "";
            for(let f in d.cevaplar) {
                html += `<p><strong>${f}:</strong> ${d.cevaplar[f]}</p>`;
            }
            document.getElementById('m_cevaplar').innerHTML = html;
            document.getElementById('basvuruModal').style.display = 'flex';
        });
    }

    function basvuruKarar(durum) {
        const sebep = document.getElementById('redSebebi').value;
        database.ref('basvurular/' + seciliBasvuruKey).update({
            durum: durum,
            red_sebebi: sebep
        });
        modalKapat();
    }

    function modalKapat() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
    function tabDegistir(id, el) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active-tab'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active-tab');
    }
</script>
</body>
</html>
