<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POLNET v3.5 - Organize SuÃ§lar BÃ¼rosu</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@300;400;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #0f172a; --sidebar-bg: #020617; --card-bg: #1e293b; --text-main: #f1f5f9; --text-muted: #94a3b8; --border: #334155; --accent: #3b82f6; --danger: #ef4444; --success: #10b981; --warning: #f59e0b; }
        
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; font-size: 14px; transition: background 0.5s ease; }

        /* OHAL MODU */
        body.ohal-active { 
            --bg-dark: #2a0505; --sidebar-bg: #1a0000; --card-bg: #3f0a0a; --accent: #ff0000; --border: #5c1818; 
            animation: redPulse 2s infinite alternate;
        }
        @keyframes redPulse { 0% { box-shadow: inset 0 0 0 0 rgba(255, 0, 0, 0); } 100% { box-shadow: inset 0 0 100px 30px rgba(255, 0, 0, 0.4); } }
        
        #ohalAlertBar { 
            background: #000; color: red; font-family: 'Chakra Petch', sans-serif; font-weight: 900; font-size: 1.5rem; 
            padding: 10px 0; border-bottom: 4px solid red; white-space: nowrap; overflow: hidden; display: none; z-index: 9999; 
            position: fixed; top: 0; width: 100%; letter-spacing: 2px;
        }
        .ohal-content { display: inline-block; padding-left: 100%; animation: ohalScroll 15s linear infinite; }
        @keyframes ohalScroll { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* LAYOUT */
        .sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 15px; overflow-y: auto; z-index: 10; padding-bottom: 50px; }
        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; background-image: radial-gradient(var(--card-bg) 1px, transparent 1px); background-size: 20px 20px; padding-bottom: 50px; }
        body.ohal-active .sidebar, body.ohal-active .content { margin-top: 50px; }

        .menu-item { padding: 12px; margin-bottom: 5px; cursor: pointer; border-radius: 6px; display: flex; align-items: center; gap: 10px; color: var(--text-muted); transition: 0.2s; font-weight: 500; font-family: 'Chakra Petch', sans-serif; letter-spacing: 0.5px; }
        .menu-item:hover, .active-tab { background: rgba(59,130,246,0.15); color: white; border-left: 3px solid var(--accent); }
        
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.2); }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        h1, h2, h3 { font-family: 'Chakra Petch', sans-serif; margin-top: 0; }
        
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; border-radius: 6px; margin-bottom: 10px; font-family: 'Inter', sans-serif; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }
        
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 5px; justify-content: center; font-family: 'Chakra Petch', sans-serif; text-transform: uppercase; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-blue { background: var(--accent); } .btn-green { background: var(--success); } .btn-red { background: var(--danger); } .btn-dark { background: #334155; } .btn-yellow { background: #f59e0b; color:black; }
        
        table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-bottom: 20px; }
        th { background: rgba(0,0,0,0.4); color: var(--accent); padding: 15px; text-align: left; border-bottom: 2px solid var(--border); font-family: 'Chakra Petch', sans-serif; }
        td { padding: 15px; border-bottom: 1px solid var(--border); }
        tr:hover td { background: rgba(255,255,255,0.02); }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--card-bg); width: 70%; max-height: 90vh; border-radius: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: zoomIn 0.2s; }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-header { padding: 20px; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 25px; overflow-y: auto; }

        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: #020617; z-index: 9999; display: flex; justify-content: center; align-items: center; background-image: radial-gradient(circle at center, #1e293b 0%, #020617 100%); }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }
        
        .badge { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-blue { background: rgba(59,130,246,0.2); color: var(--accent); border: 1px solid var(--accent); }
        .badge-red { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .badge-green { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
        .badge-warn { background: rgba(245, 158, 11, 0.2); color: var(--warning); border: 1px solid var(--warning); }
        .badge-purple { background: rgba(147, 51, 234, 0.2); color: #c084fc; border: 1px solid #c084fc; }

        .mesai-card { text-align: center; border: 2px solid var(--border); transition: 0.3s; }
        .mesai-active { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        #mesaiSayac { font-size: 3rem; font-family: 'Chakra Petch', monospace; font-weight: bold; margin: 20px 0; }
        
        .ceza-item { padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; font-size: 0.9rem; }
        .ceza-item:hover { background: rgba(255,255,255,0.05); }
        .ceza-item.selected { background: rgba(59,130,246,0.2); border-left: 4px solid var(--accent); }
        .ceza-code { color: var(--text-muted); font-family: 'Chakra Petch'; margin-right: 10px; width: 80px; display:inline-block; }
    </style>
</head>
<body>

<div id="ohalAlertBar"><div class="ohal-content">âš ï¸ DÄ°KKAT: OLAÄANÃœSTÃœ HAL (OHAL) Ä°LAN EDÄ°LMÄ°ÅTÄ°R! âš ï¸ TÃœM Ä°ZÄ°NLER Ä°PTAL. SOKAÄA Ã‡IKMA YASAÄI AKTÄ°F. ÅÃœPHELÄ° GÃ–RÃœLEN HERKES GÃ–ZALTINA ALINACAKTIR.</div></div>

<div id="loginScreen">
    <div style="background:var(--card-bg); padding:50px; border-radius:15px; width:400px; text-align:center; border:1px solid var(--border); box-shadow: 0 0 80px rgba(0,0,0,0.6);">
        <img src="egmm.png" style="width:100px; margin-bottom:20px; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
        <h2 style="margin:0; color:white; letter-spacing: 2px;">POLNET v3.5</h2>
        <p style="color:var(--text-muted); margin-bottom:30px;">Emniyet Genel MÃ¼dÃ¼rlÃ¼ÄŸÃ¼ Personel GiriÅŸi</p>
        <input type="text" id="kadi" placeholder="Sicil No">
        <input type="password" id="sifre" placeholder="Åifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; margin-top:10px; padding: 15px;">SÄ°STEME GÄ°RÄ°Å YAP</button>
        <p id="loginMsg" style="color:var(--danger); margin-top:15px;"></p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <div style="text-align:center; margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
            <img src="egmm.png" style="width:70px; margin-bottom:10px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9203/9203764.png'">
            <h3 style="margin:0; font-size:1.4rem;">POLNET</h3>
            <div id="aktifKullaniciAdi" style="font-weight:bold; color:white; margin-top:10px;"></div>
            <div class="badge badge-blue" style="margin-top:5px; display:inline-block;">MEMUR</div>
        </div>

        <div class="menu-item active-tab" onclick="tabDegistir('dashboardTab', this)"><i class="fas fa-chart-pie"></i> Ã–zet Durum</div>
        <div class="menu-item" onclick="tabDegistir('basvuruTab', this)"><i class="fas fa-clipboard-list"></i> BaÅŸvurular <span id="basvuruBadge" class="badge badge-red" style="margin-left:auto; display:none;">0</span></div>
        <div class="menu-item" onclick="tabDegistir('mesaiTab', this)"><i class="fas fa-clock"></i> Mesai Ä°ÅŸlemleri</div>
        <div class="menu-item" onclick="tabDegistir('ruhsatTab', this)"><i class="fas fa-id-card"></i> Silah RuhsatlarÄ±</div>
        <div class="menu-item" onclick="tabDegistir('cezaRehberTab', this)"><i class="fas fa-book"></i> TCK VeritabanÄ±</div>
        <div class="menu-item" onclick="tabDegistir('gbtTab', this)"><i class="fas fa-fingerprint"></i> GBT Sorgu & Ä°ÅŸlem</div>
        <div class="menu-item" onclick="tabDegistir('aracTab', this)"><i class="fas fa-car"></i> AraÃ§ & Trafik</div>
        <div class="menu-item" onclick="tabDegistir('personelTab', this)"><i class="fas fa-users-cog"></i> Personel YÃ¶netimi</div>
        
        <div style="margin-top:auto;">
            <button id="ohalBtn" onclick="ohalDegistir()" class="btn btn-red" style="width:100%; margin-bottom:10px; padding:15px; font-size:1rem;">ğŸš¨ OHAL BAÅLAT</button>
            <button onclick="location.reload()" class="btn btn-dark" style="width:100%;">GÃœVENLÄ° Ã‡IKIÅ</button>
        </div>
    </div>

    <div class="content">
        <div id="dashboardTab" class="tab-content active">
            <h1 style="margin-bottom:20px;">Komuta Merkezi</h1>
            <div class="grid-3">
                <div class="card" style="border-left:4px solid var(--warning);"><h3>Bekleyen BaÅŸvuru</h3><h1 id="statBasvuru">0</h1></div>
                <div class="card" style="border-left:4px solid var(--danger);"><h3>Aranan ÅahÄ±s</h3><h1 id="statAranan">0</h1></div>
                <div class="card" style="border-left:4px solid var(--success);"><h3>Aktif Devriye</h3><h1 id="statAktifPersonel">0</h1></div>
            </div>
            <div class="card">
                <h3><i class="fas fa-shield-alt"></i> Organize SuÃ§larla MÃ¼cadele GÃ¼ncellemesi v3.5</h3>
                <p>Yeni TÃ¼rk Ceza Kanunu veritabanÄ± sisteme entegre edildi. Toplam <strong>1000 adet</strong> organize suÃ§, Ã§ete ve terÃ¶r materyali eklendi. Maksimum hapis limiti <strong>300 yÄ±l</strong>, maksimum para cezasÄ± <strong>400.000 TL</strong> olarak gÃ¼ncellendi.</p>
            </div>
        </div>

        <div id="basvuruTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;"><h1>Gelen BaÅŸvurular</h1><button onclick="verileriYukle()" class="btn btn-dark"><i class="fas fa-sync"></i> Yenile</button></div>
            <div class="card">
                <input type="text" id="basvuruAra" placeholder="Ä°sim veya Discord ID ara..." onkeyup="tabloAra('basvuruAra','basvuruListesi')">
                <table><thead><tr><th>Tarih</th><th>Discord ID</th><th>IC Ä°sim</th><th>Durum</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="basvuruListesi"></tbody></table>
            </div>
            <div class="card"><h3>ğŸš« Kara Liste</h3><div style="display:flex; gap:10px;"><input id="bl_id" placeholder="Discord ID"><input id="bl_sebep" placeholder="Sebep"><button onclick="karaListeyeEkle()" class="btn btn-red">EKLE</button></div><div id="blacklistContainer" style="margin-top:10px; max-height:150px; overflow-y:auto;"></div></div>
        </div>

        <div id="ruhsatTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Silah RuhsatÄ± YÃ¶netimi</h1>
                <button onclick="modalAc('ruhsatEkleModal')" class="btn btn-blue">+ YENÄ° RUHSAT TANIMLA</button>
            </div>
            <div class="card">
                <input type="text" id="ruhsatAra" placeholder="Ruhsat sahibi adÄ± ara..." onkeyup="tabloAra('ruhsatAra','ruhsatListesi')">
                <table>
                    <thead><tr><th>Ruhsat Sahibi</th><th>Ruhsat Tipi</th><th>GeÃ§erlilik Tarihi</th><th>Veren Memur</th><th>Ä°ÅŸlem</th></tr></thead>
                    <tbody id="ruhsatListesi"></tbody>
                </table>
            </div>
        </div>

        <div id="cezaRehberTab" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h1>Ceza Kanunu Rehberi (TCK)</h1>
                <button onclick="modalAc('tckEkleModal')" class="btn btn-yellow">+ MANUEL KANUN EKLE</button>
            </div>
            <p style="color:var(--text-muted);">Sistemde ÅŸu an aktif olarak 1000 adet organize suÃ§ materyali bulunmaktadÄ±r.</p>
            <div class="card" style="height:600px; overflow-y:auto;">
                <input id="tckAra" placeholder="Kanun kodu veya adÄ± ara... (Ã–rn: ORG-001)" onkeyup="tabloAra('tckAra','tckEditListesi')">
                <table>
                    <thead><tr><th>Kod</th><th>SuÃ§ TanÄ±mÄ±</th><th>Para CezasÄ±</th><th>Hapis CezasÄ±</th></tr></thead>
                    <tbody id="tckEditListesi"></tbody>
                </table>
            </div>
        </div>

        <div id="mesaiTab" class="tab-content">
            <h1>Mesai Ä°ÅŸlemleri</h1>
            <div class="card mesai-card" id="kisiselMesaiKart">
                <h3 id="mesaiDurumText" style="color:var(--text-muted);">MESAÄ° DIÅI</h3>
                <div id="mesaiSayac">00:00:00</div>
                <button onclick="mesaiToggle()" id="btnMesai" class="btn btn-green" style="font-size:1.5rem; padding:15px 50px;">MESAÄ°YE BAÅLA</button>
            </div>
            <div class="card">
                <h3><i class="fas fa-users"></i> Aktif Personeller</h3>
                <table id="aktifMesaiTablo"><thead><tr><th>Personel</th><th>BaÅŸlangÄ±Ã§ Saati</th><th>Aktif SÃ¼re</th></tr></thead><tbody id="aktifMesaiBody"></tbody></table>
            </div>
        </div>

        <div id="gbtTab" class="tab-content">
            <h1>GBT Sorgu & Ceza Sistemi</h1>
            <div class="card">
                <div class="grid-2"><input id="gbtInput" placeholder="VatandaÅŸ AdÄ±..."><button onclick="gbtSorgula()" class="btn btn-green">SORGULA</button></div>
            </div>
            <div id="gbtSonuc"></div>
            <button onclick="cezaModalAc()" class="btn btn-red" style="width:100%; margin-top:20px; padding:20px; font-size:1.2rem;">âš–ï¸ YENÄ° CEZA / SABIKA KAYDI OLUÅTUR</button>
        </div>

        <div id="aracTab" class="tab-content">
            <h1>Trafik Åube</h1>
            <div class="card" style="text-align:center;">
                <input id="plakaInput" placeholder="PLAKA (34 TR 34)" style="text-align:center; font-size:3rem; text-transform:uppercase; letter-spacing:5px; font-family:'Chakra Petch'; width:60%;">
                <br><br>
                <button onclick="plakaSorgula()" class="btn btn-green" style="padding:15px 40px; font-size:1.2rem;">SORGULA</button>
            </div>
            <div id="aracSonuc" style="margin-top:20px;"></div>
        </div>

        <div id="personelTab" class="tab-content">
            <h1>Personel YÃ¶netimi</h1>
            <div class="card"><div class="grid-3"><input id="yeniKadi" placeholder="Sicil"><input id="yeniSifre" placeholder="Åifre"><button onclick="personelEkle()" class="btn btn-green">EKLE</button></div></div>
            <table><thead><tr><th>Sicil</th><th>Åifre</th><th>Ä°ÅŸlem</th></tr></thead><tbody id="personelListesi"></tbody></table>
        </div>
    </div>
</div>

<div id="basvuruModal" class="modal"><div class="modal-content"><div class="modal-header"><h3>BaÅŸvuru Ä°nceleme</h3><span onclick="modalKapat()" style="cursor:pointer; font-size:1.5rem;">&times;</span></div><div class="modal-body"><div id="basvuruDetayIcerik"></div><hr style="border-color:var(--border); margin:20px 0;"><div id="basvuruIslemButtonlari" class="grid-3"></div></div></div></div>

<div id="ruhsatEkleModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h3>Yeni Silah RuhsatÄ±</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div>
        <div class="modal-body">
            <input id="ruh_sahip" placeholder="Ruhsat Sahibi (Ad Soyad)">
            <select id="ruh_tip">
                <option value="Silah TaÅŸÄ±ma">Silah TaÅŸÄ±ma RuhsatÄ±</option>
                <option value="Silah Bulundurma">Silah Bulundurma RuhsatÄ±</option>
                <option value="Av TÃ¼feÄŸi">Av TÃ¼feÄŸi RuhsatÄ±</option>
            </select>
            <label style="color:var(--text-muted); font-size:0.8rem;">GeÃ§erlilik Tarihi:</label>
            <input type="date" id="ruh_tarih">
            <button onclick="ruhsatKaydet()" class="btn btn-green" style="width:100%; margin-top:10px;">RUHSATI OLUÅTUR</button>
        </div>
    </div>
</div>

<div id="tckEkleModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h3>Kanun Ekle / DÃ¼zenle</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div>
        <div class="modal-body">
            <input id="edit_ad" placeholder="SuÃ§ TanÄ±mÄ± (Ã–rn: Banka Soygunu)">
            <div class="grid-2">
                <input id="edit_para" type="number" placeholder="Para CezasÄ± (TL)">
                <input id="edit_kamu" type="number" placeholder="Hapis CezasÄ± (Ay)">
            </div>
            <button onclick="tckKaydet()" class="btn btn-green" style="width:100%">VERÄ°TABANINA KAYDET</button>
        </div>
    </div>
</div>

<div id="cezaModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h3>Adalet BakanlÄ±ÄŸÄ± Ceza Sistemi</h3><span onclick="modalKapat()" style="cursor:pointer;">&times;</span></div>
        <div class="modal-body">
            <input id="ceza_sahis" placeholder="SuÃ§lu AdÄ± SoyadÄ±..." style="border:2px solid var(--accent);">
            <div class="grid-2"><input id="ceza_ara" placeholder="SuÃ§ Kodu veya AdÄ± Ara..." onkeyup="cezaFiltrele()"><button onclick="cezaSifirla()" class="btn btn-dark">SeÃ§imleri Temizle</button></div>
            <div style="height:400px; overflow-y:auto; border:1px solid #334155; padding:10px; margin-bottom:15px;" id="cezaListesiContainer">
                </div>
            <div style="background:#0f172a; padding:15px; text-align:center; border-radius:8px;">
                <h2 id="toplamTutar" style="color:var(--danger); margin:0;">0 TL / 0 YÄ±l</h2>
            </div>
            <button onclick="cezayiKes()" class="btn btn-red" style="width:100%; margin-top:15px; padding:15px;">CEZAYI ONAYLA VE Ä°ÅLE</button>
        </div>
    </div>
</div>

<script src="config.js"></script>
<script>
    let aktifKullanici = "";
    let seciliBasvuruId = "";
    let myShiftStart = null;
    let myShiftTimer = null;
    let tckDb = []; 

    // --- 1000 ADETLÄ°K GENÄ°Å KAPSAMLI SUÃ‡ MATERYALÄ° OLUÅTURUCU ---
    // Bu fonksiyon otomatik olarak 1000 farklÄ± suÃ§ varyasyonu Ã¼retir.
    function generateMassiveTCK() {
        const categories = [
            { code: "ORG", name: "Ã–rgÃ¼t YÃ¶netimi ve Liderlik", maxP: 400000, maxH: 300 }, // Organize
            { code: "UYE", name: "Ã‡ete/Ã–rgÃ¼t ÃœyeliÄŸi", maxP: 150000, maxH: 100 }, // Ãœyelik
            { code: "SLH", name: "Silah ve MÃ¼himmat Ticareti", maxP: 300000, maxH: 200 }, // Silah
            { code: "NAR", name: "UyuÅŸturucu Ä°mal ve Ticareti", maxP: 350000, maxH: 250 }, // Narkotik
            { code: "INF", name: "Ã–rgÃ¼t Ä°Ã§i Ä°nfaz ve KÄ±yÄ±m", maxP: 400000, maxH: 300 }, // Cinayet
            { code: "KMR", name: "YasadÄ±ÅŸÄ± Bahis ve Kumar", maxP: 100000, maxH: 50 }, // Kumar
            { code: "SBR", name: "Siber SuÃ§lar ve Veri HÄ±rsÄ±zlÄ±ÄŸÄ±", maxP: 200000, maxH: 150 }, // Siber
            { code: "GSP", name: "Gasp, HaraÃ§ ve YaÄŸma", maxP: 180000, maxH: 120 }, // Gasp
            { code: "KCK", name: "Ä°nsan KaÃ§akÃ§Ä±lÄ±ÄŸÄ±", maxP: 250000, maxH: 180 }, // KaÃ§akÃ§Ä±lÄ±k
            { code: "YOL", name: "Kamu YolsuzluÄŸu ve RÃ¼ÅŸvet", maxP: 200000, maxH: 150 }  // Yolsuzluk
        ];

        let generatedList = [];
        
        // Her kategori iÃ§in 100 adet suÃ§ Ã¼ret (10 kategori * 100 = 1000 suÃ§)
        categories.forEach(cat => {
            for(let i = 1; i <= 100; i++) {
                // Hapis ve Para cezasÄ±nÄ± "Seviye"ye gÃ¶re orantÄ±la
                let calculatedPara = Math.floor((cat.maxP / 100) * i);
                let calculatedHapis = Math.floor((cat.maxH / 100) * i);
                
                // SayÄ±larÄ± yuvarla (daha temiz gÃ¶rÃ¼nsÃ¼n)
                calculatedPara = calculatedPara - (calculatedPara % 100); 

                // SÄ±fÄ±r ceza olmasÄ±n
                if(calculatedPara < 1000) calculatedPara = 1000;
                if(calculatedHapis < 1) calculatedHapis = 1;

                // SuÃ§ adÄ±nÄ± oluÅŸtur
                let sucAdi = `${cat.name} (Derece ${i})`;
                
                // Ã–zel isimlendirmeler (Ä°lk 5 ve Son 5 seviye iÃ§in Ã¶zel adlar)
                if(i === 1) sucAdi = `Basit ${cat.name} ÅÃ¼phesi`;
                if(i === 100) sucAdi = `AÄŸÄ±rlaÅŸtÄ±rÄ±lmÄ±ÅŸ ${cat.name} (Lider Kadro)`;

                generatedList.push({
                    code: `${cat.code}-${i.toString().padStart(3, '0')}`, // Ã–rn: ORG-001
                    ad: sucAdi,
                    p: calculatedPara,
                    h: calculatedHapis
                });
            }
        });
        return generatedList;
    }

    function girisYap() {
        const k = document.getElementById('kadi').value.trim();
        const s = document.getElementById('sifre').value.trim();
        if(k === "admin" && s === "admin") { basariliGiris(k); return; } 
        database.ref('personel').orderByChild('kadi').equalTo(k).once('value', sn => {
            let f = false; sn.forEach(c => { if(c.val().sifre === s) f = true; });
            if(f) basariliGiris(k); else document.getElementById('loginMsg').innerText = "HatalÄ± GiriÅŸ!";
        });
    }

    function basariliGiris(k) {
        aktifKullanici = k;
        document.getElementById('aktifKullaniciAdi').innerText = "Sicil: " + k;
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'flex';
        verileriYukle();
        basvurulariDinle();
        mesaiSistemiBaslat();
        tckVeritabaniHazirla();
    }

    // --- TCK YÃ–NETÄ°MÄ° ---
    function tckVeritabaniHazirla() {
        database.ref('tck').on('value', s => {
            if(s.exists() && s.val().length > 50) {
                // VeritabanÄ±nda zaten veri varsa onu kullan
                tckDb = Object.values(s.val());
            } else {
                // VeritabanÄ± boÅŸsa 1000'lik listeyi oluÅŸtur ve kaydet
                console.log("TCK VeritabanÄ± oluÅŸturuluyor... (1000 Adet)");
                tckDb = generateMassiveTCK();
                database.ref('tck').set(tckDb); 
            }
            cezaListesiniOlustur();
            tckEditorListesiniGuncelle();
        });
    }

    function tckEditorListesiniGuncelle() {
        const tb = document.getElementById('tckEditListesi');
        tb.innerHTML = "";
        // Performans iÃ§in sadece ilk 100 taneyi gÃ¶sterelim, arama ile diÄŸerleri gelir
        tckDb.slice(0, 100).forEach(item => {
            tb.innerHTML += `<tr><td><span class="badge badge-purple">${item.code || 'EK'}</span></td><td>${item.ad}</td><td>${item.p.toLocaleString()} TL</td><td>${item.h} YÄ±l</td></tr>`;
        });
    }

    function tckKaydet() {
        const ad = document.getElementById('edit_ad').value;
        const p = parseInt(document.getElementById('edit_para').value);
        const h = parseInt(document.getElementById('edit_kamu').value);
        
        if(!ad) return alert("SuÃ§ tanÄ±mÄ± girin.");
        
        tckDb.push({code: 'MAN-'+Math.floor(Math.random()*1000), ad: ad, p: p || 0, h: h || 0});
        database.ref('tck').set(tckDb);
        alert("Kanun eklendi/gÃ¼ncellendi!");
        modalKapat();
    }

    // --- RUHSAT SÄ°STEMÄ° ---
    function ruhsatKaydet() {
        const sahip = document.getElementById('ruh_sahip').value;
        const tip = document.getElementById('ruh_tip').value;
        const tarih = document.getElementById('ruh_tarih').value;
        if(!sahip || !tarih) return alert("TÃ¼m alanlarÄ± doldurun!");
        database.ref('ruhsatlar').push({ sahip: sahip, tip: tip, gecerlilik: tarih, veren: aktifKullanici, verilis_tarihi: Date.now() });
        alert("Ruhsat baÅŸarÄ±yla verildi!"); modalKapat();
    }
    function ruhsatlariDinle() {
        database.ref('ruhsatlar').on('value', s => {
            const tb = document.getElementById('ruhsatListesi'); tb.innerHTML = "";
            s.forEach(c => { const d = c.val(); let tarihStil = new Date(d.gecerlilik) < new Date() ? "color:red; font-weight:bold;" : ""; tb.innerHTML += `<tr><td>${d.sahip}</td><td><span class="badge badge-blue">${d.tip}</span></td><td style="${tarihStil}">${d.gecerlilik} ${tarihStil?'(DOLDU)':''}</td><td>${d.veren}</td><td><button onclick="dbSil('ruhsatlar/${c.key}')" class="btn btn-red btn-sm">Ä°PTAL</button></td></tr>`; });
        });
    }

    // --- MESAÄ° ---
    function mesaiSistemiBaslat() {
        database.ref('active_shifts').on('value', s => {
            const tbody = document.getElementById('aktifMesaiBody'); tbody.innerHTML = ""; let count = 0;
            s.forEach(c => { const d = c.val(); let sure = Math.floor((Date.now() - d.start) / 60000); tbody.innerHTML += `<tr><td>${d.user}</td><td>${new Date(d.start).toLocaleTimeString()}</td><td>${sure} Dk</td></tr>`; count++; if(d.user === aktifKullanici && !myShiftTimer) { myShiftStart = d.start; startLocalTimer(); uiMesaiActive(); } });
            document.getElementById('statAktifPersonel').innerText = count;
        });
    }
    function mesaiToggle() { if(!myShiftStart) { database.ref('active_shifts/' + aktifKullanici).set({ user: aktifKullanici, start: Date.now() }); } else { if(confirm("Mesaiyi bitir?")) { database.ref('active_shifts/' + aktifKullanici).remove(); myShiftStart = null; clearInterval(myShiftTimer); myShiftTimer = null; uiMesaiInactive(); } } }
    function startLocalTimer() { if(myShiftTimer) clearInterval(myShiftTimer); myShiftTimer = setInterval(() => { if(!myShiftStart) return; let diff = Date.now() - myShiftStart; let h = Math.floor(diff / 3600000); let m = Math.floor((diff % 3600000) / 60000); let s = Math.floor((diff % 60000) / 1000); document.getElementById('mesaiSayac').innerText = (h<10?'0':'')+h + ":" + (m<10?'0':'')+m + ":" + (s<10?'0':'')+s; }, 1000); }
    function uiMesaiActive() { const c = document.getElementById('kisiselMesaiKart'); c.classList.add('mesai-active'); document.getElementById('mesaiDurumText').innerText = "MESAÄ°DE"; document.getElementById('mesaiDurumText').style.color = "var(--success)"; document.getElementById('btnMesai').innerText = "MESAÄ° BÄ°TÄ°R"; document.getElementById('btnMesai').classList.remove('btn-green'); document.getElementById('btnMesai').classList.add('btn-red'); }
    function uiMesaiInactive() { const c = document.getElementById('kisiselMesaiKart'); c.classList.remove('mesai-active'); document.getElementById('mesaiDurumText').innerText = "MESAÄ° DIÅI"; document.getElementById('mesaiDurumText').style.color = "var(--text-muted)"; document.getElementById('btnMesai').innerText = "MESAÄ°YE BAÅLA"; document.getElementById('btnMesai').classList.remove('btn-red'); document.getElementById('btnMesai').classList.add('btn-green'); document.getElementById('mesaiSayac').innerText = "00:00:00"; }

    // --- CEZA SÄ°STEMÄ° (OPTÄ°MÄ°ZE EDÄ°LDÄ°) ---
    function cezaListesiniOlustur() {
        // Ä°lk aÃ§Ä±lÄ±ÅŸta boÅŸ bÄ±rakÄ±yoruz, arama yapÄ±nca dolsun (Performans iÃ§in)
        // Ancak kullanÄ±cÄ± gÃ¶rsÃ¼n diye ilk 50 taneyi ekleyelim.
        renderCezaListesi(tckDb.slice(0, 50));
    }

    function renderCezaListesi(liste) {
        const container = document.getElementById('cezaListesiContainer');
        container.innerHTML = "";
        liste.forEach(c => {
            container.innerHTML += `
                <div class="ceza-item" onclick="cezaSec(this, ${c.p}, ${c.h})">
                    <div>
                        <span class="ceza-code">${c.code || 'EK'}</span>
                        <span>${c.ad}</span>
                    </div>
                    <span class="badge badge-blue">${c.p.toLocaleString()} TL / ${c.h} YÄ±l</span>
                </div>
            `;
        });
    }

    let toplamPara = 0; let toplamAy = 0;
    function cezaSec(element, para, ay) {
        if(element.classList.contains('selected')) { element.classList.remove('selected'); toplamPara -= para; toplamAy -= ay; } 
        else { element.classList.add('selected'); toplamPara += para; toplamAy += ay; }
        document.getElementById('toplamTutar').innerText = `${toplamPara.toLocaleString()} TL / ${toplamAy} YÄ±l Hapis`;
    }
    
    function cezaFiltrele() {
        const val = document.getElementById('ceza_ara').value.toLowerCase();
        // Arama yaparken tÃ¼m DB iÃ§inde ara ve filtrele
        const filtrelenmis = tckDb.filter(item => 
            item.ad.toLowerCase().includes(val) || (item.code && item.code.toLowerCase().includes(val))
        );
        // Ã‡ok fazla sonuÃ§ varsa limiti koru
        renderCezaListesi(filtrelenmis.slice(0, 100));
    }

    function cezaSifirla() { toplamPara=0; toplamAy=0; renderCezaListesi(tckDb.slice(0,50)); document.getElementById('toplamTutar').innerText="0 TL / 0 YÄ±l"; }
    function cezaModalAc() { cezaSifirla(); document.getElementById('cezaModal').style.display = 'flex'; }
    function cezayiKes() {
        const sahis = document.getElementById('ceza_sahis').value;
        if(!sahis) return alert("ÅahÄ±s adÄ± girilmedi!");
        if(toplamPara === 0 && toplamAy === 0) return alert("HiÃ§bir suÃ§ seÃ§mediniz!");
        database.ref('gbt').push({ isim: sahis, tarih: new Date().toISOString(), suc: `TOPLAM: ${toplamPara.toLocaleString()} TL, ${toplamAy} YÄ±l Hapis`, memur: aktifKullanici });
        alert("Ceza Sisteme Ä°ÅŸlendi!"); modalKapat();
    }
    function gbtSorgula() {
        const isim = document.getElementById('gbtInput').value;
        const div = document.getElementById('gbtSonuc'); div.innerHTML = "AranÄ±yor...";
        database.ref('gbt').orderByChild('isim').equalTo(isim).once('value', s => {
            div.innerHTML = "";
            if(s.exists()) {
                let html = `<h3 style="color:var(--danger)">SABIKA KAYDI BULUNDU</h3>`;
                s.forEach(c => { let d=c.val(); html += `<div class="card" style="border-left:4px solid var(--danger)"><h4>${d.suc}</h4><p>${new Date(d.tarih).toLocaleDateString()} - Ä°ÅŸleyen: ${d.memur}</p></div>`; });
                div.innerHTML = html;
            } else { div.innerHTML = `<div class="card" style="border-left:4px solid var(--success)"><h3>TEMÄ°Z</h3><p>SabÄ±ka kaydÄ± yok.</p></div>`; }
        });
    }

    // --- GENEL ---
    function verileriYukle() {
        database.ref('personel').on('value', s => { const tb = document.getElementById('personelListesi'); tb.innerHTML = ""; s.forEach(c => tb.innerHTML += `<tr><td>${c.val().kadi}</td><td>****</td><td><button onclick="dbSil('personel/${c.key}')" class="btn btn-red">SÄ°L</button></td></tr>`); });
        database.ref('blacklist').on('value', s => { const d = document.getElementById('blacklistContainer'); d.innerHTML = ""; s.forEach(c => d.innerHTML += `<div style="margin-bottom:5px; border-bottom:1px solid #333;">${c.val().discord_id} (${c.val().sebep}) <button onclick="dbSil('blacklist/${c.key}')" class="btn btn-red btn-sm">X</button></div>`); });
        ruhsatlariDinle();
        database.ref('gbt').on('value', s => { if(s.exists()) document.getElementById('statAranan').innerText = Object.keys(s.val()).length; });
    }
    function basvurulariDinle() {
        database.ref('basvurular').on('value', s => {
            const tb = document.getElementById('basvuruListesi'); tb.innerHTML = ""; let bekleyen = 0;
            let arr = []; s.forEach(c => arr.push({k:c.key, v:c.val()})); arr.reverse();
            arr.forEach(i => { const d = i.v; if(d.durum==='Beklemede') bekleyen++; let b = d.durum==='OnaylandÄ±' ? 'badge-green' : (d.durum==='Reddedildi' ? 'badge-red' : 'badge-warn'); tb.innerHTML += `<tr><td>${new Date(d.tarih).toLocaleDateString()}</td><td>${d.discord_id}</td><td>${d.ic_isim}</td><td><span class="badge ${b}">${d.durum}</span></td><td><button onclick="basvuruIncele('${i.k}')" class="btn btn-blue">Ä°NCELE</button></td></tr>`; });
            document.getElementById('statBasvuru').innerText = bekleyen; document.getElementById('basvuruBadge').style.display = bekleyen > 0 ? 'inline-block' : 'none'; document.getElementById('basvuruBadge').innerText = bekleyen;
        });
    }
    function basvuruIncele(key) {
        database.ref('basvurular/'+key).once('value', s => {
            seciliBasvuruId = key; const d = s.val();
            let h = `<div class="grid-2"><div><strong>ID:</strong> ${d.discord_id}</div><div><strong>Ä°sim:</strong> ${d.ic_isim}</div></div><hr><h4>Cevaplar:</h4>`;
            for(let k in d.cevaplar) if(!['discord_id','ic_isim','ooc_yas'].includes(k)) h += `<p style="color:#aaa;margin-bottom:2px;">${d.soru_detaylari?d.soru_detaylari[k]:k}</p><div style="background:rgba(0,0,0,0.2);padding:10px;margin-bottom:10px;">${d.cevaplar[k]}</div>`;
            document.getElementById('basvuruDetayIcerik').innerHTML = h; document.getElementById('basvuruIslemButtonlari').innerHTML = `<button onclick="durumGuncelle('OnaylandÄ±')" class="btn btn-green">ONAYLA</button><button onclick="durumGuncelle('Reddedildi')" class="btn btn-red">REDDET</button><button onclick="karaListeyeEkle('${d.discord_id}')" class="btn btn-dark">BANLA</button>`; document.getElementById('basvuruModal').style.display = 'flex';
        });
    }
    function durumGuncelle(durum) { database.ref('basvurular/'+seciliBasvuruId).update({durum:durum}); modalKapat(); }
    function plakaSorgula() { const p = document.getElementById('plakaInput').value; const r = document.getElementById('aracSonuc'); if(p === "34 TR 34") r.innerHTML = `<div class="card" style="border-left:5px solid red; text-align:center;"><h1>Ã‡ALINTI ARAÃ‡</h1><p>Aranan ÅahÄ±s: Mehmet YÄ±lmaz</p></div>`; else r.innerHTML = `<div class="card" style="border-left:5px solid green; text-align:center;"><h1>TEMÄ°Z</h1><p>Ruhsat Sahibi: Ahmet Demir</p></div>`; }
    function ohalDegistir() { database.ref('sistem/ohal').once('value', s => database.ref('sistem/ohal').set(!s.val())); }
    database.ref('sistem/ohal').on('value', s => { if(s.val()) { document.body.classList.add('ohal-active'); document.getElementById('ohalAlertBar').style.display = 'block'; document.getElementById('ohalBtn').innerText = "âš ï¸ OHAL BÄ°TÄ°R"; } else { document.body.classList.remove('ohal-active'); document.getElementById('ohalAlertBar').style.display = 'none'; document.getElementById('ohalBtn').innerText = "ğŸš¨ OHAL BAÅLAT"; } });
    function dbSil(path) { if(confirm("Sil?")) database.ref(path).remove(); }
    function modalKapat() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); }
    function modalAc(id){ document.getElementById(id).style.display='flex'; }
    function tabDegistir(id, el) { document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active-tab')); document.getElementById(id).classList.add('active'); el.classList.add('active-tab'); }
    function tabloAra(i,t){ let v=document.getElementById(i).value.toLowerCase(); document.querySelectorAll('#'+t+' tr').forEach(r=>r.style.display=r.innerText.toLowerCase().includes(v)?'':'none'); }
    function personelEkle() { database.ref('personel').push({kadi:document.getElementById('yeniKadi').value, sifre:document.getElementById('yeniSifre').value}); }
    function karaListeyeEkle(id=null) { const d=id||document.getElementById('bl_id').value; database.ref('blacklist').push({discord_id:d, sebep:"Admin Ban", tarih:Date.now()}); if(id) durumGuncelle('Reddedildi'); else alert("Eklendi"); }
</script>
</body>
</html>
