<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>EGM Personel YÃ¶netim Paneli</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar (Sol MenÃ¼) */
        .sidebar { width: 260px; background: #162447; color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .sidebar-header { text-align: center; margin-bottom: 40px; }
        .sidebar-header img { width: 80px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .sidebar h2 { color: #ffd700; font-size: 1.2rem; letter-spacing: 1px; margin-top: 10px; text-transform: uppercase; }
        
        .menu-item { padding: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 10px; transition: 0.3s; display: flex; align-items: center; font-weight: 500; }
        .menu-item:hover, .active-tab { background: #1f4068; border-left: 4px solid #e43f5a; }
        .menu-item span { margin-left: 10px; }
        
        /* Ä°Ã§erik AlanÄ± */
        .content { flex: 1; padding: 40px; overflow-y: auto; background: #eef2f5; }
        .page-title { font-size: 1.8rem; color: #162447; margin-bottom: 25px; border-bottom: 2px solid #ccc; padding-bottom: 10px; font-weight: bold; }
        
        /* Tablo TasarÄ±mÄ± */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        th, td { padding: 18px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #1f4068; color: white; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.5px; }
        tr:hover { background: #f8f9fa; }
        
        /* Butonlar */
        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem; margin-right: 5px; color: white; transition: 0.2s; font-weight: 600; }
        .btn-green { background: #28a745; }
        .btn-red { background: #dc3545; }
        .btn-blue { background: #007bff; }
        .btn-yellow { background: #ffc107; color: #333; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        /* Login EkranÄ± */
        #loginScreen { position: fixed; top:0; left:0; width:100%; height:100%; background: linear-gradient(135deg, #0f172a 0%, #162447 100%); z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 50px; border-radius: 10px; width: 380px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.3); border-top: 5px solid #e43f5a; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; background: #f9f9f9; font-size: 1rem; }
        .login-input:focus { border-color: #162447; outline: none; background: white; }
        
        /* Rozetler */
        .badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .badge-mudur { background: #ffd700; color: #333; }
        .badge-memur { background: #e0e0e0; color: #555; }
        
        /* Sekmeler */
        .tab-content { display: none; }
        .tab-content.active { display: block; fade-in: 0.5s; }
    </style>
</head>
<body>

<div id="loginScreen">
    <div class="login-box">
        <img src="https://upload.wikimedia.org/wikipedia/tr/a/a6/Emniyet_Genel_M%C3%BCd%C3%BCrl%C3%BC%C4%9F%C3%BC_logosu.png" width="90" style="margin-bottom:15px;">
        <h2 style="color:#162447; margin:0 0 5px 0;">EGM PERSONEL</h2>
        <p style="color:#666; font-size:0.9rem; margin-bottom:25px;">YÃ¶netim Paneli GiriÅŸi</p>
        
        <input type="text" id="kadi" class="login-input" placeholder="Sicil No / KullanÄ±cÄ± AdÄ±">
        <input type="password" id="sifre" class="login-input" placeholder="Åifre">
        <button onclick="girisYap()" class="btn btn-blue" style="width:100%; padding:15px; font-size:1.1rem; margin-top:15px; background: #162447;">Sisteme GiriÅŸ</button>
        <p id="loginMsg" style="color:#e43f5a; margin-top:15px; font-size:0.9rem; font-weight:bold;"></p>
    </div>
</div>

<div id="adminPanel" style="display:none; width:100%;">
    <div class="sidebar">
        <div class="sidebar-header">
            <img src="https://upload.wikimedia.org/wikipedia/tr/a/a6/Emniyet_Genel_M%C3%BCd%C3%BCrl%C3%BC%C4%9F%C3%BC_logosu.png">
            <h2>MÃ¼dÃ¼rlÃ¼k Paneli</h2>
        </div>
        
        <div class="menu-item active-tab" onclick="tabDegistir('basvurularTab', this)">ğŸ“„ BaÅŸvuru Onay</div>
        <div class="menu-item" onclick="tabDegistir('yoneticilerTab', this)">ğŸ‘®â€â™‚ï¸ Personel Listesi</div>
        <div style="margin-top:auto;">
            <div class="menu-item" onclick="location.reload()" style="background:#e43f5a; border:none;">ğŸšª GÃ¼venli Ã‡Ä±kÄ±ÅŸ</div>
        </div>
    </div>

    <div class="content">
        
        <div id="basvurularTab" class="tab-content active">
            <div class="page-title">Bekleyen Personel BaÅŸvurularÄ±</div>
            <table>
                <thead>
                    <tr>
                        <th>Discord ID</th>
                        <th>IC Ä°sim Soyisim</th>
                        <th>YaÅŸ</th>
                        <th>Durum</th>
                        <th>Ä°ÅŸlemler</th>
                    </tr>
                </thead>
                <tbody id="basvuruListesi"></tbody>
            </table>
        </div>

        <div id="yoneticilerTab" class="tab-content">
            <div class="page-title">YÃ¶netici & Personel Listesi</div>
            
            <div style="background:white; padding:25px; border-radius:8px; margin-bottom:30px; box-shadow:0 2px 4px rgba(0,0,0,0.05); display:flex; align-items:center; gap:10px;">
                <h3 style="margin:0; min-width:150px; color:#162447;">+ Yeni Memur Ekle:</h3>
                <input type="text" id="yeniKadi" placeholder="KullanÄ±cÄ± AdÄ± Belirle" style="padding:10px; border:1px solid #ccc; border-radius:4px; flex:1;">
                <input type="password" id="yeniSifre" placeholder="Åifre Belirle" style="padding:10px; border:1px solid #ccc; border-radius:4px; flex:1;">
                <button onclick="yetkiliEkle()" class="btn btn-green" style="padding:10px 20px;">Atama Yap</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>RÃ¼tbe</th>
                        <th>KullanÄ±cÄ± AdÄ±</th>
                        <th>Åifre</th>
                        <th>Yetkiler</th>
                    </tr>
                </thead>
                <tbody id="yoneticiListesi"></tbody>
            </table>
            <p style="color:#666; font-size:0.8rem; margin-top:10px;">* "MÃ¼dÃ¼r" hesabÄ± sistemin kÃ¶k hesabÄ±dÄ±r ve silinemez.</p>
        </div>

    </div>
</div>

<script src="config.js"></script>
<script>
    // --- GÄ°RÄ°Å Ä°ÅLEMLERÄ° (Ã–NEMLÄ° GÃœNCELLEME) ---
    function girisYap() {
        const kadi = document.getElementById('kadi').value;
        const sifre = document.getElementById('sifre').value;

        // Firebase sorgusu
        database.ref('yetkililer').orderByChild('kadi').equalTo(kadi).once('value', snapshot => {
            let giris = false;
            let bulunanKullanici = null;

            snapshot.forEach(child => { 
                if(child.val().sifre === sifre) {
                    giris = true;
                    bulunanKullanici = child.val();
                }
            });

            // EÄER HÄ°Ã‡ KULLANICI YOKSA VE GÄ°RÄ°LEN BÄ°LGÄ°LER "MÃ¼dÃ¼r" / "GÃ¶kSancak1881" Ä°SE
            // OTOMATÄ°K OLARAK ANA HESABI OLUÅTUR VE GÄ°RÄ°Å YAP.
            database.ref('yetkililer').once('value', tumKullanicilar => {
                if (!tumKullanicilar.exists() && kadi === 'MÃ¼dÃ¼r' && sifre === 'GÃ¶kSancak1881') {
                    database.ref('yetkililer').push({kadi: 'MÃ¼dÃ¼r', sifre: 'GÃ¶kSancak1881'});
                    giris = true;
                }

                if (giris) {
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'flex';
                    verileriGetir();
                    yoneticileriGetir();
                } else {
                    document.getElementById('loginMsg').innerText = "HatalÄ± Sicil No veya Åifre!";
                }
            });
        });
    }

    // --- TABLO DOLDURMA (BAÅVURULAR) ---
    function verileriGetir() {
        database.ref('basvurular').on('value', snapshot => {
            const liste = document.getElementById('basvuruListesi');
            liste.innerHTML = "";
            
            if(!snapshot.exists()) {
                liste.innerHTML = "<tr><td colspan='5' style='text-align:center;'>HenÃ¼z baÅŸvuru yok.</td></tr>";
                return;
            }

            snapshot.forEach(child => {
                const data = child.val();
                const key = child.key;
                const renk = data.durum === 'OnaylandÄ±' ? '#28a745' : (data.durum === 'Reddedildi' ? '#dc3545' : '#ffc107');
                const durumText = data.durum === 'OnaylandÄ±' ? 'KABUL EDÄ°LDÄ°' : (data.durum === 'Reddedildi' ? 'REDDEDÄ°LDÄ°' : 'Ä°NCELEMEDE');

                // CevaplarÄ± formatla
                let cevapMetni = "";
                if(data.cevaplar) {
                    for (const [soru, cevap] of Object.entries(data.cevaplar)) {
                        cevapMetni += `${soru}: ${cevap}\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
                    }
                }

                liste.innerHTML += `
                <tr>
                    <td style="font-weight:bold;">${data.discord_id}</td>
                    <td>${data.ic_isim}</td>
                    <td>${data.ooc_yas}</td>
                    <td style="color:${renk}; font-weight:bold;">${durumText}</td>
                    <td>
                        <button onclick="alert('MÃœLAKAT CEVAPLARI:\\n\\n${cevapMetni}')" class="btn btn-blue">Dosya Ä°ncele</button>
                        <button onclick="durumDegis('${key}', 'OnaylandÄ±')" class="btn btn-green">âœ“</button>
                        <button onclick="durumDegis('${key}', 'Reddedildi')" class="btn btn-red">âœ—</button>
                    </td>
                </tr>`;
            });
        });
    }

    function durumDegis(key, drm) { database.ref('basvurular/'+key).update({durum: drm}); }

    // --- YÃ–NETÄ°CÄ° & PERSONEL YÃ–NETÄ°MÄ° (KORUMALI SÄ°STEM) ---
    function yoneticileriGetir() {
        database.ref('yetkililer').on('value', snapshot => {
            const liste = document.getElementById('yoneticiListesi');
            liste.innerHTML = "";
            snapshot.forEach(child => {
                const data = child.val();
                const key = child.key;
                
                // KORUMA MANTIÄI: EÄŸer isim "MÃ¼dÃ¼r" ise silme butonu koyma.
                let isMudur = (data.kadi === 'MÃ¼dÃ¼r');
                let rutbeBadge = isMudur ? '<span class="badge badge-mudur">MÃœDÃœR</span>' : '<span class="badge badge-memur">MEMUR</span>';
                let silButonu = isMudur ? '<span style="color:#ccc; font-size:0.8rem; margin-left:10px;">ğŸ”’ KorumalÄ± Hesap</span>' : `<button onclick="yoneticiSil('${key}')" class="btn btn-red">Ä°liÅŸiÄŸi Kes</button>`;

                liste.innerHTML += `
                <tr>
                    <td>${rutbeBadge}</td>
                    <td style="font-weight:bold; color:#162447;">${data.kadi}</td>
                    <td style="font-family:monospace;">â€¢â€¢â€¢â€¢â€¢â€¢</td>
                    <td>
                        <button onclick="sifreDuzenle('${key}', '${data.kadi}')" class="btn btn-yellow">Åifre Yenile</button>
                        ${silButonu}
                    </td>
                </tr>`;
            });
        });
    }

    function yetkiliEkle() {
        const k = document.getElementById('yeniKadi').value;
        const s = document.getElementById('yeniSifre').value;
        if(k && s) {
            database.ref('yetkililer').push({kadi: k, sifre: s});
            document.getElementById('yeniKadi').value = "";
            document.getElementById('yeniSifre').value = "";
            alert("Yeni personel sisteme atandÄ±!");
        } else {
            alert("LÃ¼tfen kullanÄ±cÄ± adÄ± ve ÅŸifre giriniz.");
        }
    }

    function yoneticiSil(key) {
        if(confirm("Bu personelin yetkilerini almak ve silmek istediÄŸinize emin misiniz?")) {
            database.ref('yetkililer/'+key).remove();
        }
    }

    function sifreDuzenle(key, isim) {
        let yeniSifre = prompt(`${isim} kullanÄ±cÄ±sÄ± iÃ§in yeni ÅŸifreyi girin:`);
        if(yeniSifre) {
            database.ref('yetkililer/'+key).update({sifre: yeniSifre});
            alert("Åifre baÅŸarÄ±yla gÃ¼ncellendi.");
        }
    }

    // --- SEKME GEÃ‡Ä°ÅLERÄ° ---
    function tabDegistir(tabId, element) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active-tab'));
        document.getElementById(tabId).classList.add('active');
        element.classList.add('active-tab');
    }
</script>
</body>
</html>
